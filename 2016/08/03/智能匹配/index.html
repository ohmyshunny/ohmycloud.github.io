<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|monospace:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="智能匹配,smartmatch," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="智能匹配智能匹配通常作用在当前”主题”(topic)上, 即作用在 $_ 变量上. 在下面的表格中, $_ 代表 ~~ 操作符的左侧, 或者作为 given 的参数,  或者作为其它主题化的参数.  X 代表 ~~ 操作符右侧要匹配的模式, 或者在 when 后面的模式.(实际上, ~~ 操作符充当着一个小型的主题; 即, 为了右侧的计算, 它把 $_ 绑定到左侧的值上. 使用底层的 .ACCEP">
<meta property="og:type" content="article">
<meta property="og:title" content="智能匹配">
<meta property="og:url" content="https://ohmycloud.github.io/2016/08/03/智能匹配/index.html">
<meta property="og:site_name" content="Perl 6 青春小站">
<meta property="og:description" content="智能匹配智能匹配通常作用在当前”主题”(topic)上, 即作用在 $_ 变量上. 在下面的表格中, $_ 代表 ~~ 操作符的左侧, 或者作为 given 的参数,  或者作为其它主题化的参数.  X 代表 ~~ 操作符右侧要匹配的模式, 或者在 when 后面的模式.(实际上, ~~ 操作符充当着一个小型的主题; 即, 为了右侧的计算, 它把 $_ 绑定到左侧的值上. 使用底层的 .ACCEP">
<meta property="og:updated_time" content="2016-10-23T16:32:15.955Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="智能匹配">
<meta name="twitter:description" content="智能匹配智能匹配通常作用在当前”主题”(topic)上, 即作用在 $_ 变量上. 在下面的表格中, $_ 代表 ~~ 操作符的左侧, 或者作为 given 的参数,  或者作为其它主题化的参数.  X 代表 ~~ 操作符右侧要匹配的模式, 或者在 when 后面的模式.(实际上, ~~ 操作符充当着一个小型的主题; 即, 为了右侧的计算, 它把 $_ 绑定到左侧的值上. 使用底层的 .ACCEP">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"hide"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://ohmycloud.github.io/2016/08/03/智能匹配/"/>

  <title> 智能匹配 | Perl 6 青春小站 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Perl 6 青春小站</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>
 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                智能匹配
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-03T00:00:00+08:00" content="2016-08-03">
              2016-08-03
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Perl-6/" itemprop="url" rel="index">
                    <span itemprop="name">Perl 6</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/03/智能匹配/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/03/智能匹配/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="智能匹配"><a href="#智能匹配" class="headerlink" title="智能匹配"></a>智能匹配</h3><p>智能匹配通常作用在当前”主题”(topic)上, 即作用在 <code>$_</code> 变量上. 在下面的表格中, <code>$_</code> 代表 <code>~~</code> 操作符的左侧, 或者作为 <code>given</code> 的参数,  或者作为其它主题化的参数.  <code>X</code> 代表 <code>~~</code> 操作符右侧要匹配的模式, 或者在 <code>when</code> 后面的模式.(实际上, <code>~~</code> 操作符充当着一个小型的主题; 即, 为了右侧的计算, 它把 <code>$_</code> 绑定到左侧的值上. 使用底层的 <code>.ACCEPTS</code> 形式来避免这种主题化.)</p>
<a id="more"></a>
<p>第一节包含了含有享有特权的语法; 如果匹配能通过那些条目之一完成, 那它就会那样做. 这些特别的语法是通过它们的形式而非它们的类型进行分派的. 否则就使用表格中的剩余部分,并且匹配会根据普通的方法分派规则进行分派.  允许优化器(optimizer)假定编译时之后没有定义额外的匹配操作符, 所以, 如果在编译时模式类型就显而易见的, 那么跳转表(jump table)可以被优化. 然而, 这部分表格的语法仍然有点特权的, 跟 <code>~~</code> 操作符一样, 是 Perl 中少有的几个不使用多重分派的操作符之一. 相反, 基于类型的智能匹配会被单个地分派给属于 <code>X</code> 模式对象的底层方法.</p>
<p>换句话说, 智能匹配首先根据模式(pattern)的<code>形式</code>或<code>类型</code>(下面的<code>X</code>)进行<code>分派</code>(dispatch), 然后那个模式自身决定<code>是否</code>和<code>怎样</code>注意主题(<code>$_</code>)的类型. 所以, 下面表格中的第二列就是初始列. 第一列中的 <code>Any</code> 条目标示了模式要么不关心主题的类型,  要么把那个条目作为默认值, 因为上面列出的更具体的类型不匹配.</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">$_          X         Type of Match Implied   Match <span class="keyword">if</span> (<span class="keyword">given</span> $_)</div><div class="line">======      =====     =====================   ===================</div><div class="line">Any         True      ~~ True                 (parsewarn on literal token)</div><div class="line">Any         False     ~~ False match          (parsewarn on literal token)</div><div class="line">Any         Match     ~~ Successful match     (parsewarn on literal token)</div><div class="line">Any         Nil       ~~ Benign failure       (parsewarn on literal token)</div><div class="line">Any         Failure   Failure type check      (okay, matches against type)</div><div class="line">Any         *         block signature match   block successfully binds to |$_</div><div class="line">Any         Callable:($)  item <span class="function"><span class="keyword">sub</span> <span class="title">truth</span>      <span class="title">X</span>($_)</span></div><div class="line">                                              <span class="title">S03</span>-<span class="title">smartmatch</span>/<span class="title">any</span>-<span class="title">callable</span>.<span class="title">t</span> <span class="title">lines</span> 5–14</div><div class="line"><span class="title">Any</span>         <span class="title">Callable</span>:()   <span class="title">simple</span> <span class="title">closure</span> <span class="title">truth</span>    <span class="title">X</span>() (<span class="title">ignoring</span> $_)</div><div class="line">                                              <span class="title">S03</span>-<span class="title">smartmatch</span>/<span class="title">any</span>-<span class="title">callable</span>.<span class="title">t</span> <span class="title">lines</span> 15–24</div><div class="line"></div><div class="line"><span class="title">Any</span>         <span class="title">Bool</span>      <span class="title">simple</span> <span class="title">truth</span>            <span class="title">X</span> (<span class="title">treats</span> <span class="title">Bool</span> <span class="title">value</span> <span class="title">as</span> <span class="title">success</span>/<span class="title">failure</span>)</div><div class="line">                                              <span class="title">S03</span>-<span class="title">smartmatch</span>/<span class="title">any</span>-<span class="title">bool</span>.<span class="title">t</span> <span class="title">lines</span> 5–23</div><div class="line"></div><div class="line"><span class="title">Any</span>         <span class="title">List</span>      <span class="title">list</span> <span class="title">truth</span>              <span class="title">X</span> (<span class="title">treats</span> <span class="title">list</span> <span class="title">size</span> <span class="title">as</span> <span class="title">success</span>/<span class="title">failure</span>)</div><div class="line"><span class="title">Any</span>         <span class="title">Match</span>     <span class="title">match</span> <span class="title">success</span>           <span class="title">X</span> (<span class="title">treats</span> <span class="title">Match</span> <span class="title">value</span> <span class="title">as</span> <span class="title">success</span>)</div><div class="line"><span class="title">Any</span>         <span class="title">Nil</span>       <span class="title">benign</span> <span class="title">failure</span>          <span class="title">X</span> (<span class="title">treats</span> <span class="title">Nil</span> <span class="title">value</span> <span class="title">as</span> <span class="title">failure</span>)</div><div class="line"><span class="title">Any</span>         <span class="title">Failure</span>   <span class="title">malign</span> <span class="title">failure</span>          <span class="title">X</span> (<span class="title">passes</span> <span class="title">Failure</span> <span class="title">object</span> <span class="title">through</span>)</div><div class="line"><span class="title">Any</span>         <span class="title">Numeric</span>   <span class="title">numeric</span> <span class="title">equality</span>        +$_ == <span class="title">X</span></div><div class="line"><span class="title">Any</span>         <span class="title">Stringy</span>   <span class="title">string</span> <span class="title">equality</span>         ~$_ <span class="title">eq</span> <span class="title">X</span></div><div class="line"><span class="title">Any</span>         <span class="title">Whatever</span>  <span class="title">always</span> <span class="title">matches</span>          <span class="title">True</span></div><div class="line"><span class="title">Associative</span> <span class="title">Pair</span>      <span class="title">test</span> <span class="title">hash</span> <span class="title">mapping</span>       $_&#123;X.key&#125; ~~ X.value</div><div class="line">Any         Pair      test object attribute   ?.<span class="string">"&#123;X.key&#125;"</span> === ?X.value (e.g. filetests)</div><div class="line">                                              S03-smartmatch/any-pair.t lines <span class="number">5</span>–<span class="number">35</span></div><div class="line"></div><div class="line">Set         Set       identical sets          $_ === X</div><div class="line">Any         Setty     force set comparison    $_.Set === X.Set</div><div class="line">Bag         Bag       identical bags          $_ === X</div><div class="line">Any         Baggy     force bag comparison    $_.Bag === X.Bag</div><div class="line">Mix         Mix       identical bags          $_ === X</div><div class="line">Any         Mixy      force mix comparison    $_.Mix === X.Mix</div><div class="line">Positional  Array     arrays are comparable   $_ «===» X (dwims * wildcards!)</div><div class="line">                                              S03-smartmatch/array-array.t lines <span class="number">5</span>–<span class="number">70</span></div><div class="line"></div><div class="line">Associative Array     <span class="keyword">keys</span>/list are comparable +X == +$_ <span class="keyword">and</span> $_&#123;X.all&#125;:<span class="keyword">exists</span></div><div class="line">Callable    Positional list vs predicate      so $_(X)</div><div class="line">Any         Positional lists are comparable   $_[] «===» X[]</div><div class="line">Hash        Hash      hash mapping equivalent $_ eqv X</div><div class="line">Associative Hash      force hash comparison   $_.Hash eqv X</div><div class="line">Callable    Hash      hash vs predicate       so $_(X)</div><div class="line">Positional  Hash      attempted any/all    FAIL, point user to [].any <span class="keyword">and</span> [].all <span class="keyword">for</span> LHS</div><div class="line">Pair        Hash      hash does mapping       X&#123;.key&#125; ~~ .value</div><div class="line">Any         Hash      hash contains object    X&#123;$_&#125;:<span class="keyword">exists</span></div><div class="line">Str         Regex     string pattern match    .match(X)</div><div class="line">Associative Regex     attempted <span class="keyword">reverse</span> dwim  FAIL, point user to any/all vs <span class="keyword">keys</span>/<span class="keyword">values</span>/pairs</div><div class="line">Positional  Regex     attempted any/all/cat   FAIL, point user to any/all/cat/<span class="keyword">join</span> <span class="keyword">for</span> LHS</div><div class="line">Any         Regex     pattern match           .match(X)</div><div class="line">Range       Range     subset range            !$_ <span class="keyword">or</span> .bounds.all ~~ X (mod ^<span class="string">'s)</span></div><div class="line">                                              S03-smartmatch/range-range.t lines 5–29</div><div class="line"></div><div class="line">Any         Range     in real range           X.min &lt;= $_ &lt;= X.max (mod ^'<span class="keyword">s</span>)</div><div class="line">                                              S03-smartmatch/disorganized.t lines <span class="number">30</span>–<span class="number">145</span></div><div class="line"></div><div class="line">Any         Range     in stringy range        X.min le $_ le X.max (mod ^<span class="string">'s)</span></div><div class="line">Any         Range     in generic range        [!after] X.min,$_,X.max (etc.)</div><div class="line">Any         Type      type membership         $_.does(X)</div><div class="line">                                              S03-smartmatch/any-type.t lines 5–40</div><div class="line"></div><div class="line">Signature   Signature sig compatibility       $_ is a subset of X      ???</div><div class="line">Callable    Signature sig compatibility       $_.sig is a subset of X  ???</div><div class="line">Capture     Signature parameters bindable     $_ could bind to X (doesn't!)</div><div class="line">Any         Signature parameters bindable     |$_ could <span class="keyword">bind</span> to X (doesn<span class="string">'t!)</span></div><div class="line">Signature   Capture   parameters bindable     X could bind to $_</div><div class="line">Any         Any       scalars are identical   $_ === X</div><div class="line">                                               S03-smartmatch/any-any.t lines 5–29</div></pre></td></tr></table></figure>
<p>如果没有其它模式要求 X, 最后那个 rule 才会被应用.</p>
<p>所有的智能匹配类型都是<code>itemized</code>; <code>~~</code> 和 <code>given/when</code> 都为它们的参数提供了 item (标量) 上下文, 并自动展开任何 junctive 匹配, 以使最终给 <code>.ACCEPTS</code> 的分派看不到任何复数. 所以,上面的 <code>$_</code> 和 <code>X</code> 是能被看作标量的潜在容器对象. (你可以显式地使 <code>~~</code> 亢奋, 在这种情况下, 所有的智能匹配是使用 <code>.ACCEPTS</code> 的基于类型的分派来完成的, 不是前面表格中的基于形式的分派)</p>
<p>基于类型的底层方法分派真正形式是 :</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">X.ACCEPTS($_)</div></pre></td></tr></table></figure>
<p>作为单个分派调用, 这仅仅只关注初始化的 X 的类型. <code>ACCEPT</code> 方法接口是通过 <code>Pattern</code> role 来定义的. 任何组成 <code>Pattern</code> role 的类都可以选择提供单个 <code>ACCEPTS</code> 方法来处理一切, 这对用于那些上面说的 Any 中只有一个条目模式类型.</p>
<p>或者在类中,类也能选择提供多个 <code>ACCEPTS</code>  multi-methods, 这些然后会在类中根据 <code>$_</code> 的类型进行重新分派.</p>
<p>智能匹配表格主要用于反应编译时能识别的形式和类型. 为了避免条目的扩展, 表格假设下面的类型会表现的类似:</p>
<table>
<thead>
<tr>
<th style="text-align:left">实际类型</th>
<th style="text-align:left">把条目用作</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Iterator Array</td>
<td style="text-align:left">List</td>
</tr>
<tr>
<td style="text-align:left">使用 Class,Enum,Role,或一般类型绑定的具名值</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">Cat</td>
<td style="text-align:left">Str</td>
</tr>
<tr>
<td style="text-align:left">Int UInt等</td>
<td style="text-align:left">Num</td>
</tr>
<tr>
<td style="text-align:left">BUf</td>
<td style="text-align:left">Str or Array of Int</td>
</tr>
</tbody>
</table>
<p>(注意, 然而, 这些映射可以通过显式的 ACCEPTS 方法的定义进行重写. 如果在编译时, 重定义比智能匹配的分析早, 那么信息对优化器也是可访问的).</p>
<p> 一个在 ASCII 范围之外, 包含任何字节或整数的 <code>Buf</code> 类型可能会静静地提升为 <code>Str</code> 类型用于匹配, 只有在它跟 Unicode 的关系被清楚地声明或类型化时. 这种类型信息可能来自输入文件句柄, 或者 <code>Buf</code> role 可能是一个参数类型, 它允许你使用各种编码来实例化 buffers. 在没有这样的类型信息的情况下, 你仍然可以跟 buffer 进行模式匹配, 但是任何把 buffer 当作不是整数序列的尝试都是错误的, 这通常会发生警告.</p>
<p>匹配 Grammar 会把 grammar 当作类型名, 而不是一个 grammar. 你需要使用 <code>.parse</code> 和 <code>.parsefile</code> 方法来调用一个 grammar.</p>
<p>匹配 <code>Signature</code> 不会真的绑定任何变量, 而是测试签名是否能绑定. 要真的绑定到一个签名上, 使用模式  <code>*</code> 来代理绑定到 <code>when</code>语句块上代替. 匹配 <code>*</code> 在 when 里面很特殊 .  随后的 block 是否绑定了主题变量, 所以你可以做有序的签名匹配:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">given</span> $capture &#123;</div><div class="line">        <span class="keyword">when</span> * -&gt; Int $a, Str $b &#123; ... &#125;</div><div class="line">        <span class="keyword">when</span> * -&gt; Str $a, Int $b &#123; ... &#125;</div><div class="line">        <span class="keyword">when</span> * -&gt; $a, $b         &#123; ... &#125;</div><div class="line">        <span class="keyword">when</span> *                   &#123; ... &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p> 当多重分派无序的语义不足以定义代码的”主从秩序”时, 这会很有用. 注意, 你可以绑定给一个裸的 block 或 一个箭头 block. 绑定给裸的 block很方便的把主题放在 `$_ 中,所以上面最后那个形式等价于一个 default.(占位符参数也能用于裸 block 形式, 尽管它们的类型不能被那样指定.)</p>
<p>没有给 <code>Any</code> 模式定义模式匹配,  所以,如果你想要一个反转的智能匹配测试, 右边是一个 <code>Any</code>,这时你总是通过显式的调用使用了 <code>$_</code> 作为模式的底层 <code>ACCEPTS</code> 方法来获取它. 例如:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$_       X    Type of Match Wanted   What to <span class="keyword">use</span> on the right</div><div class="line">======  ===  ====================   ========================</div><div class="line">Callable Any  item <span class="function"><span class="keyword">sub</span> <span class="title">truth</span>         .<span class="title">ACCEPTS</span>(<span class="title">X</span>) <span class="title">or</span> .(<span class="title">X</span>)</span></div><div class="line"><span class="title">Range</span>    <span class="title">Any</span>  <span class="title">in</span> <span class="title">range</span>               .<span class="title">ACCEPTS</span>(<span class="title">X</span>)</div><div class="line"><span class="title">Type</span>     <span class="title">Any</span>  <span class="title">type</span> <span class="title">membership</span>        .<span class="title">ACCEPTS</span>(<span class="title">X</span>) <span class="title">or</span> .<span class="title">does</span>(<span class="title">X</span>)</div><div class="line"><span class="title">Regex</span>    <span class="title">Any</span>  <span class="title">pattern</span> <span class="title">match</span>          .<span class="title">ACCEPTS</span>(<span class="title">X</span>)</div><div class="line"><span class="title">etc</span>.</div></pre></td></tr></table></figure>
<p>同样的技巧会允许你倾向于给混合对象以默认匹配规则, 只要你在 <code>$_</code> 身上以点方法开头:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">given</span> $somethingordered &#123;</div><div class="line">        <span class="keyword">when</span> .values.<span class="string">'[&lt;=]'</span>     &#123; <span class="keyword">say</span> <span class="string">"increasing"</span> &#125;</div><div class="line">        <span class="keyword">when</span> .values.<span class="string">'[&gt;=]'</span>     &#123; <span class="keyword">say</span> <span class="string">"decreasing"</span> &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>必要时, 你可以定义一个宏来得到”反转的 when”:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">my</span> macro statement_control:&lt;ACCEPTS&gt; () &#123; <span class="string">"when .ACCEPTS: "</span> &#125;</div><div class="line">    <span class="keyword">given</span> $pattern &#123;</div><div class="line">        ACCEPTS $a      &#123; ... &#125;</div><div class="line">        ACCEPTS $b      &#123; ... &#125;</div><div class="line">        ACCEPTS $c      &#123; ... &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>各种建议但不推荐使用的智能匹配行为 可以很容易地(并且我们希望更易读)被模仿成下面这样:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">$_      X      Type of Match Wanted   What to <span class="keyword">use</span> on the right</div><div class="line">======  ===    ====================   ========================</div><div class="line">Array   Num    array element truth    .[X]</div><div class="line">Array   Num    array contains number  *,X,*</div><div class="line">Array   Str    array contains string  *,X,*</div><div class="line">Array   Parcel array begins /w Parcel X,*</div><div class="line">Array   Parcel array contains Parcel  *,X,*</div><div class="line">Array   Parcel array ends with Parcel *,X</div><div class="line">Hash    Str    hash element truth     .<span class="string">&#123;X&#125;</span></div><div class="line">Hash    Str    hash key existence     .<span class="string">&#123;X&#125;</span>:<span class="keyword">exists</span></div><div class="line">Hash    Num    hash element truth     .<span class="string">&#123;X&#125;</span></div><div class="line">Hash    Num    hash key existence     .<span class="string">&#123;X&#125;</span>:<span class="keyword">exists</span></div><div class="line">Buf     Int    buffer contains <span class="keyword">int</span>    .match(X)</div><div class="line">Str     Str    string contains string .match(X)</div><div class="line">Array   Scalar array contains item    .any === X</div><div class="line">Str     Array  array contains string  X.any</div><div class="line">Num     Array  array contains number  X.any</div><div class="line">Scalar  Array  array contains object  X.any</div><div class="line">Hash    Array  hash slice <span class="keyword">exists</span>      .&#123;X.all&#125;:<span class="keyword">exists</span> .&#123;X.any&#125;:<span class="keyword">exists</span></div><div class="line">Set     Set    subset relation        .&#123;X.all&#125;:<span class="keyword">exists</span></div><div class="line">Set     Hash   subset relation        .&#123;X.all&#125;:<span class="keyword">exists</span></div><div class="line">Any     Set    subset relation        .Set.&#123;X.all&#125;:<span class="keyword">exists</span></div><div class="line">Any     Hash   subset relation        .Set.&#123;X.all&#125;:<span class="keyword">exists</span></div><div class="line">Any     Set    superset relation      X.&#123;.all&#125;:<span class="keyword">exists</span></div><div class="line">Any     Hash   superset relation      X.&#123;.all&#125;:<span class="keyword">exists</span></div><div class="line">Any     Set    sets intersect         .&#123;X.any&#125;:<span class="keyword">exists</span></div><div class="line">Set     Array  subset relation        X,*          <span class="comment"># (conjectured)</span></div><div class="line">Array   Regex  match array as string  .Cat.match(X)  cat(@$<span class="number">_</span>).match(X)</div></pre></td></tr></table></figure>
<p>(注意, <code>.cat</code> 方法和 <code>Cat</code> 类型都强制必须接收单个对象, 不像 <code>cat</code> 函数, cat 函数作为一个列表操作符, 接收一个句法的列表(或multilist ) 并展开它. 然而,所有的这些都返回 <code>Cat</code> 对象.)</p>
<p>布尔表达式能返回布尔值, 例如比较操作符或一元 <code>?</code> 操作符.它们可能显式或隐式地引用 <code>$_</code>. 如果它们一点也没有引用 <code>$_</code>, 那也是 okay 的 — 那种情况下你就使用 switch 结构作为比一串  elsifs 可读性更好的备选分支. 然而, 注意,那意味着你不能这样写:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">given</span> $boolean &#123;</div><div class="line">       <span class="keyword">when</span> True  &#123;...&#125;</div><div class="line">       <span class="keyword">when</span> False &#123;...&#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>因为它总是会选择 <code>True</code> 这种情况. 相反, 使用某些像条件上下文的东西在内部使用更好:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">given</span> $boolean &#123;</div><div class="line">       <span class="keyword">when</span> .Bool == <span class="number">1</span> &#123;...&#125;</div><div class="line">       <span class="keyword">when</span> .Bool == <span class="number">0</span> &#123;...&#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>就像使用 <code>if</code> 语句一样. 在任何情况下, 如果你想使用 <code>~~</code> 或 <code>when</code> 进行智能匹配, 它会依照语法识别 True 或 False, 并提醒你那不会按你期望的那样做. 编译器也允许提醒任何其它不测试 <code>$_</code> 的布尔结构, 在他能检测的范围之内.</p>
<p>同样地, 任何接收一个 Matcher的函数(诸如 grep) 不会接收一个 Bool 类型的参数, 因为那总是标示着编程错误.(可以使用 <code>*</code> 来匹配任何东西, 如果那就是你想要的. 或者使用一个闭包来返回一个常量布尔值)</p>
<p>也要注意 regex 匹配不返回 Bool, 而是返回一个能用作布尔值的 Match 对象(或 Nil). 如果想要, 使用显式的 <code>?</code> 或 <code>so</code> 来强制转为 布尔值. Match 对象代表一个成功的匹配, 并被智能匹配当作与 True 的值相同, 类似地, Nil 代表着失败, 并且不能直接用于智能匹配的右侧. 测试 definedness 来代替或使用 <code>* === Nil</code>.</p>
<p>带有诸如 <code>:g</code>那样的修饰符的正则匹配想返回多个匹配, 使用 <code>List</code>来做 <code>so</code>.就像任何列表一样, 如果有一个或多项, 值就是被计算为真. 如果没有匹配, 返回空列表, 它在布尔上下文中计算为 false.</p>
<p>为了智能匹配, 所有的 <code>Set</code>, <code>Bag</code>, 和<code>Mix</code> 值和对应的散了类型 <code>SetHash</code>, <code>BagHash</code>, 和<code>MixHash</code> 是等价的.即, Hash 容器中键代表唯一对象, 键值代表那些唯一键的重复次数.(当然, Set 能有 0 或 1次重复, 因为保证唯一性). 所以,所有这些 Mixy 类型只比较键, 不比较键值. 使用 <code>eqv</code> 代替, 来测试键和键值的相等性.</p>
<p>Despite the need for an implementation to examine the bounds of a range in order to perform smartmatching, the result of smartmatching two Range objects is not actually defined in terms of bounds, but rather as a subset relationship between two (potentially infinite) sets of values encompassed by the intervals involved, for any orderable type such as real numbers, strings, or versions. The result is defined as true if and only if all potential elements that would be matched by the left range are also matched by the right range. Hence it does not matter to what extent the bounds of a empty range are “overspecified”. If the left range is empty, it always matches, because there exists no value to falsify it. If the right range is empty, it can match only if the left range is also empty.尽管为了执行智能匹配, 需要一个实现来检查范围的边界,  两个 Range 对象的智能匹配结果实际上没有按照边界定义,而是作为子集关系</p>
<p>The Cat type allows you to have an infinitely extensible string. You can match an array or iterator by feeding it to a Cat, which is essentially a Str interface over an iterator of some sort. Then a Regex can be used against it as if it were an ordinary string. The Regex engine can ask the string if it has more characters, and the string will extend itself if possible from its underlying iterator. (Note that such strings have an indefinite number of characters, so if you use .* in your pattern, or if you ask the string how many characters it has in it, or if you even print the whole string, it may feel compelled to slurp in the rest of the string, which may or may not be expeditious.)</p>
<p> cat 操作符接收一个(潜在惰性的)列表并返回一个 Cat 对象.在字符串上下文中, 这惰性地强制列表中的每一个元素为字符串, 字符串的长度不明. 你可以像这样搜索一个 gather:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">my $lazystr := cat gather for @foo &#123; take .bar &#125;</div><div class="line">$lazystr ~~ /pattern/;</div></pre></td></tr></table></figure>
<p>Cat 接口允许 regex 使用 <code>&lt;,&gt;</code> 断言来匹配元素的边界, Match 对象提供了一种方式, 能获取元素在列表中的索引和位置. 如果底层的数据结构是一个可变数组, 数组的改变由 Cat 追踪, 以至于元素数字仍然正确. 字符串, 数组,列表,序列,捕获还有树节点都可以是正则匹配的模式, 或由签名匹配饿模式</p>
<p><a href="https://github.com/perl6/roast/blob/master/S03-smartmatch/any-callable.t#L5-L14" target="_blank" rel="external">S03/Smart matching/any-callable.t lines 5–14</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">use v6;</div><div class="line">use Test;</div><div class="line">plan 4;</div><div class="line"></div><div class="line">#L&lt;S03/&quot;Smart matching&quot;/Any Callable:($) item sub truth&gt;</div><div class="line">&#123;</div><div class="line">    sub is_even($x) &#123; $x % 2 == 0 &#125;</div><div class="line">    sub is_odd ($x) &#123; $x % 2 == 1 &#125;</div><div class="line">    ok 4 ~~ &amp;is_even,    &apos;scalar sub truth (unary)&apos;;</div><div class="line">    ok 4 !~~ &amp;is_odd,    &apos;scalar sub truth (unary, negated smart-match)&apos;;</div><div class="line">    ok !(3 ~~ &amp;is_even), &apos;scalar sub truth (unary)&apos;;</div><div class="line">    ok !(3 !~~ &amp;is_odd), &apos;scalar sub truth (unary, negated smart-match)&apos;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="https://github.com/perl6/roast/blob/master/S03-smartmatch/any-callable.t#L15-L24" target="_blank" rel="external">S03/Smart matching/any-callable.t lines 15–24</a></p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> v6;</div><div class="line"><span class="keyword">use</span> Test;</div><div class="line">plan <span class="number">2</span>;</div><div class="line"></div><div class="line"><span class="comment">#L&lt;S03/"Smart matching"/Any Callable:() simple closure truth&gt;</span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">sub</span> <span class="title">uhuh</span> </span>&#123; <span class="number">1</span> &#125;</div><div class="line">    <span class="function"><span class="keyword">sub</span> <span class="title">nuhuh</span> </span>&#123; Mu &#125;</div><div class="line"></div><div class="line">    ok((Mu ~~ &amp;uhuh), <span class="string">"scalar sub truth"</span>);</div><div class="line">    ok(!(Mu ~~ &amp;nuhuh), <span class="string">"negated scalar sub false"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="https://github.com/perl6/roast/blob/master/S03-smartmatch/any-bool.t#L5-L23" target="_blank" rel="external">S03/Smart matching/any-bool.t lines 5–23</a></p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> v6;</div><div class="line"><span class="keyword">use</span> Test;</div><div class="line">plan <span class="number">8</span>;</div><div class="line"></div><div class="line"><span class="comment">#L&lt;S03/Smart matching/Any Bool simple truth&gt;</span></div><div class="line"></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">sub</span> <span class="title">is</span>-<span class="title">true</span>() </span>&#123; True &#125;;</div><div class="line">    <span class="function"><span class="keyword">sub</span> <span class="title">is</span>-<span class="title">false</span>() </span>&#123; False &#125;;</div><div class="line">    ok   <span class="number">0</span>  ~~ is-true(),      <span class="string">'~~ non-syntactic True'</span>;</div><div class="line">    ok  <span class="string">'a'</span> ~~ is-true(),      <span class="string">'~~ non-syntactic True'</span>;</div><div class="line">    nok  <span class="number">0</span>  ~~ is-false(),     <span class="string">'~~ non-syntactic True'</span>;</div><div class="line">    nok <span class="string">'a'</span> ~~ is-false(),     <span class="string">'~~ non-syntactic True'</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#123;</div><div class="line">    nok  <span class="number">0</span>   ~~ .so,           <span class="string">'boolean truth'</span>;</div><div class="line">    ok   <span class="string">'a'</span> ~~ .so,           <span class="string">'boolean truth'</span>;</div><div class="line">    ok   <span class="number">0</span>   ~~ .not,          <span class="string">'boolean truth'</span>;</div><div class="line">    nok  <span class="string">'a'</span> ~~ .not,          <span class="string">'boolean truth'</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="https://github.com/perl6/roast/blob/master/S03-smartmatch/any-pair.t#L5-L35" target="_blank" rel="external">S03/Smart matching/any-pair.t lines 5–35</a></p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> v6;</div><div class="line"><span class="keyword">use</span> Test;</div><div class="line">plan <span class="number">8</span>;</div><div class="line"></div><div class="line"><span class="comment">#L&lt;S03/Smart matching/Any Pair test object attribute&gt;</span></div><div class="line">&#123;</div><div class="line">    <span class="comment"># ?."&#123;X.key&#125;" === ?X.value</span></div><div class="line">    <span class="comment"># 意思是:</span></div><div class="line">    <span class="comment"># 在对象上调用名为`X.key` 的方法, 用`?`强制为布尔值</span></div><div class="line">    <span class="comment"># 并检查是否和 `X.value`的布尔值相同</span></div><div class="line"></div><div class="line">    class SmartmatchTest::AttrPair &#123;</div><div class="line">        has $.a = <span class="number">4</span>;</div><div class="line">        has $.b = <span class="string">'foo'</span>;</div><div class="line">        has $.c = Mu;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">my</span> $o = SmartmatchTest::AttrPair.new();</div><div class="line">    ok  ($o ~~ :a(<span class="number">4</span>)),      <span class="string">'$obj ~~ Pair (Int, +)'</span>;</div><div class="line">    ok  ($o ~~ :a(<span class="number">2</span>)),      <span class="string">'$obj ~~ Pair (Int, +)'</span>;</div><div class="line">    ok !($o ~~ :b(<span class="number">0</span>)),      <span class="string">'$obj ~~ Pair (different types)'</span>;</div><div class="line">    ok  ($o ~~ :b&lt;foo&gt;),    <span class="string">'$obj ~~ Pair (Str, +)'</span>;</div><div class="line">    ok  ($o ~~ :b&lt;ugh&gt;),    <span class="string">'$obj ~~ Pair (Str, -)'</span>;</div><div class="line">    ok  ($o ~~ :c(Mu)),     <span class="string">'$obj ~~ Pair (Mu, +)'</span>;</div><div class="line">    ok  ($o ~~ :c(<span class="number">0</span>)),      <span class="string">'$obj ~~ Pair (0, +)'</span>;</div><div class="line">    ok !($o ~~ :b(Mu)),     <span class="string">'$obj ~~ Pair (Mu, -)'</span>;</div><div class="line">    <span class="comment"># not explicitly specced, but implied by the spec and decreed</span></div><div class="line">    <span class="comment"># by TimToady: non-existing method or attribute dies:</span></div><div class="line">    <span class="comment"># http://irclog.perlgeek.de/perl6/2009-07-06#i_1293199</span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="https://github.com/perl6/roast/blob/master/S03-smartmatch/array-array.t#L5-L70" target="_blank" rel="external">S03/Smart matching/array-array.t lines 5–70</a></p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> v6;</div><div class="line"><span class="keyword">use</span> Test;</div><div class="line">plan <span class="number">36</span>;</div><div class="line"></div><div class="line"><span class="comment">#L&lt;S03/Smart matching/arrays are comparable&gt;</span></div><div class="line">&#123;</div><div class="line">    ok(((<span class="string">"blah"</span>, <span class="string">"blah"</span>) ~~ (<span class="string">"blah"</span>, <span class="string">"blah"</span>)), <span class="string">"qw/blah blah/ .eq"</span>);</div><div class="line">    ok(!(      (<span class="number">1</span>, <span class="number">2</span>) ~~ (<span class="number">1</span>, <span class="number">1</span>)    ),    <span class="string">"1 2 !~~ 1 1"</span>);</div><div class="line">    ok(!(   (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) ~~ (<span class="number">1</span>, <span class="number">2</span>)    ),    <span class="string">"1 2 3 !~~ 1 2"</span>);</div><div class="line">    ok(!(      (<span class="number">1</span>, <span class="number">2</span>) ~~ (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) ),    <span class="string">"1 2 !~~ 1 2 3"</span>);</div><div class="line">    ok(!(          [] ~~ [<span class="number">1</span>]), <span class="string">"array smartmatch boundary conditions"</span>);</div><div class="line">    ok(!(         [<span class="number">1</span>] ~~ []),  <span class="string">"array smartmatch boundary conditions"</span>);</div><div class="line">    ok((           [] ~~ []),  <span class="string">"array smartmatch boundary conditions"</span>);</div><div class="line">    ok((          [<span class="number">1</span>] ~~ [<span class="number">1</span>]), <span class="string">"array smartmatch boundary conditions"</span>);</div><div class="line"></div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (<span class="number">1</span>,*),   <span class="string">'array smartmatch dwims * at end'</span>);</div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (<span class="number">1</span>,*,*), <span class="string">'array smartmatch dwims * at end (many *s)'</span>);</div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (*,<span class="number">4</span>), <span class="string">'array smartmatch dwims * at start'</span>);</div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (*,*,<span class="number">4</span>), <span class="string">'array smartmatch dwims * at start (many *s)'</span>);</div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (<span class="number">1</span>,*,<span class="number">3</span>,<span class="number">4</span>), <span class="string">'array smartmatch dwims * 1 elem'</span>);</div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (<span class="number">1</span>,*,*,<span class="number">3</span>,<span class="number">4</span>), <span class="string">'array smartmatch dwims * 1 elem (many *s)'</span>);</div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (<span class="number">1</span>,*,<span class="number">4</span>), <span class="string">'array smartmatch dwims * many elems'</span>);</div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (<span class="number">1</span>,*,*,<span class="number">4</span>), <span class="string">'array smartmatch dwims * many elems (many *s)'</span>);</div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (*,<span class="number">3</span>,*), <span class="string">'array smartmatch dwims * at start and end'</span>);</div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (*,*,<span class="number">3</span>,*,*), <span class="string">'array smartmatch dwims * at start and end (many *s)'</span>);</div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (*,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>), <span class="string">'array smartmatch dwims * can match nothing at start'</span>);</div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (*,*,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>), <span class="string">'array smartmatch dwims * can match nothing at start (many *s)'</span>);</div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (<span class="number">1</span>,<span class="number">2</span>,*,<span class="number">3</span>,<span class="number">4</span>), <span class="string">'array smartmatch dwims * can match nothing in middle'</span>);</div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (<span class="number">1</span>,<span class="number">2</span>,*,*,<span class="number">3</span>,<span class="number">4</span>), <span class="string">'array smartmatch dwims * can match nothing in middle (many *s)'</span>);</div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,*), <span class="string">'array smartmatch dwims * can match nothing at end'</span>);</div><div class="line">    ok((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,*,*), <span class="string">'array smartmatch dwims * can match nothing at end (many *s)'</span>);</div><div class="line">    ok(!((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (<span class="number">1</span>,*,<span class="number">3</span>)), <span class="string">'* dwimming does not cause craziness'</span>);</div><div class="line">    ok(!((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (*,<span class="number">5</span>)), <span class="string">'* dwimming does not cause craziness'</span>);</div><div class="line">    ok(!((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) ~~ (<span class="number">1</span>,<span class="number">3</span>,*)), <span class="string">'* dwimming does not cause craziness'</span>);</div><div class="line"></div><div class="line">    <span class="comment"># now try it with arrays as well</span></div><div class="line">    <span class="keyword">my</span> @a = <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>;</div><div class="line">    <span class="keyword">my</span> @b = <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>;</div><div class="line">    <span class="keyword">my</span> @m = (*, <span class="number">2</span>, *); <span class="comment"># m as "magic" ;-)</span></div><div class="line"></div><div class="line">    ok (@a ~~  @a), <span class="string">'Basic smartmatching on arrays (positive)'</span>;</div><div class="line">    ok (@a !~~ @b), <span class="string">'Basic smartmatching on arrays (negative)'</span>;</div><div class="line">    ok (@b !~~ @a), <span class="string">'Basic smartmatching on arrays (negative)'</span>;</div><div class="line"></div><div class="line">    ok (@a ~~  @m), <span class="string">'Whatever dwimminess in arrays'</span>;</div><div class="line">    ok (@a ~~ (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)), <span class="string">'smartmatch Array ~~ List'</span>;</div><div class="line">    ok ((<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) ~~ @a), <span class="string">'smartmatch List ~~ Array'</span>;</div><div class="line"></div><div class="line">    ok ((<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) ~~ @m), <span class="string">'smartmatch List ~~ Array with dwim'</span>;</div><div class="line"></div><div class="line">    ok (<span class="number">1</span> ~~ *,<span class="number">1</span>,*),     <span class="string">'smartmatch with Array RHS co-erces LHS to list'</span>;</div><div class="line">    ok (<span class="number">1</span>..<span class="number">10</span> ~~ *,<span class="number">5</span>,*), <span class="string">'smartmatch with Array RHS co-erces LHS to list'</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="https://github.com/perl6/roast/blob/master/S03-smartmatch/range-range.t#L5-L29" target="_blank" rel="external">S03/Smart matching/range-range.t lines 5–29</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; (2..3).bounds</div><div class="line">2 3</div><div class="line">&gt; (2..3).bounds.all</div><div class="line">all(2, 3)</div><div class="line">&gt; my @a = (1,3,5,8);</div><div class="line">1 3 5 8</div><div class="line">&gt; @a.bounds;</div><div class="line">Method &apos;bounds&apos; not found for invocant of class &apos;Array&apos;</div><div class="line">&gt; (2..3).bounds.all ~~ 1..4</div><div class="line">all(True, True)</div></pre></td></tr></table></figure>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> v6;</div><div class="line"><span class="keyword">use</span> Test;</div><div class="line">plan <span class="number">14</span>;</div><div class="line"></div><div class="line"><span class="comment">#L&lt;S03/Smart matching/Range Range subset range&gt;</span></div><div class="line">&#123;</div><div class="line">    <span class="comment"># .bounds.all ~~ X (mod ^'s)</span></div><div class="line">    <span class="comment"># 意思是:</span></div><div class="line">    <span class="comment"># 检查 .min 和 .max 是否都在 Range X 里面.</span></div><div class="line">    <span class="comment"># (though this is only true to a first approximation, as</span></div><div class="line">    <span class="comment"># those .min and .max values might be excluded)</span></div><div class="line"></div><div class="line">    ok  (<span class="number">2</span>..<span class="number">3</span> ~~ <span class="number">1</span>..<span class="number">4</span>),     <span class="string">'proper inclusion +'</span>;</div><div class="line">    ok !(<span class="number">1</span>..<span class="number">4</span> ~~ <span class="number">2</span>..<span class="number">3</span>),     <span class="string">'proper inclusion -'</span>;</div><div class="line">    ok  (<span class="number">2</span>..<span class="number">4</span> ~~ <span class="number">1</span>..<span class="number">4</span>),     <span class="string">'inclusive vs inclusive right end'</span>;</div><div class="line">    ok  (<span class="number">2</span>..^<span class="number">4</span> ~~ <span class="number">1</span>..<span class="number">4</span>),    <span class="string">'exclusive vs inclusive right end'</span>;</div><div class="line">    ok !(<span class="number">2</span>..<span class="number">4</span> ~~ <span class="number">1</span>..^<span class="number">4</span>),    <span class="string">'inclusive vs exclusive right end'</span>;</div><div class="line">    ok  (<span class="number">2</span>..^<span class="number">4</span> ~~ <span class="number">1</span>..^<span class="number">4</span>),   <span class="string">'exclusive vs exclusive right end'</span>;</div><div class="line">    ok  (<span class="number">2</span>..<span class="number">3</span> ~~ <span class="number">2</span>..<span class="number">4</span>),     <span class="string">'inclusive vs inclusive left end'</span>;</div><div class="line">    ok  (<span class="number">2</span>^..<span class="number">3</span> ~~ <span class="number">2</span>..<span class="number">4</span>),    <span class="string">'exclusive vs inclusive left end'</span>;</div><div class="line">    ok !(<span class="number">2</span>..<span class="number">3</span> ~~ <span class="number">2</span>^..<span class="number">4</span>),    <span class="string">'inclusive vs exclusive left end'</span>;</div><div class="line">    ok  (<span class="number">2</span>^..<span class="number">3</span> ~~ <span class="number">2</span>^..<span class="number">4</span>),   <span class="string">'exclusive vs exclusive left end'</span>;</div><div class="line">    ok  (<span class="number">2</span>..<span class="number">3</span> ~~ <span class="number">2</span>..<span class="number">3</span>),     <span class="string">'inclusive vs inclusive both ends'</span>;</div><div class="line">    ok  (<span class="number">2</span>^..^<span class="number">3</span> ~~ <span class="number">2</span>..<span class="number">3</span>),   <span class="string">'exclusive vs inclusive both ends'</span>;</div><div class="line">    ok !(<span class="number">2</span>..<span class="number">3</span> ~~ <span class="number">2</span>^..^<span class="number">3</span>),   <span class="string">'inclusive vs exclusive both ends'</span>;</div><div class="line">    ok  (<span class="number">2</span>^..^<span class="number">3</span> ~~ <span class="number">2</span>^..^<span class="number">3</span>), <span class="string">'exclusive vs exclusive both ends'</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="https://github.com/perl6/roast/blob/master/S03-smartmatch/disorganized.t#L30-L145" target="_blank" rel="external">S03-smartmatch/disorganized.t lines 30–145</a></p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> v6;</div><div class="line"><span class="keyword">use</span> Test;</div><div class="line">plan <span class="number">42</span>;</div><div class="line"></div><div class="line"><span class="comment">=begin pod</span></div><div class="line">This tests the smartmatch operator, defined in L&lt;S03/"Smart matching"&gt;</div><div class="line">=end pod</div><div class="line"></div><div class="line">sub eval_elsewhere($code)&#123; EVAL($code) &#125;</div><div class="line"></div><div class="line">#L&lt;S03/Smart matching/Any undef undefined not .defined&gt;</div><div class="line">&#123;</div><div class="line">    ok("foo" ~~ .defined, "foo is ~~ .defined");</div><div class="line">    nok "foo" !~~ .defined,   'not foo !~~ .defined';</div><div class="line">    nok((Mu ~~ .defined), "Mu is not .defined");</div><div class="line">&#125;</div><div class="line"></div><div class="line"># <span class="doctag">TODO:</span></div><div class="line"># Set   Set</div><div class="line"># Hash  Set</div><div class="line"># Any   Set</div><div class="line"># Set   Array</div><div class="line"># Set   Hash</div><div class="line"># Any   Hash</div><div class="line"></div><div class="line"># Regex tests are in spec/S05-*</div><div class="line"></div><div class="line">#L&lt;S03/"Smart matching"/in range&gt;</div><div class="line">&#123;</div><div class="line">    # more range tests in t/spec/S03-operators/range.t</div><div class="line">    ok((5 ~~ 1 .. 10), "5 is in 1 .. 10");</div><div class="line">    ok(!(10 ~~ 1 .. 5), "10 is not in 1 .. 5");</div><div class="line">    ok(!(1 ~~ 5 .. 10), "1 is not i n 5 .. 10");</div><div class="line">    ok(!(5 ~~ 5 ^..^ 10), "5 is not in 5 .. 10, exclusive");</div><div class="line">&#125;;</div><div class="line"></div><div class="line"># <span class="doctag">TODO:</span></div><div class="line"># Signature Signature</div><div class="line"># Callable  Signature</div><div class="line"># Capture   Signature</div><div class="line"># Any       Signature</div><div class="line"></div><div class="line"># Signature Capture  </div><div class="line"></div><div class="line"># reviewed by moritz on 2009-07-07 up to here.</div><div class="line"></div><div class="line">=begin Explanation</div><div class="line">You may be wondering what the heck is with all these try blocks.</div><div class="line">Prior to r12503, this test caused a horrible death of Pugs which</div><div class="line">magically went away when used inside an EVAL.  So the try blocks</div><div class="line">caught that case.</div><div class="line">=end Explanation</div><div class="line"></div><div class="line">&#123;</div><div class="line">    my $result = 0;</div><div class="line">    my $parsed = 0;</div><div class="line">    my @x = 1..20;</div><div class="line">    try &#123;</div><div class="line">        $result = all(@x) ~~ &#123; $_ &lt; 21 &#125;;</div><div class="line">        $parsed = 1;</div><div class="line">    &#125;;</div><div class="line">    ok $parsed, 'C&lt;all(@x) ~~ &#123; ... &#125;&gt; parses';</div><div class="line">    ok ?$result, 'C&lt;all(@x) ~~ &#123; ... &#125; when true for all';</div><div class="line"></div><div class="line">    $result = 0;</div><div class="line">    try &#123;</div><div class="line">        $result = !(all(@x) ~~ &#123; $_ &lt; 20 &#125;);</div><div class="line">    &#125;;</div><div class="line">    ok $result,</div><div class="line">        'C&lt;all(@x) ~~ &#123;...&#125; when true for one';</div><div class="line"></div><div class="line">    $result = 0;</div><div class="line">    try &#123;</div><div class="line">        $result = !(all(@x) ~~ &#123; $_ &lt; 12 &#125;);</div><div class="line">    &#125;;</div><div class="line">    ok $result, 'C&lt;all(@x) ~~ &#123;...&#125; when true for most';</div><div class="line"></div><div class="line">    $result = 0;</div><div class="line">    try &#123;</div><div class="line">        $result = !(all(@x) ~~ &#123; $_ &lt; 1  &#125;);</div><div class="line">    &#125;;</div><div class="line">    ok $result, 'C&lt;all(@x) ~~ &#123;...&#125; when true for one';</div><div class="line">&#125;;</div><div class="line"></div><div class="line"># need to test in EVAL() since class definitions happen at compile time,</div><div class="line"># ie before the plan is set up.</div><div class="line">eval-lives-ok 'class A &#123; method foo &#123; return "" ~~ * &#125; &#125;; A.new.foo',</div><div class="line">              'smartmatch in a class lives (RT 62196)';</div><div class="line"></div><div class="line"># RT #69762</div><div class="line">&#123;</div><div class="line">    ok sub &#123;&#125; ~~ Callable, '~~ Callable (true)';</div><div class="line">    nok 68762 ~~ Callable, '~~ Callable (false)';</div><div class="line">    ok 69762 !~~ Callable, '!~~ Callable (true)';</div><div class="line">    nok sub &#123;&#125; !~~ Callable, '!~~ Callable (false)';</div><div class="line"></div><div class="line">    ok sub &#123;&#125; ~~ Routine, '~~ Routine (true)';</div><div class="line">    nok 68762 ~~ Routine, '~~ Routine (false)';</div><div class="line">    ok 69762 !~~ Routine, '!~~ Routine (true)';</div><div class="line">    nok sub &#123;&#125; !~~ Routine, '!~~ Routine (false)';</div><div class="line"></div><div class="line">    ok sub &#123;&#125; ~~ Sub, '~~ Sub (true)';</div><div class="line">    nok 68762 ~~ Sub, '~~ Sub (false)';</div><div class="line">    ok 69762 !~~ Sub, '!~~ Sub (true)';</div><div class="line">    nok sub &#123;&#125; !~~ Sub, '!~~ Sub (false)';</div><div class="line"></div><div class="line">    ok sub &#123;&#125; ~~ Block, '~~ Block (true)';</div><div class="line">    nok 68762 ~~ Block, '~~ Block (false)';</div><div class="line">    ok 69762 !~~ Block, '!~~ Block (true)';</div><div class="line">    nok sub &#123;&#125; !~~ Block, '!~~ Block (false)';</div><div class="line"></div><div class="line">    ok sub &#123;&#125; ~~ Code, '~~ Code (true)';</div><div class="line">    nok 68762 ~~ Code, '~~ Code (false)';</div><div class="line">    ok 69762 !~~ Code, '!~~ Code (true)';</div><div class="line">    nok sub &#123;&#125; !~~ Code, '!~~ Code (false)';</div><div class="line">&#125;</div><div class="line">&#123;</div><div class="line"></div><div class="line">    class RT68762 &#123; our method rt68762 &#123;&#125; &#125;;</div><div class="line"></div><div class="line">    ok &amp;RT68762::rt68762 ~~ Method, '~~ Method (true)';</div><div class="line">    nok 68762            ~~ Method, '~~ Method (false)';</div><div class="line">    ok 69762              !~~ Method, '!~~ Method (true)';</div><div class="line">    nok &amp;RT68762::rt68762 !~~ Method, '!~~ Method (false)';</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"># RT 72048</div><div class="line">&#123;</div><div class="line">    role RT72048_role &#123;&#125;</div><div class="line">    class RT72048_class does RT72048_role &#123;&#125;</div><div class="line"></div><div class="line">    ok RT72048_class.new ~~ RT72048_role, 'class instance matches role';</div><div class="line">    nok RT72048_class.new !~~ RT72048_role, 'class instance !!matches role';</div><div class="line">&#125;</div><div class="line"></div><div class="line">ok ("foo" ~~ *) ~~ WhateverCode, 'thing ~~ * autoprimes';</div><div class="line">ok ("foo" ~~ *.chars == 3) ~~ Bool, 'thing ~~ WhateverCode is a boolean';</div><div class="line">ok ?(* ~~ "foo")('foo'), '* ~~ "foo" is WhateverCode';</div></pre></td></tr></table></figure>
<p><a href="https://github.com/perl6/roast/blob/master/S03-smartmatch/any-type.t#L5-L40" target="_blank" rel="external">S03-smartmatch/any-type.t lines 5–40</a></p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#L&lt;S03/Smart matching/type membership&gt;</span></div><div class="line">&#123;</div><div class="line">    class Dog &#123;&#125;</div><div class="line">    class Cat &#123;&#125;</div><div class="line">    class Chihuahua is Dog &#123;&#125; <span class="comment"># i'm afraid class Pugs will get in the way ;-)</span></div><div class="line">    role SomeRole &#123; &#125;;</div><div class="line">    class Something does SomeRole &#123; &#125;;</div><div class="line"></div><div class="line">    ok (Chihuahua ~~ Dog),      <span class="string">"chihuahua isa dog"</span>;</div><div class="line">    ok (Something ~~ SomeRole), <span class="string">'something does dog'</span>;</div><div class="line">    ok !(Chihuahua ~~ Cat),     <span class="string">"chihuahua is not a cat"</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment"># RT #71462</span></div><div class="line">&#123;</div><div class="line">    is <span class="string">'RT71462'</span> ~~ Str,      True,  <span class="string">'~~ Str returns a Bool (1)'</span>;</div><div class="line">    is <span class="number">5</span>         ~~ Str,      False, <span class="string">'~~ Str returns a Bool (2)'</span>;</div><div class="line">    is <span class="string">'RT71462'</span> ~~ Int,      False, <span class="string">'~~ Int returns a Bool (1)'</span>;</div><div class="line">    is <span class="number">5</span>         ~~ Int,      True,  <span class="string">'~~ Int returns a Bool (2)'</span>;</div><div class="line">    is <span class="string">'RT71462'</span> ~~ Set,      False, <span class="string">'~~ Set returns a Bool (1)'</span>;</div><div class="line">    is set(<span class="number">1</span>, <span class="number">3</span>) ~~ Set,      True,  <span class="string">'~~ Set returns a Bool (2)'</span>;</div><div class="line">    is <span class="string">'RT71462'</span> ~~ Numeric,  False, <span class="string">'~~ Numeric returns a Bool (1)'</span>;</div><div class="line">    is <span class="number">5</span>         ~~ Numeric,  True,  <span class="string">'~~ Numeric returns a Bool (2)'</span>;</div><div class="line">    is &amp;<span class="keyword">say</span>      ~~ Callable, True,  <span class="string">'~~ Callable returns a Bool (1)'</span>;</div><div class="line">    is <span class="number">5</span>         ~~ Callable, False, <span class="string">'~~ Callable returns a Bool (2)'</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment"># RT 76610</span></div><div class="line">&#123;</div><div class="line">    module M &#123; &#125;;</div><div class="line"></div><div class="line">    lives-ok &#123; <span class="number">42</span> ~~ M &#125;, <span class="string">'~~ module lives'</span>;</div><div class="line">    ok <span class="keyword">not</span> $/, <span class="string">'42 is not a module'</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="https://github.com/perl6/roast/blob/master/S03-smartmatch/any-any.t#L5-L29" target="_blank" rel="external">S03-smartmatch/any-any.t#L5-L29</a></p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">use</span> v6;</div><div class="line"><span class="keyword">use</span> Test;</div><div class="line">plan <span class="number">8</span>;</div><div class="line"></div><div class="line"><span class="comment">#L&lt;S03/Smart matching/Any Any scalars are identical&gt;</span></div><div class="line">&#123;</div><div class="line">    class Smartmatch::ObjTest &#123;&#125;</div><div class="line">    <span class="keyword">my</span> $a = Smartmatch::ObjTest.new;</div><div class="line">    <span class="keyword">my</span> $b = Smartmatch::ObjTest.new;</div><div class="line">    ok  ($a ~~  $a),    <span class="string">'Any ~~  Any (+)'</span>;</div><div class="line">    ok !($a !~~ $a),    <span class="string">'Any !~~ Any (-)'</span>;</div><div class="line">    ok !($a ~~  $b),    <span class="string">'Any ~~  Any (-)'</span>;</div><div class="line">    ok  ($a !~~ $b),    <span class="string">'Any !~~ Any (+)'</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">&#123;</div><div class="line">    $_ = <span class="number">42</span>;</div><div class="line">    <span class="keyword">my</span> $x;</div><div class="line">    <span class="string">'abc'</span> ~~ ($x = $_);</div><div class="line">    is $x, <span class="string">'abc'</span>, <span class="string">'~~ sets $_ to the LHS'</span>;</div><div class="line">    is $_, <span class="number">42</span>, <span class="string">'original $_ restored'</span>;</div><div class="line">    <span class="string">'defg'</span> !~~ ($x = $_);</div><div class="line">    is $x, <span class="string">'defg'</span>, <span class="string">'!~~ sets $_ to the LHS'</span>;</div><div class="line">    is $_, <span class="number">42</span>, <span class="string">'original $_ restored'</span>;</div><div class="line">    <span class="string">'defg'</span> !~~ ($x = $_);</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>
    
    <div>
      
        
<div style="text-align:center;color: #ccc;font-size:15px;">
------ Young For Perl 6! ------</div>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/智能匹配/" rel="tag">#智能匹配</a>
          
            <a href="/tags/smartmatch/" rel="tag">#smartmatch</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/08/02/Perl-6-Types-成人之美/" rel="next" title="Perl 6 Types--成人之美">
                <i class="fa fa-chevron-left"></i> Perl 6 Types--成人之美
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/08/09/Quoting-Constructs/" rel="prev" title="Quoting Constructs">
                Quoting Constructs <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2016/08/03/智能匹配/"
     data-title="智能匹配"
     data-content=""
     data-url="https://ohmycloud.github.io/2016/08/03/智能匹配/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/08/03/智能匹配/"
           data-title="智能匹配" data-url="https://ohmycloud.github.io/2016/08/03/智能匹配/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="焉知非鱼" />
          <p class="site-author-name" itemprop="name">焉知非鱼</p>
          <p class="site-description motion-element" itemprop="description">Young For Perl 6</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">161</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">177</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ohmycloud" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/740011611" target="_blank" title="weibo">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/9b20c7d63b77" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-location-arrow"></i>
                  
                  简书
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://perl6.org/" target="_blank" title="Perl 6">
                  
                    <i class="fa fa-fw fa-paper-plane"></i>
                  
                  Perl 6
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#智能匹配"><span class="nav-number">1.</span> <span class="nav-text">智能匹配</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">焉知非鱼</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  托管在 -
  <a class="theme-link" href="https://github.com/ohmycloud/ohmycloud.github.io">
    Github
  </a>
  &nbsp; | &nbsp;
</div>

<div class="theme-info">
 <a class="51-img" href="/images/footer.gif" target="_blank"><img alt="统计" src="/images/footer.gif"  align="right" /></a>
<div>
        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"chenyf"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  

  

  

</body>
</html>
