<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|monospace:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Examples,特性," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="Set
1234567891011my $keywords = set &amp;lt;if for unless while&amp;gt;; # create a setsub has-keyword(*@words) &amp;#123;    for @words -&amp;gt; $word &amp;#123;        return True if $word (elem) $keywords; # 依次检查数组中的">
<meta property="og:type" content="article">
<meta property="og:title" content="Perl 6 中的特性(二)">
<meta property="og:url" content="https://ohmycloud.github.io/2015/03/16/Perl6中的特性-二/index.html">
<meta property="og:site_name" content="Perl 6 青春小站">
<meta property="og:description" content="Set
1234567891011my $keywords = set &amp;lt;if for unless while&amp;gt;; # create a setsub has-keyword(*@words) &amp;#123;    for @words -&amp;gt; $word &amp;#123;        return True if $word (elem) $keywords; # 依次检查数组中的">
<meta property="og:updated_time" content="2016-10-23T16:44:09.747Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Perl 6 中的特性(二)">
<meta name="twitter:description" content="Set
1234567891011my $keywords = set &amp;lt;if for unless while&amp;gt;; # create a setsub has-keyword(*@words) &amp;#123;    for @words -&amp;gt; $word &amp;#123;        return True if $word (elem) $keywords; # 依次检查数组中的">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"hide"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://ohmycloud.github.io/2015/03/16/Perl6中的特性-二/"/>

  <title> Perl 6 中的特性(二) | Perl 6 青春小站 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Perl 6 青春小站</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>
 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Perl 6 中的特性(二)
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-03-16T00:00:00+08:00" content="2015-03-16">
              2015-03-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Perl-6/" itemprop="url" rel="index">
                    <span itemprop="name">Perl 6</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/03/16/Perl6中的特性-二/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/03/16/Perl6中的特性-二/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">my $keywords = set &lt;if for unless while&gt;; # create a set</div><div class="line"></div><div class="line">sub has-keyword(*@words) &#123;</div><div class="line">    for @words -&gt; $word &#123;</div><div class="line">        return True if $word (elem) $keywords; # 依次检查数组中的元素是否属于集合 $keywords</div><div class="line">    &#125;</div><div class="line">    False;</div><div class="line">&#125;</div><div class="line"></div><div class="line">say has-keyword &apos;not&apos;, &apos;one&apos;, &apos;here&apos;;       # False</div><div class="line">say has-keyword &apos;but&apos;, &apos;here&apos;, &apos;for&apos;;       # True</div></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="Series-Operator"><a href="#Series-Operator" class="headerlink" title="Series Operator"></a>Series Operator</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">my @a=&lt;A G C T&gt;;</div><div class="line">my $x=@a;</div><div class="line">for 1 ... * -&gt; $a &#123;  (( [X~] $x xx $a )).join(&apos;,&apos;).say;last if $a==4;   &#125;;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 倒序 range</div><div class="line">for 10 ... 0 &#123;</div><div class="line">    .say;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>flip/plop</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">use v6;</div><div class="line">my $file = open &apos;flip_flop.txt&apos;;</div><div class="line">for $file.lines -&gt; $line &#123;</div><div class="line">    say $line if !($line ~~ m/^\;/ ff $line ~~ m/^\&quot;/);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>$line ~~ m/^\;/ ff $line ~~ m/^\&quot;/</code> 过滤掉 <code>;</code> 和 <code>&quot;</code> 之间的内容, 再对它进行取反操作就是过滤后剩下的文本。</p>
<p>flip_flop.txt 内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">; next is some lines to skip,include this line</div><div class="line">fuck fuck fuck</div><div class="line">dam dam dam</div><div class="line">mie mie mie</div><div class="line">&quot; next is subject</div><div class="line">There is more than one way to do it</div><div class="line">                                -- Larry Wall</div><div class="line"></div><div class="line">We hope Perl6 is wrote by the hole Socfilia</div><div class="line">                                -- Larry Wall</div><div class="line">; next is some lines to skip,include this line</div><div class="line">fuck fuck fuck</div><div class="line">dam dam dam</div><div class="line">mie mie mie</div><div class="line">&quot; next is subject</div><div class="line">programming is hard,Let&apos;s go shopping</div><div class="line">                               -- Larry Wall</div><div class="line">Ruby is Another Perl6</div><div class="line">                               -- Larry Wall</div></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">There is more than one way to do it</div><div class="line">                                -- Larry Wall</div><div class="line">We hope Perl6 is wrote by the hole Socfilia</div><div class="line">                                -- Larry Wall</div><div class="line">programming is hard,Let&apos;s go shopping</div><div class="line">                               -- Larry Wall</div><div class="line">Ruby is Another Perl6</div><div class="line">                               -- Larry Wall</div></pre></td></tr></table></figure>
<p>ff 操作符左右两侧的 <code>^</code> 表示排除:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">for 1..20 &#123;.say if $_==9 ff $_==16&#125;</div><div class="line">say &apos;-&apos; x 10;</div><div class="line">for 1..20 &#123;.say if $_==9 ^ff $_==16&#125;</div><div class="line">say &apos;-&apos; x 10;</div><div class="line">for 1..20 &#123;.say if $_==9 ff^ $_==16&#125;</div><div class="line">say &apos;-&apos; x 10;</div><div class="line">for 1..20 &#123;.say if $_==9 ^ff^ $_==16&#125;</div><div class="line"></div><div class="line">输出：</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">----------</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">----------</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">----------</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># 无限循环</div><div class="line">loop &#123;</div><div class="line">    say &apos;SPAM&apos;;</div><div class="line">&#125;</div><div class="line"></div><div class="line"># In addition, there are various ways of writing lazy, infinite lists in Perl 6:</div><div class="line">print &quot;SPAM\n&quot; xx *;      # repetition operator</div><div class="line">print &quot;SPAM\n&quot;, ~* ... *; # sequence operator</div><div class="line">map &#123;say &quot;SPAM&quot;&#125;, ^Inf;   # upto operator</div></pre></td></tr></table></figure>
<h2 id="Grammars"><a href="#Grammars" class="headerlink" title="Grammars"></a>Grammars</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">use v6;</div><div class="line"></div><div class="line">BEGIN &#123;</div><div class="line">    @*INC.push(&apos;/Volumes/WORK/1-Books/3-Perl6/examples/笔记/Grammars&apos;);</div><div class="line">&#125;</div><div class="line">use Add1;</div><div class="line"></div><div class="line">my @experssions = (</div><div class="line">    &quot;2 + 3&quot;,</div><div class="line">    &quot;2 + 4 &quot;,</div><div class="line">    &quot;2 + 3 x&quot;,</div><div class="line">    &quot;2 +&quot;,</div><div class="line">    &quot;2 3&quot;,</div><div class="line">    &quot;2 - 3&quot;,</div><div class="line">);</div><div class="line"></div><div class="line">for @experssions -&gt; $exp &#123;</div><div class="line">    print $exp, &quot; &quot;;</div><div class="line">    my $result = Add1.parse($exp);</div><div class="line">    say $result ?? &apos;OK&apos; !! &apos;NOT OK&apos;;</div><div class="line">    CATCH &#123;</div><div class="line">        say &quot;exception received: $!&quot;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">use v6;</div><div class="line"></div><div class="line">BEGIN &#123;</div><div class="line">    @*INC.push(&apos;/Volumes/WORK/1-Books/3-Perl6/examples/笔记/Grammars&apos;);</div><div class="line">&#125;</div><div class="line">use Add2;</div><div class="line"></div><div class="line">my @experssions = (</div><div class="line">    &quot;2 + 3&quot;,</div><div class="line">    &quot;2 + 4 &quot;,</div><div class="line">    &quot;2 + 3 x&quot;,</div><div class="line">    &quot;2 +&quot;,</div><div class="line">    &quot;2 3&quot;,</div><div class="line">    &quot;2 - 3&quot;,</div><div class="line">);</div><div class="line"></div><div class="line">for @experssions -&gt; $exp &#123;</div><div class="line">    print $exp, &quot; &quot;;</div><div class="line">    my $result = Add2.parse($exp);</div><div class="line">    say $result ?? &apos;OK&apos; !! &apos;NOT OK&apos;;</div><div class="line">    CATCH &#123;</div><div class="line">        say &quot;exception received: $!&quot;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">grammar CardGame &#123;</div><div class="line"></div><div class="line">    rule TOP &#123; ^ &lt;deal&gt; $ &#125;</div><div class="line"></div><div class="line">    rule deal &#123;</div><div class="line">        &lt;hand&gt;+ % &apos;;&apos;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    rule hand &#123; [ &lt;card&gt; ]**5 &#125;</div><div class="line">    token card &#123;&lt;face&gt;&lt;suit&gt;&#125;</div><div class="line"></div><div class="line">    proto token suit &#123;*&#125;</div><div class="line">    token suit:sym&lt;♥&gt;  &#123;&lt;sym&gt;&#125;</div><div class="line">    token suit:sym&lt;♦&gt;  &#123;&lt;sym&gt;&#125;</div><div class="line">    token suit:sym&lt;♣&gt;  &#123;&lt;sym&gt;&#125;</div><div class="line">    token suit:sym&lt;♠&gt;  &#123;&lt;sym&gt;&#125;</div><div class="line"></div><div class="line">    token face &#123;:i &lt;[2..9]&gt; | 10 | j | q | k | a &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">say CardGame.parse(&quot;2♥ 5♥ 7♦ 8♣ 9♠&quot;);</div><div class="line">say CardGame.parse(&quot;2♥ a♥ 7♦ 8♣ j♥&quot;);</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">grammar CardGame &#123;</div><div class="line"></div><div class="line">    rule TOP &#123; ^ &lt;deal&gt; $ &#125;</div><div class="line"></div><div class="line">    rule deal &#123;</div><div class="line">       :my %*PLAYED = ();</div><div class="line">       &lt;hand&gt;+ % &apos;;&apos;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    rule hand &#123; [ &lt;card&gt; ]**5 &#125;</div><div class="line">    token card &#123;&lt;face&gt;&lt;suit&gt;&#125;</div><div class="line"></div><div class="line">    proto token suit &#123;*&#125;</div><div class="line">    token suit:sym&lt;♥&gt;  &#123;&lt;sym&gt;&#125;</div><div class="line">    token suit:sym&lt;♦&gt;  &#123;&lt;sym&gt;&#125;</div><div class="line">    token suit:sym&lt;♣&gt;  &#123;&lt;sym&gt;&#125;</div><div class="line">    token suit:sym&lt;♠&gt;  &#123;&lt;sym&gt;&#125;</div><div class="line"></div><div class="line">    token face &#123;:i &lt;[2..9]&gt; | 10 | j | q | k | a &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class CardGame::Actions &#123;</div><div class="line">    method card($/) &#123;</div><div class="line">       my $card = $/.lc;</div><div class="line">       say &quot;Hey, there&apos;s an extra $card&quot;</div><div class="line">           if %*PLAYED&#123;$card&#125;++;</div><div class="line">   &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $a = CardGame::Actions.new;</div><div class="line">say CardGame.parse(&quot;a♥ a♥ 7♦ 8♣ j♥&quot;, :actions($a));</div><div class="line"># &quot;Hey there&apos;s an extra a♥&quot;</div><div class="line">say CardGame.parse(&quot;a♥ 7♥ 7♦ 8♣ j♥; 10♥ j♥ q♥ k♥ a♦&quot;,</div><div class="line">                   :actions($a));</div><div class="line"># &quot;Hey there&apos;s an extra j♥&quot;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">﻿use v6;</div><div class="line"></div><div class="line">my %dict;</div><div class="line"></div><div class="line">grammar WordPairs &#123;</div><div class="line">    token TOP &#123; &lt;word-pair&gt;* &#125;</div><div class="line">    token word-pair &#123; (\S*) &apos; &apos; (\S*) &quot;\n&quot; &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class WordPairsActions &#123;</div><div class="line">    method word-pair($/) &#123; %dict&#123;$0&#125;.push($1) &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $match = WordPairs.parse(&quot;&#123;@*ARGS[0]&#125;&quot;.IO.slurp, :actions(WordPairsActions));</div><div class="line">say ?$match;</div><div class="line"></div><div class="line">say &quot;The pairs count of the key word \&quot;her\&quot; in wordpairs.txt is &#123;%dict&#123;&quot;her&quot;&#125;.elems&#125;&quot;;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">﻿use v6;</div><div class="line"></div><div class="line">my $file=open &quot;test.txt&quot;, :r;</div><div class="line"></div><div class="line">my %dict;</div><div class="line">my $line;</div><div class="line"></div><div class="line">repeat &#123;</div><div class="line">    $line=$file.get;</div><div class="line">    my ($p1,$p2)=$line.split(&apos; &apos;);</div><div class="line">    if ?%dict&#123;$p1&#125; &#123;</div><div class="line">        %dict&#123;$p1&#125; = &quot;&#123;%dict&#123;$p1&#125;&#125; &#123;$p2&#125;&quot;.words;</div><div class="line">    &#125; else &#123;</div><div class="line">        %dict&#123;$p1&#125; = $p2;</div><div class="line">    &#125;</div><div class="line">&#125; while !$file.eof;</div><div class="line"></div><div class="line">## Test</div><div class="line">say &quot;The pairs count of the key word \&quot;was\&quot; in wordpairs.txt is &#123;%dict&#123;&quot;was&quot;&#125;.elems&#125;&quot;;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">﻿grammar CSV &#123;</div><div class="line">    token TOP &#123; [ &lt;line&gt; \n? ]+ &#125;</div><div class="line">    token line &#123;</div><div class="line">        ^^            # Beginning of a line</div><div class="line">        &lt;value&gt;* % \, # Any number of &lt;value&gt;s with commas in `between` them</div><div class="line">        $$            # End of a line</div><div class="line">    &#125;</div><div class="line">    token value &#123;</div><div class="line">        [</div><div class="line">        | &lt;-[&quot;,\n]&gt;     # Anything not a double quote, comma or newline</div><div class="line">        | &lt;quoted-text&gt; # Or some quoted text</div><div class="line">        ]*              # Any number of times</div><div class="line">    &#125;</div><div class="line">    token quoted-text &#123;</div><div class="line">        \&quot;</div><div class="line">        [</div><div class="line">        | &lt;-[&quot;\\]&gt; # Anything not a &quot; or \</div><div class="line">        | &apos;\&quot;&apos;     # Or \&quot;, an escaped quotation mark</div><div class="line">        ]*         # Any number of times</div><div class="line">        \&quot;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"># method parse($str, :$rule = &apos;TOP&apos;, :$actions) returns Match:D</div><div class="line">say &quot;Valid CSV file!&quot; if CSV.parse( q:to/EOCSV/ );</div><div class="line">    Year,Make,Model,Length</div><div class="line">    1997,Ford,E350,2.34</div><div class="line">    2000,Mercury,Cougar,2.38</div><div class="line">    EOCSV</div><div class="line"></div><div class="line">say CSV.parse( q:to/EOCSV/, &apos;line&apos;, :$actions );</div><div class="line">    Year,Make,Model,Length</div><div class="line">    1997,Ford,E350,2.34</div><div class="line">    2000,Mercury,Cougar,2.38</div><div class="line">    EOCSV</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">﻿grammar MyGrammar &#123;</div><div class="line">    token chunk &#123;</div><div class="line">        &#123; say &quot;chunk: called&quot; &#125;</div><div class="line">        ^^</div><div class="line">        &#123; say &quot;chunk: found start of line&quot; &#125;</div><div class="line">        (\S+)</div><div class="line">        &#123; say &quot;chunk: found first identifier: $0&quot; &#125;</div><div class="line">		#(\s*)</div><div class="line">		#&#123;say &quot;chunk: found space&quot;&#125;</div><div class="line">        \=</div><div class="line">        &#123; say &quot;chunk: found =&quot; &#125;</div><div class="line">		#(\s*)</div><div class="line">		#&#123;say &quot;chunk: found space&quot;&#125;</div><div class="line">        (\S+) $$</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">say ?MyGrammar.parse(&quot;foo = bar&quot;, :rule&lt;chunk&gt;);</div><div class="line"></div><div class="line"># output:</div><div class="line">#</div><div class="line"># chunk: called</div><div class="line"># chunk: found start of line</div><div class="line"># chunk: found fist identifer: foo</div><div class="line"># False</div><div class="line"></div><div class="line">#You can see that the rule matched the start of the line, and foo, but not the equals sign. What&apos;s between the two? A space. For which there is no rule to match it. Making chunk a rule instead of a token fixes this problem.</div><div class="line"># 因为 (\S+)后面有一个空格, \= 后面也有个空格, rule 能识别空格</div><div class="line"></div><div class="line"># E:\1-技术书籍\Perl6\examples\Grammars&gt;perl6 -e &quot;&apos;aabcd&apos; ~~ /^ (.*)&#123;say $0.Str&#125; b/&quot;</div><div class="line">#aabcd</div><div class="line">#aabc</div><div class="line">#aab</div><div class="line">#aa</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">﻿grammar Perl6VariableNames &#123;</div><div class="line"></div><div class="line">    token variable &#123;</div><div class="line">        &lt;sigil&gt; &lt;name&gt;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    #token sigil &#123;</div><div class="line">    #    &apos;$&apos; | &apos;@&apos; | &apos;&amp;&apos; | &apos;%&apos; | &apos;::&apos;</div><div class="line">    #&#125;</div><div class="line"></div><div class="line">    # 使用 proto</div><div class="line">	proto token sigil &#123;*&#125;</div><div class="line">    token sigil:sym&lt;$&gt;  &#123; &lt;sym&gt; &#125;</div><div class="line">    token sigil:sym&lt;@&gt;  &#123; &lt;sym&gt; &#125;</div><div class="line">    token sigil:sym&lt;%&gt;  &#123; &lt;sym&gt; &#125;</div><div class="line">    token sigil:sym&lt;&amp;&gt;  &#123; &lt;sym&gt; &#125;</div><div class="line">    token sigil:sym&lt;::&gt; &#123; &lt;sym&gt; &#125;</div><div class="line"></div><div class="line">	# [ ... ] are non-capturing groups</div><div class="line">	token name &#123;</div><div class="line">        &lt;identifier&gt;</div><div class="line">        [ &apos;::&apos; &lt;identifier&gt; ] *</div><div class="line">    &#125;</div><div class="line">	# 标识符以字母开头</div><div class="line">    token identifier &#123;</div><div class="line">        &lt;alpha&gt; \w+</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $match = Perl6VariableNames.parse(&quot;@array&quot;,:rule(&apos;variable&apos;));</div><div class="line">say $match;</div><div class="line"></div><div class="line">grammar SigilRichPerl6 is Perl6VariableNames &#123;</div><div class="line">    token sigil:sym&lt;ħ&gt; &#123; &lt;sym&gt; &#125; # physicists will love you</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $rich = SigilRichPerl6.parse(&quot;ħarray&quot;,:rule(&apos;variable&apos;));</div><div class="line">say $rich;</div><div class="line"></div><div class="line">grammar LowBudgetPerl6 is Perl6VariableNames &#123;</div><div class="line">    token sigil:sym&lt;$&gt; &#123; &apos;¢&apos; &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $money = LowBudgetPerl6.parse(&apos;$array&apos;,:rule(&apos;variable&apos;));</div><div class="line">say $money;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">grammar StationDataParser &#123;</div><div class="line">    token TOP          &#123; ^ &lt;keyval&gt;+ &lt;observations&gt; $             &#125;</div><div class="line">    token keyval       &#123; $&lt;key&gt;=[&lt;-[=]&gt;+] &apos;=&apos; \h* $&lt;val&gt;=[\N+] \n &#125;</div><div class="line">    token observations &#123; &apos;Obs:&apos; \h* \n &lt;observation&gt;+             &#125;</div><div class="line">    token observation  &#123; $&lt;year&gt;=[\d+] \h* &lt;temp&gt;+ %% [\h*] \n    &#125;</div><div class="line">    token temp         &#123; &apos;-&apos;? \d+ \. \d+                          &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class StationData &#123;</div><div class="line">    has $.name;</div><div class="line">    has $.country;</div><div class="line">    has @.data;</div><div class="line"></div><div class="line">    submethod BUILD(:%info (:Name($!name), :Country($!country), *%), :@!data) &#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class StationDataActions &#123;</div><div class="line">    method TOP($/) &#123;</div><div class="line">        make StationData.new(</div><div class="line">            info =&gt; $&lt;keyval&gt;.map(*.ast).hash,</div><div class="line">            data =&gt; $&lt;observations&gt;.ast</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    method keyval($/) &#123;</div><div class="line">        make ~$&lt;key&gt; =&gt; ~$&lt;val&gt;;</div><div class="line">    &#125;</div><div class="line">    method observations($/) &#123;</div><div class="line">        make $&lt;observation&gt;.map(*.ast).grep(*.value.none &lt;= -99);</div><div class="line">    &#125;</div><div class="line">    method observation($/) &#123;</div><div class="line">        make +$&lt;year&gt; =&gt; $&lt;temp&gt;.map(*.Num);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">say StationDataParser.parse( q:to/EOCSV/, :actions(StationDataActions)).ast</div><div class="line">Name= Jan Mayen</div><div class="line">Country= NORWAY</div><div class="line">Lat=   70.9</div><div class="line">Long=    8.7</div><div class="line">Height= 10</div><div class="line">Start year= 1921</div><div class="line">End year= 2009</div><div class="line">Obs:</div><div class="line">1921 -4.4 -7.1 -6.8 -4.3 -0.8  2.2  4.7  5.8  2.7 -2.0 -2.1 -4.0  </div><div class="line">1922 -0.9 -1.7 -6.2 -3.7 -1.6  2.9  4.8  6.3  2.7 -0.2 -3.8 -2.6  </div><div class="line">2008 -2.8 -2.7 -4.6 -1.8  1.1  3.3  6.1  6.9  5.8  1.2 -3.5 -0.8  </div><div class="line">2009 -2.3 -5.3 -3.2 -1.6  2.0  2.9  6.7  7.2  3.8  0.6 -0.3 -1.3</div><div class="line">EOCSV</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"># file lib/JSON/Tiny/Grammar.pm</div><div class="line"></div><div class="line"> grammar JSON::Tiny::Grammar &#123;</div><div class="line">     rule TOP      &#123; ^[ &lt;object&gt; | &lt;array&gt; ]$ &#125;</div><div class="line">     rule object   &#123; &apos;&#123;&apos; ~ &apos;&#125;&apos; &lt;pairlist&gt;     &#125;</div><div class="line">     rule pairlist &#123; &lt;pair&gt;* % [ \, ]         &#125;</div><div class="line">     rule pair     &#123; &lt;string&gt; &apos;:&apos; &lt;value&gt;     &#125;</div><div class="line">     rule array    &#123; &apos;[&apos; ~ &apos;]&apos; [ &lt;value&gt;* % [ \, ] ] &#125;</div><div class="line"></div><div class="line"> proto token value &#123; &lt;...&gt; &#125;;</div><div class="line"></div><div class="line"> token value:sym&lt;number&gt; &#123;</div><div class="line">     &apos;-&apos;?</div><div class="line">     [ 0 | &lt;[1..9]&gt; &lt;[0..9]&gt;* ]</div><div class="line">     [ \. &lt;[0..9]&gt;+ ]?</div><div class="line">     [ &lt;[eE]&gt; [\+|\-]? &lt;[0..9]&gt;+ ]?</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> token value:sym&lt;true&gt;   &#123; &lt;sym&gt;    &#125;;</div><div class="line"> token value:sym&lt;false&gt;  &#123; &lt;sym&gt;    &#125;;</div><div class="line"> token value:sym&lt;null&gt;   &#123; &lt;sym&gt;    &#125;;</div><div class="line"> token value:sym&lt;object&gt; &#123; &lt;object&gt; &#125;;</div><div class="line"> token value:sym&lt;array&gt;  &#123; &lt;array&gt;  &#125;;</div><div class="line"> token value:sym&lt;string&gt; &#123; &lt;string&gt; &#125;</div><div class="line"></div><div class="line"> token string &#123;</div><div class="line">     \&quot; ~ \&quot; [ &lt;str&gt; | \\ &lt;str_escape&gt; ]*</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> token str &#123;</div><div class="line">     [</div><div class="line">         &lt;!before \t&gt;</div><div class="line">         &lt;!before \n&gt;</div><div class="line">         &lt;!before \\&gt;</div><div class="line">         &lt;!before \&quot;&gt;</div><div class="line">         .</div><div class="line">     ]+</div><div class="line">     # &lt;-[&quot;\\\t\n]&gt;+</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> token str_escape &#123;</div><div class="line">     &lt;[&quot;\\/bfnrt]&gt; | u &lt;xdigit&gt;**4</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> &#125;</div><div class="line"></div><div class="line"></div><div class="line"> # test it:</div><div class="line"> my $tester = &apos;&#123;</div><div class="line">     &quot;country&quot;: &quot;Austria&quot;,</div><div class="line">     &quot;cities&quot;: [ &quot;Wien&quot;, &quot;Salzburg&quot;, &quot;Innsbruck&quot; ],</div><div class="line">     &quot;population&quot;: 8353243</div><div class="line"> &#125;&apos;;</div><div class="line"></div><div class="line"> if JSON::Tiny::Grammar.parse($tester) &#123;</div><div class="line">     say &quot;It&apos;s valid JSON&quot;;</div><div class="line"> &#125; else &#123;</div><div class="line">     # TODO: error reporting</div><div class="line">     say &quot;Not quite...&quot;;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line">grammar JSON::Tiny::Grammar &#123;</div><div class="line">     rule TOP      &#123; ^[ &lt;object&gt; | &lt;array&gt; ]$ &#125;</div><div class="line">     rule object   &#123; &apos;&#123;&apos; ~ &apos;&#125;&apos; &lt;pairlist&gt;     &#125;</div><div class="line">     rule pairlist &#123; &lt;pair&gt;* % [ \, ]         &#125;</div><div class="line">     rule pair     &#123; &lt;string&gt; &apos;:&apos; &lt;value&gt;     &#125;</div><div class="line">     rule array    &#123; &apos;[&apos; ~ &apos;]&apos; [ &lt;value&gt;* % [ \, ] ] &#125;</div><div class="line"></div><div class="line"> proto token value &#123; &lt;...&gt; &#125;;</div><div class="line"></div><div class="line"> token value:sym&lt;number&gt; &#123;</div><div class="line">     &apos;-&apos;?</div><div class="line">     [ 0 | &lt;[1..9]&gt; &lt;[0..9]&gt;* ]</div><div class="line">     [ \. &lt;[0..9]&gt;+ ]?</div><div class="line">     [ &lt;[eE]&gt; [\+|\-]? &lt;[0..9]&gt;+ ]?</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> token value:sym&lt;true&gt;   &#123; &lt;sym&gt;    &#125;;</div><div class="line"> token value:sym&lt;false&gt;  &#123; &lt;sym&gt;    &#125;;</div><div class="line"> token value:sym&lt;null&gt;   &#123; &lt;sym&gt;    &#125;;</div><div class="line"> token value:sym&lt;object&gt; &#123; &lt;object&gt; &#125;;</div><div class="line"> token value:sym&lt;array&gt;  &#123; &lt;array&gt;  &#125;;</div><div class="line"> token value:sym&lt;string&gt; &#123; &lt;string&gt; &#125;</div><div class="line"></div><div class="line"> token string &#123;</div><div class="line">     \&quot; ~ \&quot; [ &lt;str&gt; | \\ &lt;str_escape&gt; ]*</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> token str &#123;</div><div class="line">     [</div><div class="line">         &lt;!before \t&gt;</div><div class="line">         &lt;!before \n&gt;</div><div class="line">         &lt;!before \\&gt;</div><div class="line">         &lt;!before \&quot;&gt;</div><div class="line">         .</div><div class="line">     ]+</div><div class="line">     # &lt;-[&quot;\\\t\n]&gt;+</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> token str_escape &#123;</div><div class="line">     &lt;[&quot;\\/bfnrt]&gt; | u &lt;xdigit&gt;**4</div><div class="line"> &#125;</div><div class="line"></div><div class="line"> &#125;</div><div class="line"></div><div class="line"></div><div class="line"> # test it:</div><div class="line"> my $tester = &apos;&#123;</div><div class="line">     &quot;country&quot;: &quot;Austria&quot;,</div><div class="line">     &quot;cities&quot;: [ &quot;Wien&quot;, &quot;Salzburg&quot;, &quot;Innsbruck&quot; ],</div><div class="line">     &quot;population&quot;: 8353243</div><div class="line"> &#125;&apos;;</div><div class="line"></div><div class="line"> if JSON::Tiny::Grammar.parse($tester) &#123;</div><div class="line">     say &quot;It&apos;s valid JSON&quot;;</div><div class="line"> &#125; else &#123;</div><div class="line">     # TODO: error reporting</div><div class="line">     say &quot;Not quite...&quot;;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">class JSON::Tiny::Actions &#123;</div><div class="line">    method TOP($/)      &#123; make $/.values.[0].ast              &#125;</div><div class="line">    method object($/)   &#123; make $&lt;pairlist&gt;.ast.hash           &#125;</div><div class="line">    method pairlist($/) &#123; make $&lt;pair&gt;&gt;&gt;.ast                  &#125;</div><div class="line">    method pair($/)     &#123; make $&lt;string&gt;.ast =&gt; $&lt;value&gt;.ast  &#125;</div><div class="line">    method array($/)    &#123; make [$&lt;value&gt;&gt;&gt;.ast]               &#125;</div><div class="line">    method string($/)   &#123; make join &apos;&apos;, $/.caps&gt;&gt;.value&gt;&gt;.ast &#125;</div><div class="line"></div><div class="line"> # TODO: make that</div><div class="line"> # make +$/</div><div class="line"> # once prefix:&lt;+&gt; is sufficiently polymorphic</div><div class="line">method value:sym&lt;number&gt;($/) &#123; make try $/        &#125;</div><div class="line">method value:sym&lt;string&gt;($/) &#123; make $&lt;string&gt;.ast &#125;</div><div class="line">method value:sym&lt;true&gt;  ($/) &#123; make Bool::True    &#125;</div><div class="line">method value:sym&lt;false&gt; ($/) &#123; make Bool::False   &#125;</div><div class="line">method value:sym&lt;null&gt;  ($/) &#123; make Any           &#125;</div><div class="line">method value:sym&lt;object&gt;($/) &#123; make $&lt;object&gt;.ast &#125;</div><div class="line">method value:sym&lt;array&gt; ($/) &#123; make $&lt;array&gt;.ast  &#125;</div><div class="line">method str($/)               &#123; make ~$/           &#125;</div><div class="line"></div><div class="line">method str_escape($/) &#123;</div><div class="line">    if $&lt;xdigit&gt; &#123;</div><div class="line">        make chr(:16($&lt;xdigit&gt;.join));</div><div class="line">    &#125; else &#123;</div><div class="line">        my %h = &apos;\\&apos; =&gt; &quot;\\&quot;,</div><div class="line">        &apos;n&apos; =&gt; &quot;\n&quot;,</div><div class="line">        &apos;t&apos; =&gt; &quot;\t&quot;,</div><div class="line">        &apos;f&apos; =&gt; &quot;\f&quot;,</div><div class="line">        &apos;r&apos; =&gt; &quot;\r&quot;;</div><div class="line">        make %h&#123;$/&#125;;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $actions = JSON::Tiny::Actions.new();</div><div class="line">my $data_structure = JSON::Tiny::Grammar.parse($tester, &apos;TOP&apos;, :$actions);</div><div class="line">say $data_structure;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">﻿use v6;</div><div class="line"></div><div class="line">grammar KeyValuePairs &#123;</div><div class="line">    token TOP &#123;</div><div class="line">	    [ &lt;pair&gt; \n+ ]*</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	token ws &#123; \h* &#125;</div><div class="line"></div><div class="line">	rule pair &#123;</div><div class="line">	    &lt;key=.identifier&gt; &apos;=&apos; &lt;value=.identifier&gt;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	token identifier &#123; \w+ &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class KeyValuePairsActions &#123;</div><div class="line">    method identifier($/)  &#123; make ~$/                   &#125;</div><div class="line">	method pair      ($/)  &#123; make ~$&lt;key&gt; =&gt; ~$&lt;value&gt;  &#125;</div><div class="line">	method TOP       ($/)  &#123; make $&lt;pair&gt;&gt;&gt;.made        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $string = q:to/EOI/;</div><div class="line">second=b</div><div class="line">hits=42</div><div class="line">perl=6</div><div class="line">EOI</div><div class="line"></div><div class="line">my $actions = KeyValuePairsActions.new;</div><div class="line">my $match = KeyValuePairs.parse($string, :$actions).made;</div><div class="line"></div><div class="line">for @$match -&gt; $p &#123;</div><div class="line">    say &quot;key: $p.key()\tValue: $p.value()&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">#use Module::Name::Actions;</div><div class="line">grammar Legal-Module-Name &#123;</div><div class="line">  token TOP &#123;</div><div class="line"></div><div class="line">	# identifier followed by zero or more separator identifier pairs</div><div class="line">    ^ &lt;identifier&gt; [&lt;separator&gt;&lt;identifier&gt;] ** 0..* $</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  token identifier  &#123;</div><div class="line">    # leading alpha or _ only</div><div class="line">    &lt;[A..Za..z_]&gt;</div><div class="line">    &lt;[A..Za..z0..9]&gt; ** 0..*</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  token separator  &#123;</div><div class="line">    &apos;::&apos; # colon pairs</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class Module::Name::Actions &#123;</div><div class="line">  method TOP($/)</div><div class="line">  &#123; make $/.values.ast ~ &apos;-----&apos;;</div><div class="line">    if $&lt;identifier&gt;.elems &gt; 5</div><div class="line">    &#123;</div><div class="line">      warn &apos;Module name has a lot of identifiers, consider simplifying the name&apos;;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $proposed_module_name = &apos;Superoooo::Newoooo::Moduleooooooooooo&apos;;</div><div class="line"></div><div class="line">my $actions = Module::Name::Actions.new();</div><div class="line">my $match_obj = Legal-Module-Name.parse($proposed_module_name, :actions($actions));</div><div class="line"></div><div class="line">say $match_obj.Str;</div></pre></td></tr></table></figure>
<p>我写的第一个 Grammar, 修改了很多次, 借助于 <code>Grammar::Debugger</code> 和 <code>Grammar::Tracer</code> 能方便地看出 Grammar 在哪里失败。<code>TOP</code> 里面添加了 <code>^</code> 和 <code>$</code> 限制时, 其后面的 token 和 rule 不能再添加 <code>^</code> 和 <code>$</code>, 否则匹配失败。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div></pre></td><td class="code"><pre><div class="line">use Grammar::Debugger;</div><div class="line">use Grammar::Tracer;</div><div class="line"></div><div class="line">use v6;</div><div class="line">grammar Markdown::Toc &#123;</div><div class="line">    # token TOP   is breakpoint    &#123;^ \s* &lt;section&gt;* $&#125;</div><div class="line">	token TOP    &#123;^ \s* &lt;section&gt;* $&#125;</div><div class="line">	token section   &#123;</div><div class="line">	    &lt;sname&gt;  &lt;ws&gt; \n</div><div class="line">	    &lt;lines&gt;*</div><div class="line">	    &lt;subsection&gt;+</div><div class="line">	&#125;</div><div class="line"></div><div class="line">    token subsection  &#123;</div><div class="line">    	&lt;subsname&gt; &lt;ws&gt; \n</div><div class="line">        &lt;lines&gt;*</div><div class="line">        &lt;s2section&gt; *</div><div class="line">	&#125;</div><div class="line"></div><div class="line">    token s2section &#123;</div><div class="line">	    &lt;s2name&gt; &lt;ws&gt; \n</div><div class="line">		&lt;lines&gt;*</div><div class="line">    &#125;</div><div class="line"></div><div class="line">	token sname          &#123; &lt;sigil2&gt;   &lt;ws&gt; &lt;snumber=.hnumber&gt;  &lt;ws&gt; &lt;shead=.hline&gt;     &#125;</div><div class="line">	token subsname       &#123; &lt;sigil3&gt;   &lt;ws&gt; &lt;subnumber=.number&gt; &lt;ws&gt; &lt;shline=.hline&gt;    &#125;</div><div class="line">	token s2name         &#123; &lt;sigil4&gt;   &lt;ws&gt; &lt;s2number=.number&gt;  &lt;ws&gt; &lt;s2hline=.hline&gt;   &#125;</div><div class="line">	token lines          &#123;</div><div class="line">	    [</div><div class="line">		    &lt;!after &apos;#&apos; ** 2..* &gt;</div><div class="line">            \N</div><div class="line">        ]+</div><div class="line">	    \n</div><div class="line">	&#125;</div><div class="line">	token number &#123;</div><div class="line">	    \d+ % \.</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	token hline &#123;</div><div class="line">	    \N+</div><div class="line">	&#125;</div><div class="line">	token hnumber &#123; \w+      &#125;</div><div class="line">	token ws      &#123; \h*      &#125;</div><div class="line">	token sigil2  &#123; &apos;#&apos; ** 2 &#125;</div><div class="line">	token sigil3  &#123; &apos;#&apos; ** 3 &#125;</div><div class="line">	token sigil4  &#123; &apos;#&apos; ** 4 &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $str = q:to/EOF/;</div><div class="line">## 第四章 子例程和签名</div><div class="line"></div><div class="line"></div><div class="line">一个子例程就是一段执行特殊任务的代码片段。它可以对提供的数据（`实参`）操作，并产生结果（返回值）。子例程的签名是它`所含的参数`和它产生的`返回值`的描述。从某一意义上来说，第三章描述的操作符也是Perl 6用特殊方式解释的子例程。</div><div class="line"></div><div class="line">### 4.1.0 申明子例程</div><div class="line"></div><div class="line"> 一个子例程申明由几部分组成。首先， `sub `表明你在申明一个子例程，然后是可选的子例程的名称和`可选的签名`。子例程的主体是一个用花括号扩起来的代码块。</div><div class="line">默认的，子例程是本地作用域的，就像任何使用 `my` 申明的变量一样。这意味着，一个子例程只能在它被申明的作用域内被调用。使用 `our` 来申明子例程可以使其在`当前包`中可见。</div><div class="line">EOF</div><div class="line"></div><div class="line">class Markdown::Toc::Actions &#123;</div><div class="line">	method s2section($/)        &#123;</div><div class="line">	    my $first = ~$&lt;s2name&gt;&lt;s2number&gt;;</div><div class="line">	    my $second = ~$&lt;s2name&gt;&lt;s2hline&gt;;</div><div class="line">		my $remove_dot = $first.subst(rx/\./,&apos;&apos;,:g);</div><div class="line">		my $remove_space = $second.subst(rx/\s+/,&apos;-&apos;,:g);</div><div class="line">		make &apos;    - &apos;~&apos;[&apos;~$first~&apos; &apos;~$second~&apos;]&apos; ~ &apos;(#&apos;~$remove_dot~$remove_space ~ &apos;)&apos; =&gt; $&lt;s2section&gt;&gt;&gt;.made;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	method subsection($/) &#123;</div><div class="line">	    my $first = ~$&lt;subsname&gt;&lt;subnumber&gt;;</div><div class="line">	    my $second = ~$&lt;subsname&gt;&lt;shline&gt;;</div><div class="line">		my $remove_dot = $first.subst(rx/\./,&apos;&apos;,:g);</div><div class="line">		my $remove_space = $second.subst(rx/\s+/,&apos;-&apos;,:g);</div><div class="line">		make &apos;  - &apos;~&apos;[&apos;~$first~&apos; &apos;~$second~&apos;]&apos; ~ &apos;(#&apos;~$remove_dot~$remove_space ~ &apos;)&apos;	=&gt; $&lt;s2section&gt;&gt;&gt;.made;  </div><div class="line">	&#125;</div><div class="line"></div><div class="line">    method section($/)    &#123;</div><div class="line">	    my $first = ~$&lt;sname&gt;&lt;snumber&gt;;</div><div class="line">		my $second = ~$&lt;sname&gt;&lt;shead&gt;;</div><div class="line">		#my $remove_dot = $first.subst(rx/\./,&apos;&apos;,:g);</div><div class="line">		my $remove_space = $second.subst(rx/\s+/,&apos;&apos;,:g);</div><div class="line">	    make &apos;- &apos;~&apos;[&apos;~$first~&apos; &apos;~$second~&apos;]&apos; ~ &apos;(#&apos;~$first~ &apos;-&apos;~$remove_space ~ &apos;)&apos;  =&gt; $&lt;subsection&gt;&gt;&gt;.made;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">    method TOP($/)    &#123; make $&lt;section&gt;&gt;&gt;.made;                                                            &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">my $actions = Markdown::Toc::Actions.new;</div><div class="line">my $match  = Markdown::Toc.parse($str, :$actions).made;</div><div class="line">#say $match.Str;</div><div class="line"></div><div class="line">for @$match -&gt; $p &#123;</div><div class="line">    say $p.key();</div><div class="line">    for $p.value() -&gt; $v &#123;</div><div class="line">        for $v -&gt; $n &#123;</div><div class="line">		   .say for $n.hash().keys();</div><div class="line">		   for $n.hash().values() -&gt; $three &#123;</div><div class="line">		       .say for $three.hash().keys();</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div></pre></td><td class="code"><pre><div class="line">#use Grammar::Debugger;</div><div class="line">#use Grammar::Tracer;</div><div class="line"></div><div class="line">use v6;</div><div class="line">grammar Markdown::Toc &#123;</div><div class="line">    # token TOP   is breakpoint    &#123;^ \s* &lt;section&gt;* $&#125;</div><div class="line">	token TOP    &#123;^ \s* &lt;section&gt;* $&#125;</div><div class="line">	token section   &#123;</div><div class="line">	    &lt;sname&gt; &lt;ws&gt;</div><div class="line">		&lt;lines&gt;*</div><div class="line">	    &lt;subsection&gt;+</div><div class="line">	&#125;</div><div class="line"></div><div class="line">    token subsection  &#123;</div><div class="line">    	&lt;subsname&gt; &lt;ws&gt;</div><div class="line">        &lt;lines&gt;*</div><div class="line">        &lt;s2section&gt; *</div><div class="line">	&#125;</div><div class="line"></div><div class="line">    token s2section &#123;</div><div class="line">	    &lt;s2name&gt; &lt;ws&gt;</div><div class="line">		&lt;lines&gt;*</div><div class="line">    &#125;</div><div class="line"></div><div class="line">	token sname          &#123; &lt;sigil2&gt;   &lt;ws&gt; &lt;snumber=.hnumber&gt; &lt;ws&gt; &lt;shead=.hline&gt;  &#125;</div><div class="line">	token subsname       &#123; &lt;sigil3&gt;   &lt;ws&gt; &lt;subnumber=.number&gt;    &lt;shline=.hline&gt;      &#125;</div><div class="line">	token s2name         &#123; &lt;sigil4&gt;   &lt;ws&gt; &lt;s2number=.number&gt; &lt;s2hline=.hline&gt;   &#125;</div><div class="line">	token lines          &#123;</div><div class="line">	    [</div><div class="line">		    &lt;!after &apos;#&apos; ** 2..* &gt;</div><div class="line">            \N</div><div class="line">        ]+</div><div class="line">	    \n</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	token number &#123;</div><div class="line">	    \d+ % \.</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	token hline &#123;</div><div class="line">	    \N+</div><div class="line">	&#125;</div><div class="line">	token hnumber &#123; \w+&#125;</div><div class="line">	token ws     &#123; \s*      &#125;</div><div class="line">	token sigil2 &#123; &apos;#&apos; ** 2 &#125;</div><div class="line">	token sigil3 &#123; &apos;#&apos; ** 3 &#125;</div><div class="line">	token sigil4 &#123; &apos;#&apos; ** 4 &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $str = q:to/EOF/;</div><div class="line">## 第三章 操作符</div><div class="line">blabla</div><div class="line">#blabla</div><div class="line">blabla</div><div class="line">blabla</div><div class="line">###  3.1 关于优先级的的一句话</div><div class="line">blabla</div><div class="line">###  3.2 比较和智能匹配</div><div class="line">blabla</div><div class="line">####   3.2.1 数字比较</div><div class="line">blabla</div><div class="line">####    3.2.2 字符串比较</div><div class="line">blabla</div><div class="line">####    3.2.3 智能匹配</div><div class="line">blabla</div><div class="line">### 3.3 测试</div><div class="line">## 第四章 子例程和签名</div><div class="line">blabla</div><div class="line">###  4.1 申明子例程</div><div class="line">blabla</div><div class="line">###  4.2 添加签名</div><div class="line">blabla</div><div class="line">####   4.2.1 基础</div><div class="line">blabla</div><div class="line">####    4.2.2 传递数组、散列和代码</div><div class="line">blabla</div><div class="line">####    4.2.3 插值、数组和散列</div><div class="line">blabla</div><div class="line">EOF</div><div class="line"></div><div class="line">class Markdown::Toc::Actions &#123;</div><div class="line">	method s2section($/)        &#123;</div><div class="line">	    my $first = ~$&lt;s2name&gt;&lt;s2number&gt;;</div><div class="line">	    my $second = ~$&lt;s2name&gt;&lt;s2hline&gt;;</div><div class="line">		my $remove_dot = $first.subst(rx/\./,&apos;&apos;,:g);</div><div class="line">		my $remove_space = $second.subst(rx/\s+/,&apos;-&apos;,:g);</div><div class="line">		make &apos;    - &apos;~&apos;[&apos;~$first~&apos; &apos;~$second~&apos;]&apos; ~ &apos;(#&apos;~$remove_dot~$remove_space ~ &apos;)&apos; =&gt; $&lt;s2section&gt;&gt;&gt;.made;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	method subsection($/) &#123;</div><div class="line">	    my $first = ~$&lt;subsname&gt;&lt;subnumber&gt;;</div><div class="line">	    my $second = ~$&lt;subsname&gt;&lt;shline&gt;;</div><div class="line">		my $remove_dot = $first.subst(rx/\./,&apos;&apos;,:g);</div><div class="line">		my $remove_space = $second.subst(rx/\s+/,&apos;-&apos;,:g);</div><div class="line">		make &apos;  - &apos;~&apos;[&apos;~$first~&apos; &apos;~$second~&apos;]&apos; ~ &apos;(#&apos;~$remove_dot~$remove_space ~ &apos;)&apos;	=&gt; $&lt;s2section&gt;&gt;&gt;.made;  </div><div class="line">	&#125;</div><div class="line"></div><div class="line">    method section($/)    &#123;</div><div class="line">	    my $first = ~$&lt;sname&gt;&lt;snumber&gt;;</div><div class="line">		my $second = ~$&lt;sname&gt;&lt;shead&gt;;</div><div class="line">		#my $remove_dot = $first.subst(rx/\./,&apos;&apos;,:g);</div><div class="line">		my $remove_space = $second.subst(rx/\s+/,&apos;&apos;,:g);</div><div class="line">	    make &apos;- &apos;~&apos;[&apos;~$first~&apos; &apos;~$second~&apos;]&apos; ~ &apos;(#&apos;~$first~ &apos;-&apos;~$remove_space ~ &apos;)&apos;  =&gt; $&lt;subsection&gt;&gt;&gt;.made;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">    method TOP($/)    &#123; make $&lt;section&gt;&gt;&gt;.made;                                                            &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">my $actions = Markdown::Toc::Actions.new;</div><div class="line">my $match  = Markdown::Toc.parse($str, :$actions).made;</div><div class="line">#say $match.Str;</div><div class="line"></div><div class="line">for @$match -&gt; $p &#123;</div><div class="line">    say $p.key();</div><div class="line">    for $p.value() -&gt; $v &#123;</div><div class="line">        for $v -&gt; $n &#123;</div><div class="line">		   .say for $n.hash().keys();</div><div class="line">		   for $n.hash().values() -&gt; $three &#123;</div><div class="line">		       .say for $three.hash().keys();</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">use v6;</div><div class="line"></div><div class="line">grammar KeyValuePairs &#123;</div><div class="line">    token TOP &#123;</div><div class="line">        [&lt;pair&gt; \n+]*</div><div class="line">    &#125;</div><div class="line">    token ws &#123; \h* &#125;</div><div class="line"></div><div class="line">    rule pair &#123;</div><div class="line">        &lt;key=.identifier&gt; &apos;=&apos; &lt;value=.identifier2&gt;</div><div class="line">    &#125;</div><div class="line">    token identifier &#123;</div><div class="line">        \w+</div><div class="line">    &#125;</div><div class="line">     token identifier2 &#123;</div><div class="line">        \w+</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class KeyValuePairsActions &#123;</div><div class="line">    method identifier($/) &#123; $/.make: &apos;[&apos; ~$/ ~ &apos;]&apos;                &#125;</div><div class="line">    method identifier2($/) &#123; $/.make: &apos;&#123;&apos; ~$/ ~ &apos;&#125;&apos;               &#125;</div><div class="line">    method pair      ($/) &#123; $/.make: $&lt;key&gt;.made =&gt; $&lt;value&gt;.made &#125;</div><div class="line">    method TOP       ($/) &#123; $/.make: $&lt;pair&gt;».made                &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my  $res = KeyValuePairs.parse(q:to/EOI/, :actions(KeyValuePairsActions)).made;</div><div class="line">    second=b</div><div class="line">    hits=42</div><div class="line">    perl=6</div><div class="line">    EOI</div><div class="line">say $res;</div><div class="line">for @$res -&gt; $p &#123;</div><div class="line">    say &quot;Key: $p.key()\tValue: $p.value()&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">﻿grammar VariableNames &#123;</div><div class="line"></div><div class="line">    token variable &#123;</div><div class="line">        &lt;sigil&gt; &lt;name&gt;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    token sigil &#123;</div><div class="line">        &apos;$&apos; | &apos;@&apos; | &apos;&amp;&apos; | &apos;%&apos; | &apos;::&apos;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">	# [ ... ] are non-capturing groups</div><div class="line">	token name &#123;</div><div class="line">        &lt;identifier&gt;</div><div class="line">        [ &apos;::&apos; &lt;identifier&gt; ] *</div><div class="line">    &#125;</div><div class="line">	# 标识符以字母开头</div><div class="line">    token identifier &#123;</div><div class="line">        &lt;alpha&gt; \w+</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $match = VariableNames.parse(&quot;@array&quot;,:rule(&apos;variable&apos;));</div><div class="line">say $match;</div><div class="line"></div><div class="line"># we inherit from the original grammar...</div><div class="line">grammar VARIABLENAMES is VariableNames &#123;</div><div class="line"></div><div class="line">    # ... and override that parsing rule that we want to change</div><div class="line">    token identifier &#123;</div><div class="line">        # char classes are &lt;[ ... ]&gt; in Perl 6</div><div class="line">        &lt;[A..Z]&gt; &lt;[A..Z0..9_]&gt;*</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">my $test = VARIABLENAMES.parse(&quot;%A_HASH_TABLE&quot;,:rule(&apos;variable&apos;));</div><div class="line">say $test;</div><div class="line"></div><div class="line">grammar LackMoney is VariableNames &#123;</div><div class="line">    token sigil &#123;</div><div class="line">        &apos;¢&apos; | &apos;@&apos; | &apos;&amp;&apos; | &apos;%&apos; | &apos;::&apos;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"># 继承以后, 带¢的变量能够解析, 带$的变量解析不了了</div><div class="line">my $money = LackMoney.parse(&apos;$i_m_not_dollor&apos;,:rule(&apos;variable&apos;));</div><div class="line">say so $money; # false</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">use v6;</div><div class="line">grammar URL &#123;</div><div class="line">        token TOP &#123;</div><div class="line">            &lt;schema&gt; &apos;://&apos;</div><div class="line">            [&lt;ip&gt; | &lt;hostname&gt; ]</div><div class="line">            [ &apos;:&apos; &lt;port&gt;]?</div><div class="line">            &apos;/&apos; &lt;path&gt;?</div><div class="line">        &#125;</div><div class="line">        token byte &#123;</div><div class="line">            (\d**1..3) &lt;?&#123; $0 &lt; 256 &#125;&gt;</div><div class="line">        &#125;</div><div class="line">        token ip &#123;</div><div class="line">            &lt;byte&gt; [\. &lt;byte&gt; ] ** 3</div><div class="line">        &#125;</div><div class="line">        token schema &#123;</div><div class="line">            \w+</div><div class="line">        &#125;</div><div class="line">        token hostname &#123;</div><div class="line">            (\w+) ( \. \w+ )*</div><div class="line">        &#125;</div><div class="line">        token port &#123;</div><div class="line">            \d+</div><div class="line">        &#125;</div><div class="line">        token path &#123;</div><div class="line">            &lt;[ a..z A..Z 0..9 \-_.!~*&apos;():@&amp;=+$,/ ]&gt;+</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">my  $match = URL.parse(&apos;http://perl6.org/documentation/&apos;);</div><div class="line">say $match.WHAT();</div><div class="line">say $match&lt;path&gt;;       # perl6.org</div><div class="line">say &quot;hello &quot;;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line">#use Grammar::Debugger;</div><div class="line">#use Grammar::Tracer;</div><div class="line"></div><div class="line">grammar SalesExport::Grammar &#123;</div><div class="line">    token TOP &#123; ^ &lt;country&gt;+ $ &#125;</div><div class="line">    token country &#123;</div><div class="line">        &lt;cname=.name&gt; \n</div><div class="line">        &lt;destination&gt;+</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    token destination &#123;</div><div class="line">        \s+ &lt;dname=.name&gt; \s+ &apos;:&apos; \s+</div><div class="line">        &lt;lat=.num&gt; &apos;,&apos; &lt;long=.num&gt; \s+ &apos;:&apos; \s+</div><div class="line">        &lt;sales=.integer&gt; \n</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    token name    &#123; \w+          &#125;</div><div class="line">    token num     &#123; \d+ [\.\d+]? &#125;</div><div class="line">    token integer &#123; \d+          &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $string = q:to/THE END/;</div><div class="line">Norway</div><div class="line">    Oslo : 59.914289,10.738739 : 2</div><div class="line">    Bergen : 60.388533,5.331856 : 4</div><div class="line">Ukraine</div><div class="line">    Kiev : 50.456001,30.50384 : 3</div><div class="line">Switzerland</div><div class="line">    Wengen : 46.608265,7.922065 : 3</div><div class="line">THE END</div><div class="line"></div><div class="line">class SalesExport::Grammar::Actions &#123;</div><div class="line">	method destination($/) &#123; make ~$&lt;dname&gt; =&gt; $&lt;sales&gt;          &#125;</div><div class="line">    method country($/)     &#123; make ~$&lt;cname&gt; =&gt; $&lt;destination&gt;    &#125;</div><div class="line">    method TOP($/)         &#123; make $&lt;country&gt;&gt;&gt;.made              &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $actions = SalesExport::Grammar::Actions.new;</div><div class="line">my $grammar_action = SalesExport::Grammar.parse($string, :actions($actions)).made;</div><div class="line"></div><div class="line"># 获取所有国家的名字</div><div class="line">for @$grammar_action -&gt; $p &#123;</div><div class="line">    say &quot;$p.key()&quot;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">say  &quot;-&quot; x 45;</div><div class="line">for @$grammar_action -&gt; $p &#123;</div><div class="line">    for $p.value() -&gt; $d &#123;</div><div class="line">	   for @$d -&gt; $n &#123;</div><div class="line">	      say ~$n&lt;dname&gt;;</div><div class="line">	   &#125;</div><div class="line">	  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">say  &quot;-&quot; x 45;</div><div class="line"></div><div class="line"># 计算每个国家卖了多少票</div><div class="line">for @$grammar_action -&gt; $c &#123;</div><div class="line">    for $c.value() -&gt; $d &#123;</div><div class="line">	   my $sales_count=0;</div><div class="line">	   for @$d -&gt; $n &#123;</div><div class="line">	      $sales_count += ~$n&lt;sales&gt;;</div><div class="line">	   &#125;</div><div class="line">	   say $sales_count;</div><div class="line">	  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"> #`(</div><div class="line"># say $string;</div><div class="line">my $grammar_object = SalesExport::Grammar.parse($string);</div><div class="line">if $grammar_object &#123;</div><div class="line">     say &quot;It&apos;s works&quot;;</div><div class="line"> &#125; else &#123;</div><div class="line">     # TODO: error reporting</div><div class="line">     say &quot;Not quite works...&quot;;</div><div class="line"> &#125;</div><div class="line"></div><div class="line"></div><div class="line"># say $grammar_object;</div><div class="line">#  say $grammar_object&lt;country&gt;.Str;</div><div class="line">say &quot;_&quot; x 45;</div><div class="line"># say $grammar_object&lt;country&gt;[0];</div><div class="line"># say $grammar_object&lt;country&gt;[1].Str;</div><div class="line"></div><div class="line"> say &quot;_&quot; x 45;</div><div class="line"># say $grammar_object&lt;country&gt;[].Str;</div><div class="line"># say $grammar_object&lt;country&gt;.values;</div><div class="line"></div><div class="line"># 获取国家的名字</div><div class="line">say $grammar_object&lt;country&gt;[0]&lt;name&gt;.Str;</div><div class="line">say $grammar_object&lt;country&gt;[1]&lt;name&gt;.Str;</div><div class="line">say $grammar_object&lt;country&gt;[2]&lt;name&gt;.Str;</div><div class="line"></div><div class="line"> say &quot;_&quot; x 45;</div><div class="line"># 获取目的地</div><div class="line">say $grammar_object&lt;country&gt;[0]&lt;destination&gt;[0]&lt;name&gt;.Str;</div><div class="line">say $grammar_object&lt;country&gt;[0]&lt;destination&gt;[1]&lt;name&gt;.Str;</div><div class="line"></div><div class="line"> say &quot;_&quot; x 45;</div><div class="line"># 获取经度</div><div class="line">say $grammar_object&lt;country&gt;[0]&lt;destination&gt;[0]&lt;lat&gt;.Str;</div><div class="line">say $grammar_object&lt;country&gt;[0]&lt;destination&gt;[1]&lt;lat&gt;.Str;</div><div class="line"></div><div class="line"> say &quot;_&quot; x 45;</div><div class="line"># 获取纬度</div><div class="line">say $grammar_object&lt;country&gt;[0]&lt;destination&gt;[0]&lt;long&gt;.Str;</div><div class="line">say $grammar_object&lt;country&gt;[0]&lt;destination&gt;[1]&lt;long&gt;.Str;</div><div class="line"></div><div class="line"> say &quot;_&quot; x 45;</div><div class="line"># 获取sales</div><div class="line">say $grammar_object&lt;country&gt;[0]&lt;destination&gt;[0]&lt;sales&gt;.Str;</div><div class="line">say $grammar_object&lt;country&gt;[0]&lt;destination&gt;[1]&lt;sales&gt;.Str;</div><div class="line"></div><div class="line"> say &quot;_&quot; x 45;</div><div class="line"> # 获取所有国家</div><div class="line">say $grammar_object&lt;country&gt;»&lt;name&gt;.Str;</div><div class="line"></div><div class="line"> say &quot;_&quot; x 45;</div><div class="line"> # 获取第一个国家的所有目的地</div><div class="line"> say $grammar_object&lt;country&gt;[0]&lt;destination&gt;»&lt;name&gt;.Str;</div><div class="line"></div><div class="line"> say &quot;_&quot; x 45;</div><div class="line"> # 获取第一个国家的所有的 sales</div><div class="line"> say $grammar_object&lt;country&gt;[0]&lt;destination&gt;»&lt;sales&gt;.Str;</div><div class="line">)</div></pre></td></tr></table></figure>
<p> 只能在叶子节点上(最后一个正则名字的前面)使用超运算符 »<br>  S/匹配对象中, 键就是正则的名字, 键值就是匹配到的部分内容.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line">﻿#use Grammar::Debugger;</div><div class="line">#use Grammar::Tracer;</div><div class="line"></div><div class="line">grammar SalesExport::Grammar &#123;</div><div class="line">    token TOP &#123; ^ &lt;country&gt;+ $ &#125;</div><div class="line">    token country &#123;</div><div class="line">        &lt;cname=.name&gt; \n</div><div class="line">        &lt;destination&gt;+</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    token destination &#123;</div><div class="line">        \s+ &lt;dname=.name&gt; \s+ &apos;:&apos; \s+</div><div class="line">        &lt;lat=.num&gt; &apos;,&apos; &lt;long=.num&gt; \s+ &apos;:&apos; \s+</div><div class="line">        &lt;sales=.integer&gt; \n</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    token name    &#123; \w+          &#125;</div><div class="line">    token num     &#123; \d+ [\.\d+]? &#125;</div><div class="line">    token integer &#123; \d+          &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $string = q:to/THE END/;</div><div class="line">Norway</div><div class="line">    Oslo : 59.914289,10.738739 : 2</div><div class="line">    Bergen : 60.388533,5.331856 : 4</div><div class="line">Ukraine</div><div class="line">    Kiev : 50.456001,30.50384 : 3</div><div class="line">Switzerland</div><div class="line">    Wengen : 46.608265,7.922065 : 3</div><div class="line">THE END</div><div class="line"></div><div class="line">class SalesExport::Grammar::Actions &#123;</div><div class="line">	method destination($/) &#123; make ~$&lt;dname&gt; =&gt; [$&lt;sales&gt;.map(*.Num+10),$&lt;lat&gt;.map(*.Num+90) ]         &#125;</div><div class="line">    method country($/)     &#123; make ~$&lt;cname&gt; =&gt; $&lt;destination&gt;&gt;&gt;.made            &#125;</div><div class="line">    method TOP($/)         &#123; make $&lt;country&gt;&gt;&gt;.made                             &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $actions = SalesExport::Grammar::Actions.new;</div><div class="line">my $grammar_action = SalesExport::Grammar.parse($string, :actions($actions)).made;</div><div class="line">#say $grammar_action.Str;</div><div class="line"># 获取所有国家的名字</div><div class="line">for @$grammar_action -&gt; $p &#123;</div><div class="line">    say &quot;$p.key()&quot;;</div><div class="line">&#125;</div><div class="line">say &apos;-&apos; x 45;</div><div class="line"># 获取所有目的地</div><div class="line">for @$grammar_action -&gt; $p &#123;</div><div class="line">    for $p.value() -&gt; $d &#123;</div><div class="line">	    for @$d -&gt; $n&#123;</div><div class="line">		    say $n.key();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line">say &apos;-&apos; x 45;</div><div class="line"># 获取出售的票数</div><div class="line">for @$grammar_action -&gt; $p &#123;</div><div class="line">    print &quot;$p.key()\t&quot;;</div><div class="line">    for $p.value() -&gt; $d &#123;</div><div class="line">	    my $count;</div><div class="line">	    for @$d -&gt; $n&#123;</div><div class="line">		    $count += $n.value()[0];</div><div class="line">		&#125;</div><div class="line">	say $count;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">say &apos;-&apos; x 45;</div><div class="line"># 获取经度 lat</div><div class="line">for @$grammar_action -&gt; $p &#123;</div><div class="line">    for $p.value() -&gt; $d &#123;</div><div class="line">	    for @$d -&gt; $n&#123;</div><div class="line">		    say $n.value()[1];</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这将打印:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">Norway</div><div class="line">Ukraine</div><div class="line">Switzerland</div><div class="line">---------------------------------------------</div><div class="line">Oslo</div><div class="line">Bergen</div><div class="line">Kiev</div><div class="line">Wengen</div><div class="line">---------------------------------------------</div><div class="line">Norway  26</div><div class="line">Ukraine 13</div><div class="line">Switzerland     13</div><div class="line">---------------------------------------------</div><div class="line">149.914289</div><div class="line">150.388533</div><div class="line">140.456001</div><div class="line">136.608265</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">grammar TestGrammar &#123;</div><div class="line">    token TOP &#123; ^ \d+ $ &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class TestActions &#123;</div><div class="line">    method TOP($/) &#123;</div><div class="line">        $/.make(2 + ~$/);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $actions = TestActions.new;</div><div class="line">my $match = TestGrammar.parse(&apos;40&apos;, :$actions);</div><div class="line">say $match;         # ｢40｣</div><div class="line">say $match.made;    # 42</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">﻿grammar MyGrammar &#123;</div><div class="line">    token TOP &#123;</div><div class="line">        ^ [ &lt;comment&gt; | &lt;chunk&gt; ]* $</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    token comment &#123;</div><div class="line">        &apos;#&apos; \N* \n</div><div class="line">    &#125;</div><div class="line">    token chunk &#123;</div><div class="line">      ^^  (\S+) &apos;=&apos; (\S+) $$</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"># 如何调试 Grammars</div><div class="line"># try to parse the whole thing</div><div class="line">say ?MyGrammar.parse(&quot;#a comment\nfoo = bar&quot;);            # False, 整体调试</div><div class="line"># and now one by one</div><div class="line">say so MyGrammar.parse(&quot;#a comment\n&quot;, :rule&lt;comment&gt;);   # True, 只单独调试 comment</div><div class="line">say so MyGrammar.parse(&quot;foo = bar&quot;, :rule&lt;chunk&gt;);        # False, 只单独调试 chunk, 失败, 说明 chunk 不能匹配! 原因是空白符没有匹配</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">﻿use v6;</div><div class="line"></div><div class="line">grammar TestGrammar &#123;</div><div class="line">    token TOP   &#123; ^ &lt;digit&gt; $ &#125;</div><div class="line">	token digit &#123; \d+         &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class TestActions &#123;</div><div class="line">    method TOP($/) &#123;</div><div class="line">	   # $/.make( 2 + ~$/);</div><div class="line">	   make +$&lt;digit&gt; + 2 ;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $actions = TestActions.new;</div><div class="line">my $match   = TestGrammar.parse(&apos;40&apos;, :$actions);</div><div class="line">say $match;</div><div class="line">say $match.made;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">#use Grammar::Debugger;</div><div class="line">#use Grammar::Tracer;</div><div class="line"></div><div class="line">grammar SalesExport &#123;</div><div class="line">    token TOP &#123; ^ &lt;country&gt;+ $ &#125;</div><div class="line">    token country &#123;</div><div class="line">        &lt;name&gt; \n</div><div class="line">        &lt;destination&gt;+</div><div class="line">    &#125;</div><div class="line">    token destination &#123;</div><div class="line">        \s+ &lt;name&gt; \s+ &apos;:&apos; \s+</div><div class="line">        &lt;lat=.num&gt; &apos;,&apos; &lt;long=.num&gt; \s+ &apos;:&apos; \s+</div><div class="line">        &lt;sales=.integer&gt; \n</div><div class="line">    &#125;</div><div class="line">    token name    &#123; \w+ [ \s \w+ ]*   &#125;</div><div class="line">    token num     &#123; &apos;-&apos;? \d+ [\.\d+]? &#125;</div><div class="line">    token integer &#123; &apos;-&apos;? \d+          &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"># Now we can turn any file in this format into a data structure.</div><div class="line">#  tripes.txt 最后一行要有一个空行</div><div class="line">my $parsed = SalesExport.parsefile(&apos;tripes.txt&apos;);</div><div class="line"></div><div class="line">if $parsed &#123;</div><div class="line">    my @countries = @($parsed&lt;country&gt;);</div><div class="line">	#for @countries -&gt; $country &#123; say ~$country&lt;name&gt;&#125;;</div><div class="line">	for @countries &#123; say [+] .&lt;destination&gt;»&lt;sales&gt;;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">if $parsed &#123;</div><div class="line">    my @countries = @($parsed&lt;country&gt;);</div><div class="line">    my $top1 = @countries.max(&#123;</div><div class="line">       [+] .&lt;destination&gt;»&lt;sales&gt;</div><div class="line">       &#125;);</div><div class="line">    say &quot;Most popular today: $top1&lt;name&gt; &quot;, [+] $top1&lt;destination&gt;&gt;&gt;&lt;sales&gt;;</div><div class="line">&#125;</div><div class="line">else &#123;</div><div class="line">    die &quot;Parse error!&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>tripes.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Russia</div><div class="line">    Vladivostok : 43.131621,131.923828 : 4</div><div class="line">    Ulan Ude : 51.841624,107.608101 : 2</div><div class="line">    Saint Petersburg : 59.939977,30.315785 : 10</div><div class="line">Norway</div><div class="line">    Oslo : 59.914289,10.738739 : 2</div><div class="line">    Bergen : 60.388533,5.331856 : 4</div><div class="line">Ukraine</div><div class="line">    Kiev : 50.456001,30.50384 : 3</div><div class="line">Switzerland</div><div class="line">    Wengen : 46.608265,7.922065 : 3</div><div class="line">    Bern : 46.949076,7.448151 : 1</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">﻿use v6;</div><div class="line"></div><div class="line">my $file=open &quot;wordpairs.txt&quot;, :r;</div><div class="line"></div><div class="line">my %dict;</div><div class="line">my $line;</div><div class="line"></div><div class="line">repeat &#123;</div><div class="line">    $line=$file.get;</div><div class="line">    my ($p1,$p2)=$line.split(&apos; &apos;);</div><div class="line">    if ?%dict&#123;$p1&#125; &#123;</div><div class="line">        %dict&#123;$p1&#125; = &quot;&#123;%dict&#123;$p1&#125;&#125; &#123;$p2&#125;&quot;.words;</div><div class="line">    &#125; else &#123;</div><div class="line">        %dict&#123;$p1&#125; = $p2;</div><div class="line">    &#125;</div><div class="line">&#125; while !$file.eof;</div></pre></td></tr></table></figure>
<p>wordpairs.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">it was</div><div class="line">was the</div><div class="line">the best</div><div class="line">best of</div><div class="line">of times</div><div class="line">times it</div><div class="line">it was</div><div class="line">was the</div><div class="line">the worst</div><div class="line">worst of</div><div class="line">of times</div><div class="line">times it</div><div class="line">it was</div><div class="line">was the</div><div class="line">the age</div><div class="line">age of</div><div class="line">of wisdom</div><div class="line">wisdom it</div></pre></td></tr></table></figure>
<h2 id="Great-List-Refactor"><a href="#Great-List-Refactor" class="headerlink" title="Great List Refactor"></a>Great List Refactor</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">﻿&gt; map &#123;$^x + 2&#125;, ( (1,2),3, (4,5))</div><div class="line">3 4 5 6 7</div><div class="line">&gt; map &#123;$_ + 2&#125;, ( (1,2),3, (4,5))</div><div class="line">3 4 5 6 7</div><div class="line">&gt; (10,(11,12,13),(14,15)).[2]</div><div class="line">14 15</div></pre></td></tr></table></figure>
<h2 id="Perl-6-Examples"><a href="#Perl-6-Examples" class="headerlink" title="Perl 6 Examples"></a>Perl 6 Examples</h2><hr>
<ul>
<li>1、生成8位随机密码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">my  @char_set = (0..9, &apos;a&apos;..&apos;z&apos;, &apos;A&apos;..&apos;Z&apos;,&apos;~&apos;,&apos;!&apos;,&apos;@&apos;,&apos;#&apos;,&apos;$&apos;,&apos;%&apos;,&apos;^&apos;,&apos;&amp;&apos;,&apos;*&apos;);</div><div class="line">say @char_set.pick(8).join(&quot;&quot;) # 不重复的8位密码</div><div class="line"></div><div class="line">say @char_set.roll(8).join(&quot;&quot;)  # 可以重复</div></pre></td></tr></table></figure>
<ul>
<li>2、打印前5个数字</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">.say for 1..10[^5]</div><div class="line">.say for 1,2,3,4 ... [^10]  # 这个会无限循环</div></pre></td></tr></table></figure>
<ul>
<li><p>3、排序</p>
</li>
<li><p>3.1 按数值排序</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; my %hash=&apos;Perl&apos;=&gt;100,&apos;Python&apos;=&gt;100,&apos;Go&apos;=&gt;100,&apos;CMD&apos;=&gt;20,&quot;Php&quot;=&gt;80,&quot;Java&quot;=&gt;85;</div><div class="line">&gt; %hash.values</div><div class="line">100 100 100 20 80 85</div><div class="line">&gt; %hash.values.sort</div><div class="line">20 80 85 100 100 100</div><div class="line">&gt; %hash.values.sort(-*)</div><div class="line">100 100 100 85 80 20</div></pre></td></tr></table></figure>
<ul>
<li>3.2 按分数排序散列：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">use v6;</div><div class="line">my %hash = &apos;Perl&apos;=&gt;80,</div><div class="line">         &apos;Python&apos;=&gt;100,</div><div class="line">             &apos;Go&apos;=&gt;95,</div><div class="line">            &apos;CMD&apos;=&gt;20,</div><div class="line">            &quot;Php&quot;=&gt;80,</div><div class="line">           &quot;Java&quot;=&gt;85;</div><div class="line"></div><div class="line">for %hash.sort(&#123;-.value&#125;).hash.keys -&gt; $key &#123;</div><div class="line">    say $key, &quot;\t&quot;, %hash&#123;&quot;$key&quot;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"># Python	100</div><div class="line"># Go	95</div><div class="line"># Java	85</div><div class="line"># Perl	80</div><div class="line"># Php	80</div><div class="line"># CMD	20</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&gt; (&apos;xx&apos;..&apos;zz&apos;).classify(*.substr(1))&lt;z&gt;</div><div class="line">xz yz zz</div><div class="line"></div><div class="line">加密：</div><div class="line">sub rot13 &#123; $^s.trans(&apos;a..z&apos; =&gt; &apos;n..za..m&apos;, &apos;A..Z&apos; =&gt; &apos;N..ZA..M&apos;) &#125;</div><div class="line"></div><div class="line"># 执行外部命令</div><div class="line">shell( &quot;ssh www.myopps.com uptime&quot; )</div><div class="line">shell( &quot;ls&quot; )</div><div class="line">shell( &quot;ls -a&quot; )</div><div class="line"># shell 将命令的执行结果直接发送到屏幕</div><div class="line"></div><div class="line">my $list = QX(&quot;ls&quot;)</div><div class="line"># 可以将命令的结果保存到变量中。</div><div class="line"></div><div class="line">#  批量创建文件夹</div><div class="line">for &apos;A&apos;.. &apos;Z&apos; -&gt; $i &#123; shell(&quot;mkdir $i&quot;) &#125;</div></pre></td></tr></table></figure>
<ul>
<li>4、求 1! + 2! + 3! + 4! +5! + 6! +7! +8! +9! +10!</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; multi sub postfix:&lt;!&gt;(Int $x)&#123; [*] 1..$x &#125;</div><div class="line">&gt; say [+] 1!,2!,3!,4!,5!,6!,7!,8!,9!,10! # 4037913</div></pre></td></tr></table></figure>
<ul>
<li>5、列出对象所有可用的方法<br>使用元对象协议， 即<code>对象名.^methods</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt; &quot;SB&quot;.^methods</div></pre></td></tr></table></figure>
<blockquote>
<p>BUILD Int Num chomp chop substr pred succ match ords lines samecase samespace tr<br>im-leading trim-trailing trim words encode wordcase trans indent codes path WHIC<br>H Bool Str Stringy DUMP ACCEPTS Numeric gist perl comb subst split</p>
</blockquote>
<ul>
<li>6、 匿名子例程</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">my $x = sub($a)&#123; $a+2 &#125;;say $x($_) for 1..4</div><div class="line">my $x = -&gt; $a &#123; $a+2 &#125;;say $x($_) for 1..4</div><div class="line">my $x = * + 2;say $x($_) for 1..4</div></pre></td></tr></table></figure>
<p>以后是不是不会写这种 <code>=*+2</code> 的都不好意思说自己会写Perl6</p>
<ul>
<li>7、字符串翻转与分割</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt; 1223.flip</div><div class="line">3221</div><div class="line">&gt; &apos;abcd&apos;.flip</div><div class="line">dcba</div><div class="line">&gt; 1234.comb</div><div class="line">1 2 3 4</div><div class="line">&gt; 1234.comb(/./)</div><div class="line">1 2 3 4</div><div class="line">&gt; &apos;abcd&apos;.comb</div><div class="line">a b c d</div></pre></td></tr></table></figure>
<ul>
<li>8、有这么一个四位数A，其个位数相加得到B，将B 乘以 B的反转数后得到 A，请求出这个&gt;数字。</li>
</ul>
<p>举例， 1458 就符合这个条件，1+4+5+8 ＝ 18， 18 ＊ 81 ＝1458</p>
<p>请找出另一个符合上面条件的四位数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt; (^37).map: &#123; my $r = $_ * .flip; 1000 &lt; $r and $_ == [+] $r.comb and say $r &#125;</div></pre></td></tr></table></figure>
<p>解释下：<br>(^37) 产生一个范围  0 .. ^37 , 就是 0到36之前的数，在表达式中代表 B</p>
<p>来个正常思维的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; my $b;</div><div class="line">&gt; for 1000..^10000 -&gt; $i &#123;$b=[+] $i.comb;say $i if $b*$b.flip == $i;&#125;</div></pre></td></tr></table></figure>
<p>1458<br>1729</p>
<ul>
<li>9、 大小写转换</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&gt; my $word= &quot;I Love Perl 6&quot;</div><div class="line">I Love Perl 6</div><div class="line">&gt; $word.wordcase()</div><div class="line">I Love Perl 6</div><div class="line">&gt; my $lowercase = &quot;i love perl 6&quot;</div><div class="line">i love perl 6</div><div class="line">&gt; $lowercase.wordcase()</div><div class="line">I Love Perl 6</div><div class="line">&gt; $word.samecase(&apos;A&apos;)</div><div class="line">I LOVE PERL 6</div><div class="line">&gt; $word.samecase(&apos;a&apos;)</div><div class="line">i love perl 6</div><div class="line">&gt; $word.samecase(&apos;a&apos;).wordcase()</div><div class="line">I Love Perl 6</div></pre></td></tr></table></figure>
<ul>
<li>10、 多行文本</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">my $string = q:to/THE END/;</div><div class="line">Norway</div><div class="line">    Oslo : 59.914289,10.738739 : 2</div><div class="line">    Bergen : 60.388533,5.331856 : 4</div><div class="line">Ukraine</div><div class="line">    Kiev : 50.456001,30.50384 : 3</div><div class="line">Switzerland</div><div class="line">    Wengen : 46.608265,7.922065 : 3</div><div class="line">THE END</div><div class="line"></div><div class="line">say $string;</div></pre></td></tr></table></figure>
<ul>
<li>11、 超运算符与子例程</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">use v6;</div><div class="line"></div><div class="line">my @a = &lt;1 2 3 4&gt;;</div><div class="line">sub by2($n)&#123;</div><div class="line">    return 2*$n;</div><div class="line">&#125;</div><div class="line"></div><div class="line">sub power2($n) &#123;</div><div class="line">    return $n ** 2;</div><div class="line">&#125;</div><div class="line">my @b = @a&gt;&gt;.&amp;by2&gt;&gt;.&amp;power2;</div><div class="line">say @b; # 4 16 36 64</div></pre></td></tr></table></figure>
<p>为什么是 &amp;function 呢：<br>the name of the by2 function is &amp;by2, just as the name of the foo scalar is $foo and the name of the foo array is @foo</p>
<ul>
<li>12、 如何在Perl 6 中执行外部命令并捕获输出</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; my $res = qqx&#123;mkdir 123456&#125;</div><div class="line"></div><div class="line"># 或使用 qx&#123; &#125;</div><div class="line">&gt; my $res = qx&#123;mkdir 112233&#125;</div></pre></td></tr></table></figure>
<ul>
<li>13、   Does Perl6 support something equivalent to Perl5’s <strong>DATA</strong> and <strong>END</strong> sections?</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">use v6;</div><div class="line">=foo This is a Pod block. A single line one. This Pod block&apos;s name is &apos;foo&apos;.</div><div class="line"></div><div class="line">=begin qux</div><div class="line">This is another syntax for defining a Pod block.</div><div class="line">It allows for multi line content.</div><div class="line">This block&apos;s name is &apos;qux&apos;.</div><div class="line">=end qux</div><div class="line"></div><div class="line">=data A data block -- a Pod block with the name &apos;data&apos;.</div><div class="line"></div><div class="line"># Data blocks are P6&apos;s version of P5&apos;s __DATA__.</div><div class="line"># But you can have multiple data blocks:</div><div class="line"></div><div class="line">=begin data</div><div class="line">Another data block.</div><div class="line">This time a multi line one.</div><div class="line">=end data</div><div class="line"></div><div class="line">$=pod.grep(*.name eq &apos;data&apos;).map(*.contents[0].contents.say);</div><div class="line"></div><div class="line">say &apos;-&apos; x 45;</div><div class="line">for @$=pod &#123;</div><div class="line">  if .name eq &apos;data&apos; &#123;</div><div class="line">    say .contents[0].contents</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<ul>
<li>14、生成含有26个英文字母和下划线的 junction</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; any(&apos;A&apos;..&apos;Z&apos;,&apos;a&apos;..&apos;z&apos;,&apos;_&apos;);</div><div class="line">any(A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y, Z, a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, _)</div></pre></td></tr></table></figure>
<ul>
<li>15、判断一个字符是否在某个集合中</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&gt;  so any(&apos;A&apos;..&apos;Z&apos;,&apos;a&apos;..&apos;z&apos;) ∈ set(&quot;12a34&quot;.comb)</div></pre></td></tr></table></figure>
<p>“12a34”.comb 会把字符串分割为单个字符，返回一个字符数组</p>
<ul>
<li>16、生成 IP 地址范围</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.say for &quot;192.168.10.&quot; &lt;&lt;~&gt;&gt; (0..255).list</div></pre></td></tr></table></figure>
<ul>
<li>17、 生成 OC 中的测试数组</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.say for &quot;@&quot; &lt;&lt;~&gt;&gt; &apos;&quot;Perl&apos; &lt;&lt;~&gt;&gt;  (1..30).list &lt;&lt;~&gt;&gt; &apos;&quot;,&apos;</div></pre></td></tr></table></figure>
<pre><code>@&quot;Perl&quot;1&quot;,
@&quot;Perl&quot;2&quot;,
@&quot;Perl&quot;3&quot;,
@&quot;Perl&quot;4&quot;,
@&quot;Perl&quot;5&quot;,
…
</code></pre><ul>
<li>18、我想以AGCT4种字母为基础生成字符串。</li>
</ul>
<p>比如希望长度为1，输出A,G,C,T。<br>如果长度为2，输出AA,AG,AC,AT,GA,GG,GC,GT,CA,CG,CC,CT,TA,TG,TC,TT。这样的结果。</p>
<p>@a X~ “”   # 长度为1<br>(@a X~ @a) # 长度为2<br>(@a X~ @a) X~ @a     # 长度为3<br>@a X~ @a X~ @a X~ @a # 长度为4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&gt; my @a=&lt;A G C T&gt;</div><div class="line">A G C T</div><div class="line">&gt; my $x=@a</div><div class="line">A G C T</div><div class="line">&gt; $x xx 2</div><div class="line">A G C T A G C T</div><div class="line">&gt; $x xx 3</div><div class="line">A G C T A G C T A G C T</div><div class="line">&gt; ($x xx 3).WHAT</div><div class="line">(List)</div><div class="line">&gt; $x.WHAT</div><div class="line">(Array)</div><div class="line"></div><div class="line">&gt; ([X~] $x xx 2).join(&apos;,&apos;)</div><div class="line">AA,AG,AC,AT,GA,GG,GC,GT,CA,CG,CC,CT,TA,TG,TC,TT</div></pre></td></tr></table></figure>
<p>惰性操作符：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">my @a=&lt;A G C T&gt;;</div><div class="line">my $x=@a;  # 或者使用 $x =@(&apos;A&apos;,&apos;G&apos;,&apos;C&apos;,&apos;T&apos;)</div><div class="line">for 1 ...^ * -&gt; $a &#123;(([X~] $x xx $a)).join(&apos;,&apos;).say;last if $a==4;&#125;;</div></pre></td></tr></table></figure>
<h2 id="Best-Of-Perl-6"><a href="#Best-Of-Perl-6" class="headerlink" title="Best Of Perl 6"></a>Best Of Perl 6</h2><hr>
<ul>
<li>Command Line 命令行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">              Perl 5                                     Perl 6</div><div class="line">print &quot;bananas are good\n&quot;;                     say &quot;bananas are good&quot;;</div><div class="line">print &quot;and I said: $quotes&#123;\&quot;me\&quot;&#125;\n&quot;;          say &quot;and I said: %quotes&#123;&quot;me&quot;&#125;.&quot;;</div><div class="line">print &quot;and I said: $quotes&#123;\&quot;me\&quot;&#125;\n&quot;;          say &quot;and I said: %quotes&lt;me&gt;.&quot;;</div><div class="line">print &quot;What is ... &quot;;                           $result = prompt &quot;What is ... &quot;;</div><div class="line">chomp($result = &lt;&gt;);</div></pre></td></tr></table></figure>
<ul>
<li>File IO</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">               Perl 5                                     Perl 6</div><div class="line"> $content = do &#123; local $/;                       $content = slurp &quot;poetry.txt&quot;;</div><div class="line">    open my $FH, &quot;poetry.txt&quot;; &lt;$FH&gt;</div><div class="line"> &#125;;</div><div class="line"></div><div class="line">chomp(@content = do &#123;                            @content = lines &quot;poetry.txt&quot;;</div><div class="line">    open my $FH, &quot;poetry.txt&quot;; &lt;$FH&gt;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li>Automatic multithreading</li>
</ul>
<p>Applying operations to junctions and arrays is now syntactically compact and readable. Perl 6 will create threads where appropriate to use multiple processors, cores or hyperthreading for high level language SIMD concurrent processing.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">              Perl 5                                     Perl 6</div><div class="line">my $sum;                                        my $sum = [+] @numbers;</div><div class="line">$sum += $_ for @numbers;</div><div class="line">for (0 .. $#factor1) &#123;                          @product = @factor1 &gt;&gt;*&lt;&lt; @factor2;</div><div class="line">  $product[$] = $factor1[$] * $factor2[$_];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The Perl 5 code is a simplification, of course Perl6 “does the right thing” when the arrays have different lengths.</p>
<ul>
<li>Comparison 比较</li>
</ul>
<p>Here are junctions, then chained comparison operators.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">              Perl 5                                     Perl 6</div><div class="line">if ($a == 3 or $a == 4 or $a == 7) &#123;...&#125;        if $a = 3 | 4 | 7 &#123;...&#125;</div><div class="line">if (4 &lt; $a and $a &lt; 12) &#123;...&#125;                   if 4 &lt; $a &lt; 12    &#123;...&#125;</div><div class="line">if (4 &lt; $a and $a &lt;= 12) &#123;...&#125;                  if $a ~~ 4^..12   &#123;...&#125;</div><div class="line">$a = defined $b ? $b : $c;                      $a = $b // $c;</div></pre></td></tr></table></figure>
<p>The defined-OR operator eases lot of cases where Perl 5 newbies could fall into traps.</p>
<ul>
<li>Case 结构</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">              Perl 5                                      Perl 6</div><div class="line">                                                    given $a &#123;</div><div class="line">if ($a == 2 or $a == 5) &#123;...&#125; &#125;&#125;                      when 2 | 5  &#123;...&#125;</div><div class="line">elsif ($a == 6 or $a == 7 or $a == 8 or $a == 9) &#123;&#125;   when 6 .. 9 &#123;...&#125;</div><div class="line">elsif ($a =~ /g/) &#123;...&#125;                               when &apos;g&apos;    &#123;...&#125;</div><div class="line">else &#123;...&#125;                                            default     &#123;...&#125;</div><div class="line">                                                    &#125;</div></pre></td></tr></table></figure>
<p>That new construct (backported to 5.10) is clear to read, very versatile and when used in combination with junctions, becomes even clearer.</p>
<ul>
<li>强大的循环</li>
</ul>
<p>List iteration via for is now much more versatile.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">              Perl 5                                     Perl 6</div><div class="line">for my $i (0..15) &#123;...&#125;                         for ^16 -&gt; $i        &#123;...&#125;</div><div class="line">for (my $i=15; $i&gt;1; $i-2) &#123;...&#125;                for 15,*-2...1 -&gt; $i &#123;...&#125;   # 15 13 11 9 7 5 3 1</div><div class="line">for my $key (keys %hash) &#123;                      for %hash.kv -&gt; $key, $value &#123;</div><div class="line">  print &quot;$key =&gt; $hash&#123;$key&#125;\n&quot;; ...              say &quot;$key =&gt; $value&quot;; ...</div><div class="line">for my $i (0..$#a) &#123;                            for zip(@a; @b; @c) -&gt; $a, $b, $c &#123;...&#125;</div><div class="line">  my $a = @a[$i];</div><div class="line">  my $b = @b[$i];</div><div class="line">  my $c = @c[$i]; ...</div></pre></td></tr></table></figure>
<ul>
<li>子例程中的具名参数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">              Perl 5                                     Perl 6</div><div class="line">sub routine &#123;                                   sub routine ($a, $b, *@rest) &#123;...&#125;</div><div class="line">  my $a = shift;</div><div class="line">  my $b = shift;</div><div class="line">  my @rest = @_;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>Objects with auto generated new and getters and setters</li>
</ul>
<p>Simple Object creation is now as easy as it gets.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">              Perl 5                                     Perl 6</div><div class="line">package Heart::Gold;                            class Heart::Gold &#123;</div><div class="line">                                                  has $.speed;</div><div class="line">sub new &#123;                                         method stop &#123; $.speed = 0 &#125;</div><div class="line">  bless &#123;speed =&gt; 0 &#125;, shift;                   &#125;  </div><div class="line">&#125;</div><div class="line">                                                my Heart::Gold $hg1 .= new;</div><div class="line">sub speed &#123;                                     $hg1.speed = 100;</div><div class="line">  my $self = shift;                             my $hg2 = $hg1.clone;</div><div class="line">  my $speed = shift;</div><div class="line">  if (defined $speed) &#123; $self-&gt;&#123;speed&#125; = $speed &#125;</div><div class="line">  else &#123; $self-&gt;&#123;speed&#125; &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">sub stop &#123;</div><div class="line">  my $self = shift;</div><div class="line">  $self-&gt;&#123;speed&#125; = 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Perl-6-Variable"><a href="#Perl-6-Variable" class="headerlink" title="Perl 6 Variable"></a>Perl 6 Variable</h2><hr>
<ul>
<li>Variable Types</li>
</ul>
<p>Perl 6 (as Perl 5) knows 3 basic types of variables: Scalars (single values), Arrays (ordered and indexed lists of several values) and Hashes (2 column table, with ID and associated value pairs). They can be easily distinguished, because in front of their name is a special character called sigil (latin for sign). It’s the $ (similar to S) for Scalars, @ (like an a) for Arrays and a % (kv pair icon) for a Hash. They are now invariant (not changing), which means for instance, an array vaiable starts always with an @, even if you just want a slice of the content.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$scalar</div><div class="line">@array</div><div class="line">@array[1]              # $array[1]   in Perl 5</div><div class="line">@array[1,2]            # @array[1,2] in Perl 5</div><div class="line">%hash</div><div class="line">%hash&#123;&apos;ba&apos;&#125;            # $hash&#123;&apos;ba&apos;&#125; in Perl 5</div><div class="line">%hash&#123;&apos;ba&apos;,&apos;da&apos;,&apos;bim&apos;&#125; # @hash&#123;&apos;ba&apos;,&apos;da&apos;,&apos;bim&apos;&#125; in Perl 5</div></pre></td></tr></table></figure>
<p>The sigils also mark distinct namespaces, meaning: in one lexical scope you can have 3 different variables named $stuff, @stuff and %stuff. These sigils can also be used as an operator to enforce a context in which the following data will be seen.</p>
<p>The fourth namespace is for subroutines and similar, even if you don’t usually think of them as variables. It’s sigil &amp; is used to refer to subroutines without calling them.</p>
<p>All special namespaces from Perl 5 (often marked with special syntax), like tokens (<strong>PACKAGE</strong>), formats, file or dir handles, or builtins are now regular variables or routines.</p>
<p>Because all variables contain objects, they have methods. In fact, all operators, including square or curly bracket subscripts, are just methods of an object with a fancy name.</p>
<p>The primary sigil can be followed by a secondary sigil, called a twigil, which indicates a special scope for that variable.</p>
<p>Scalar</p>
<p>This type stores one value, usually a reference to something: a value of a data type, a code object, an object or a compound of values like a pair, junction, array, hash or capture. The scalar context is now called item context, hence the scalar instruction from Perl 5 was renamed to item.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">$CHAPTER = 3;              # first comment!</div><div class="line">$bin = 0b11;               # same value in binary format</div><div class="line">$pi = 3.14159_26535_89793; # the underscores just ease reading</div><div class="line">$float = 6.02e-23;         # floating number in scientific notation</div><div class="line">$text = &apos;Welcome all!&apos;;    # single quoted string</div><div class="line"></div><div class="line"># double quoted string, does eval $pi to it&apos;s content</div><div class="line">$text = &quot; What is $pi?&quot;;</div><div class="line">$text = q:to&apos;EOT&apos;;         # heredoc string</div><div class="line"></div><div class="line">    handy for multiline text</div><div class="line">    like HTML templates or email</div><div class="line"></div><div class="line">EOT</div><div class="line">$handle = open $file_name; # file handle</div><div class="line"># an object from a class with a nested namespace</div><div class="line">$object = Class::Name.new();</div><div class="line">$condition = 3|5|7;                # a junction, a logical conjunction of values</div><div class="line">$arrayref = [0,1,1,2,3,5,8,13,21]; # an array stored as a single item</div><div class="line"></div><div class="line"># a hash stored as a single item</div><div class="line">$hashref = &#123;&apos;audreyt&apos; =&gt; &apos;pugs&apos;,</div><div class="line">            &apos;pm&apos;      =&gt; &apos;pct&apos;,</div><div class="line">            &apos;damian&apos;  =&gt; &apos;larrys evil henchman&apos;&#125;;</div><div class="line"># pointing to a callable</div><div class="line">$coderef = sub &#123; do_something_completely_diffenent(@_) &#125;;</div></pre></td></tr></table></figure>
<p>(For info on some of those terms: comment, binary format, the underscores ease reading, scientific notation, single-quoted string, double-quoted string, heredoc string, file handle, class, junction, list of values, hash, callable.)</p>
<p>Unlike Perl 5, references are automatically dereferenced to a fitting context. So you could use these $arrayrefs and $hashrefs similarly to an array or hash, making $ the universal variable prefix, pretty much like in PHP. The primary difference is that $ prefixed lists are not flattened in lists.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">my $a = (1, 2, 3);</div><div class="line">my @a = 1, 2, 3;</div><div class="line">for $a &#123; &#125;          # just one iteration</div><div class="line">for @a &#123; &#125;          # three iterations</div></pre></td></tr></table></figure>
<p>Scalar Methods</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">my $chapter = 3;</div><div class="line">undefine $chapter;</div><div class="line">defined $a; # false, returns 0</div></pre></td></tr></table></figure>
<ul>
<li>Array</li>
</ul>
<p>An array is an ordered and indexed list of scalars. If not specified otherwise, they can be changed, expanded and shortened anytime and used as a list, stack, queue and much more. As in Haskell, lists are processed lazily, which means: the compiler looks only at the part it currently needs. This way Perl 6 can handle infinite lists or do computation on lists that have not been computed yet. The lazy command enforces this and the eager command forces all values to be computed.</p>
<p>The list context is forced with a @() operator or list() command. That’s not autoflattening like in Perl 5 (automatically convert a List of Lists into one List). If you still want that, say flat(). Or say lol() to explicitly prevent autoflattening.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@primes = (2,3,5,7,11,13,17,19,23); # an array gets filled like in Perl 5</div><div class="line">@primes =  2,3,5,7,11,13,17,19,23 ; # same thing, since unlike P5 round braces just do group</div><div class="line">@primes = &lt;2 3 5 7 11 13 17 19 23&gt;; # ditto, &lt;&gt; is the new qw()</div><div class="line">$primes = (2,3,5,7,11,13,17,19,23); # same array object just sits in $primes, $primes[0] is 2</div><div class="line">$primes = item @primes;             # same thing, more explicit</div><div class="line">$primes = 2,;                       # just 2, first element of the Parcel</div><div class="line">@primes = 2;                        # array with one element</div><div class="line">@primes = [2,3,5,7,11,13,17,19,23]; # array with one element (List of Lists - LoL)</div><div class="line">@dev    = &#123;&apos;dan&apos; =&gt; &apos;parrot&apos;&#125;;      # array with one element (a Hash)</div><div class="line">@data   = [1..5],[6..10],[11..15];  # Array of Arrays (LoL)</div><div class="line">@list   = lol @data;                # no change</div><div class="line">@list   = flat @data;               # returns 1..15</div></pre></td></tr></table></figure>
<ul>
<li>Array Slices</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@primes                       # all values as list</div><div class="line">@primes.values                # same thing</div><div class="line">@primes.keys                  # list of all indices</div><div class="line">&quot;@primes[]&quot;                   # insert all values in a string, uses [] to distinguish from mail adresses</div><div class="line">$prime = @primes[0];          # get the first prime</div><div class="line">$prime = @primes[*-1];        # get the last one</div><div class="line">@some = @primes[2..5];        # get several</div><div class="line">$cell = @data[1][2];          # get 8, third value of second value (list)</div><div class="line">$cell = @data[1;2];           # same thing, shorten syntax</div><div class="line">@numbers = @data[1];          # get a copy of the second subarray (6..10)</div><div class="line">@copy = @data;                # shallow copy of the array</div></pre></td></tr></table></figure>
<ul>
<li>Array Methods</li>
</ul>
<p>Some of the more important things you can do with lists. All the methods can also used like ops in “elems @array;”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">? @array;              # boolean context, Bool::True if array has any value in it, even if it&apos;s a 0</div><div class="line">+ @array;              # numeric context, number of elements (like in Perl 5 scalar @a)</div><div class="line">~ @array;              # string context, you get content of all cells, stringified and joined, same as &quot;@primes[]&quot;</div><div class="line"></div><div class="line">@array.elems;          # same as + @array</div><div class="line">@array.end;            # number of the last element, equal to @array.elems-1</div><div class="line">@array.cat;            # same ~ @array</div><div class="line">@array.join(&apos;&apos;);       # also same result, you can put another string as parameter that gets between all values</div><div class="line">@array.unshift;        # prepend one value to the array</div><div class="line">@array.shift;          # remove the first value and return it</div><div class="line">@array.push;           # add one value on the end</div><div class="line">@array.pop;            # remove one value from the end and return it</div><div class="line">@array.splice($pos,$n);# starting at $pos remove $n values and replace them with values that follow those two</div></pre></td></tr></table></figure>
<ul>
<li>parameters</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">@array.delete(@ind);   # delete all cells with indices in @ind</div><div class="line">@array.exists(@ind);   # Bool::True if all indices of @ind have a value (can be 0 or &apos;&apos;)</div><div class="line">@array.pick([$n]);     # return $n (default is 1) randomly selected values, without duplication</div><div class="line">@array.roll([$n]);     # return $n (default is 1) randomly selected values, duplication possible (like roll dice)</div><div class="line">@array.reverse;        # all elements in reversed order</div><div class="line"># returns a list where $n times first item is taken to last</div><div class="line"># position if $n is positive, if negative the other way around</div><div class="line">@array.rotate($n);</div><div class="line"></div><div class="line">@array.sort($coderef); # returns a list sorted by a user-defined criteria, default is alphanumerical sorting</div><div class="line">@array.min;            # numerical smallest value of that array</div><div class="line">@array.max;            # numerical largest value of that array</div><div class="line">$a,$b= @array.minmax;  # both at once, like in .sort,  .min, or .max, a sorting algorithm can be provided</div><div class="line"></div><div class="line">@array.map($coderef);  # high oder map function, runs $coderef with every value as $_ and returns the list or results</div><div class="line">@array.classify($cr);  # kind of map, but creates a hash, where keys are the results of $cr and values are from @array</div><div class="line">@array.categorize($cr);# kind of classify, but closure can have no (Nil) or several results, so a key can have a list of values</div><div class="line">@array.grep(&#123;$_&gt;1&#125;);   # high order grep, returns only these elements that pass a condition ($cr returns something positive)</div><div class="line">@array.first($coder);  # kind of grep, return just the first matching value</div><div class="line">@array.zip;            # join arrays by picking first element left successively from here and then there</div><div class="line">There is even a whole class of metaoperators that work upon lists.</div></pre></td></tr></table></figure>
<ul>
<li>Hash</li>
</ul>
<p>In Perl 6 a Hash is an unordered list of Pairs. A Pair is a single key =&gt; value association and appears in many places of the language syntax. A hash allows lookup of values by key using {} or &lt;&gt; syntax.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">%dev =  &apos;pugs&apos;=&gt;&apos;audreyt&apos;, &apos;pct&apos;=&gt;&apos;pm&apos;, &quot;STD&quot;=&gt;&apos;larry&apos;;</div><div class="line">%dev = :rakudo(&apos;jnthn&apos;), :testsuite(&apos;moritz&apos;);            # adverb (pair) syntax works as well</div><div class="line">%dev = (&apos;audreyt&apos;, &apos;pugs&apos;, &apos;pm&apos;, &apos;pct&apos;, &apos;larry&apos;, &quot;STD&quot;);  # lists get autoconverted in hash context</div><div class="line">%compiler = Parrot =&gt; &#123;Rakudo =&gt; &apos;jnthn&apos;&#125;, SMOP =&gt; &#123;Mildew =&gt; &apos;ruoso&apos;&#125;;       # hash of hashes (HoH)</div></pre></td></tr></table></figure>
<ul>
<li>Hash Slices</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">$value = %dev&#123;&apos;key&apos;&#125;;      # just give me the value related to that key, like in P5</div><div class="line">$value = %dev&lt;pm&gt;;         # &lt;&gt; autoquotes like qw() in P5</div><div class="line">$value = %dev&lt;&lt;$name&gt;&gt;;    # same thing, just with eval</div><div class="line">@values = %dev&#123;&apos;key1&apos;, &apos;key2&apos;&#125;;</div><div class="line">@values = %dev&lt;key1 key2&gt;;</div><div class="line">@values = %dev&lt;&lt;key1 key2 $key3&gt;&gt;;</div><div class="line">%compiler&lt;Parrot&gt;&lt;Rakudo&gt;; # value in a HoH, returns &apos;jnthn&apos;</div><div class="line">%compiler&lt;SMOP&gt;;           # returns the Pair: Mildew =&gt; &apos;ruoso&apos;</div><div class="line"></div><div class="line">%dev   &#123;&apos;audrey&apos;&#125;;         # error, spaces between varname and braces (postcircumfix operator) are no longer allowed</div><div class="line">%dev\  &#123;&apos;allison&apos;&#125;;        # works, quote the space</div><div class="line">%dev   .&lt;dukeleto&gt;;        # error</div><div class="line">%dev\ .&#123;&apos;patrick&apos;&#125;;        # works too, &quot;long dot style&quot;, because it&apos;s an object in truth</div></pre></td></tr></table></figure>
<ul>
<li>Hash Methods</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">? %dev                     # bool context, true if hash has any pairs</div><div class="line">+ %dev                     # numeric context, returns number of pairs(keys)</div><div class="line">~ %dev                     # string context, nicely formatted 2 column table using \t and \n</div><div class="line"></div><div class="line">$table = %dev;             # same as ~ %dev</div><div class="line">%dev.say;                  # stringified, but only $key and $value are separated by \t</div><div class="line">@pairs = %dev;             # list of all containing pairs</div><div class="line">%dev.pairs                 # same thing in all context</div><div class="line">%dev.elems                 # same as + %dev or + %dev.pairs</div><div class="line">%dev.keys                  # returns a list of all keys</div><div class="line">%dev.values                # list of all values</div><div class="line">%dev.kv                    # flat list with key1, value1, key 2 ...</div><div class="line">%dev.invert                # reverse all key =&gt; value relations</div><div class="line">%dev.push (@pairs)         # inserts a list of pairs, if a key is already present in %dev, both values gets added to an array</div></pre></td></tr></table></figure>
<ul>
<li>Callable</li>
</ul>
<p>Internally subroutines, methods and alike are variables with the sigil &amp; and stored in a fourth namespace. Unlike Perl 5, all subroutines can be overwritten or augmented with user defined routines. Of course scalars can also contain routines.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&amp;function = sub &#123; ... &#125;;         # store subroutine in callable namespace</div><div class="line">function();                      # call/run it</div><div class="line"></div><div class="line">$coderef = sub &#123; ... &#125;;          # store it in a scalar</div><div class="line">$coderef($several, $parameter);  # run that code</div></pre></td></tr></table></figure>
<ul>
<li>Data Types</li>
</ul>
<p>In contrast to variable types (container types) every value has a type too. These are organized internally as classes or roles and can be categorized into 3 piles: the undefined, immutable, and the mutable types.</p>
<p>You can assign one of these types to scalar, array, or hash variables, which enforces the contents to be that type.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">my Int $a;</div><div class="line">my Int @a;  # array of Int</div></pre></td></tr></table></figure>
<ul>
<li>Pair</li>
</ul>
<p>Pairs are new and their syntax is used nearly everywhere in the language where there is an association between a name and a value.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$pair = &apos;jakub&apos; =&gt; &apos;helena&apos;;  # &quot;=&gt;&quot; is the pair constructor</div><div class="line">$pair = :jakub(&apos;helena&apos;);     # same in adverbial notation</div><div class="line">$pair = :jakub&lt;helena&gt;;       # same using &lt;&gt;, the new qw()</div><div class="line">$pair.key                     # returns &apos;jakub&apos;</div><div class="line">$pair.value                   # returns &apos;helena&apos;</div><div class="line">$pair.isa(Pair)               # Bool::True</div></pre></td></tr></table></figure>
<ul>
<li>Enumeration</li>
</ul>
<p>enum</p>
<ul>
<li>Capture</li>
</ul>
<p>Captures are also a new type, which holds the parameters a routine gets. Because Perl now knows both positional and named parameters, it is a mixture of a list and array.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$cap = \(@a,$s,%h,&apos;a&apos;=&gt;3);    # creating a capture, &quot;\&quot; was free since there are no references anymore</div><div class="line">|$cap                         # flatten into argument list (without |, it will pass it as a single value)</div><div class="line">||$cap                        # flatten into semicolon list (meant for variadic functions that take list of lists)</div></pre></td></tr></table></figure>
<p>One important difference between a capture and a compound structure of lists and hashes: While assignments with = will copy the complete content of the named variables, this is not so in the case of a capture. When I change sinthelastexample, thecontentofcap changes too, because when parameters to a routine are variables, they are also interpolated in the moment the routine is called, not when it’s defined.</p>
<ul>
<li>Properties and Traits</li>
</ul>
<p>Properties</p>
<p>xxx</p>
<p>Traits</p>
<p>xxx</p>
<p>Scoping</p>
<p>scope declarator, scopes</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">my $var;</div><div class="line">state</div><div class="line">temp</div><div class="line">let</div><div class="line">our $var;</div><div class="line">$*var;</div><div class="line">Twigils</div></pre></td></tr></table></figure>
<p>xxx</p>
<ul>
<li>Assignment and Binding</li>
</ul>
<p>Assignment</p>
<p>As rightfully expected, assignments are done with the equal sign. But unlike Perl 5 you always get a copy of the right side data assigned to the left, no matter how nested the data structure was (lists of lists eg). You never get in Perl 6 a reference with =. The only exception may be seen captures.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">my @original = [1,2],[3,4];</div><div class="line">my $copy = @original[0]; # $copy points to [1,2]</div><div class="line">@original[0][0] = &apos;fresh stuff&apos;; # $copy[0] holds still 1</div></pre></td></tr></table></figure>
<ul>
<li>Binding</li>
</ul>
<p>Since every variable in Perl 6 is a reference, programmers can use binding to get 2 variables that point to the same memory location.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$original = 5;</div><div class="line">$original := $mirror;       # normal binding, done on runtime</div><div class="line">$original ::= $mirror;      # same thing, but done during compile time</div><div class="line">$original = 3;</div><div class="line">say $mirror;                # prints 3</div><div class="line">$original =:= $mirror       # true, because they&apos;re bound together</div><div class="line">$original === $mirror       # also true, because content and type are equal</div></pre></td></tr></table></figure>
<p>——-<br>    问题描述：</p>
<p>给定 2 个整数， A 和 B。 求这两个数的和</p>
<pre><code>输入数据：
A 和 B 来自输入流， 以空格分割

输出数据：
两个数据的和

Example：

Input    Output
2   2      4
3   2      5
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">say [+] .words for lines</div></pre></td></tr></table></figure>
<p>——-</p>
<pre><code>任务：
以任意的顺序生成 含有 N 个开括号&quot;[&quot;  和 N 个闭括号&quot;]&quot; 的字符串

检查生成的字符串是否平衡
Example：
</code></pre><p>   (empty)   OK</p>
<p>   []        OK   ][        NOT OK</p>
<p>   [][]      OK   ][][      NOT OK</p>
<p>   [[][]]    OK   []][[]    NOT OK</p>
<ul>
<li>Depth counter</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">sub balanced($s) &#123;</div><div class="line">    my $l = 0;</div><div class="line">    for $s.comb &#123;</div><div class="line">        when &quot;]&quot; &#123;</div><div class="line">            --$l;</div><div class="line">            return False if $l &lt; 0;</div><div class="line">        &#125;</div><div class="line">        when &quot;[&quot; &#123;</div><div class="line">            ++$l;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return $l == 0;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $n = prompt &quot;Number of brackets&quot;;</div><div class="line">my $s = (&lt;[ ]&gt; xx $n).pick(*).join;</div><div class="line">say &quot;$s &#123;balanced($s) ?? &quot;is&quot; !! &quot;is not&quot;&#125; well-balanced&quot;</div></pre></td></tr></table></figure>
<ul>
<li>FP oriented</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">sub balanced($s) &#123;</div><div class="line">    .none &lt; 0 and .[*-1] == 0</div><div class="line">        given [\+] &apos;\\&apos; «leg« $s.comb;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $n = prompt &quot;Number of bracket pairs: &quot;;</div><div class="line">my $s = &lt;[ ]&gt;.roll($n*2).join;</div><div class="line">say &quot;$s &#123; balanced($s) ?? &quot;is&quot; !! &quot;is not&quot; &#125; well-balanced&quot;</div></pre></td></tr></table></figure>
<ul>
<li>String munging</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">sub balanced($_ is copy) &#123;</div><div class="line">    () while s:g/&apos;[]&apos;//;</div><div class="line">    $_ eq &apos;&apos;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $n = prompt &quot;Number of bracket pairs: &quot;;</div><div class="line">my $s = &lt;[ ]&gt;.roll($n*2).join;</div><div class="line">say &quot;$s is&quot;, &apos; not&apos; xx not balanced($s)), &quot; well-balanced&quot;;</div></pre></td></tr></table></figure>
<ul>
<li>Parsing with a grammar</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">grammar BalBrack &#123; token TOP &#123; &apos;[&apos; &lt;TOP&gt;* &apos;]&apos; &#125; &#125;</div><div class="line"></div><div class="line">my $n = prompt &quot;Number of bracket pairs: &quot;;</div><div class="line">my $s = (&apos;[&apos; xx $n, &apos;]&apos; xx $n).pick(*).join;</div><div class="line">say &quot;$s &#123; BalBrack.parse($s) ?? &quot;is&quot; !! &quot;is not&quot; &#125; well-balanced&quot;;</div></pre></td></tr></table></figure>
<p>——-</p>
<ul>
<li>凯撒加密</li>
</ul>
<p>实现一个凯撒加密， 编码和解码都要有</p>
<p> key 是一个 1 到 25 之间的整数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">my @alpha = &apos;A&apos; .. &apos;Z&apos;;</div><div class="line">sub encrypt ( $key where 1..25, $plaintext ) &#123;</div><div class="line">    $plaintext.trans( @alpha Z=&gt; @alpha.rotate($key) );</div><div class="line">&#125;</div><div class="line">sub decrypt ( $key where 1..25, $cyphertext ) &#123;</div><div class="line">    $cyphertext.trans( @alpha.rotate($key) Z=&gt; @alpha );</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $original = &apos;THE FIVE BOXING WIZARDS JUMP QUICKLY&apos;;</div><div class="line">my $en = encrypt( 13, $original );</div><div class="line">my $de = decrypt( 13, $en );</div><div class="line"></div><div class="line">.say for $original, $en, $de;</div><div class="line"></div><div class="line">say &apos;OK&apos; if $original eq all( map &#123; .&amp;decrypt(.&amp;encrypt($original)) &#125;, 1..25 );</div></pre></td></tr></table></figure>
<pre><code>Output:
THE FIVE BOXING WIZARDS JUMP QUICKLY
GUR SVIR OBKVAT JVMNEQF WHZC DHVPXYL
THE FIVE BOXING WIZARDS JUMP QUICKLY
OK
</code></pre><p>——-</p>
<ul>
<li>日期格式化</li>
</ul>
<p>使用 “2007-11-10” 和 “ Sunday, November 10, 2007” 日期格式显式当前日期</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">use DateTime::Utils;</div><div class="line"></div><div class="line">my $dt = DateTime.now;</div><div class="line"></div><div class="line">say strftime(&apos;%Y-%m-%d&apos;, $dt);</div><div class="line">say strftime(&apos;%A, %B %d, %Y&apos;, $dt);</div></pre></td></tr></table></figure>
<p>——-</p>
<ul>
<li><p>阶乘</p>
<p>n 的阶乘定义为 <code>n*(n-1)*(n-2)…*1</code>, 零的阶乘为1.</p>
<p>定义一个函数返回一个数字的阶乘。</p>
</li>
<li><p>使用自定义后缀操作符</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">sub postfix:&lt;!&gt;($n where $n &gt; 0) &#123;</div><div class="line">    [*] 2..$n</div><div class="line">&#125;</div><div class="line">say 5!</div></pre></td></tr></table></figure>
<ul>
<li>[*]</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">my @a = 1, [\*] 1..*;</div><div class="line">say @a[5];</div></pre></td></tr></table></figure>
<p>——-</p>
<ul>
<li>动画</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">my $row-count = 6;</div><div class="line"></div><div class="line">constant $peg = &quot;*&quot;;</div><div class="line">constant @coin-icons = &quot;\c[UPPER HALF BLOCK]&quot;, &quot;\c[LOWER HALF BLOCK]&quot;;</div><div class="line"></div><div class="line">sub display-board(@positions, @stats is copy, $halfstep) &#123;</div><div class="line">    my $coin = @coin-icons[$halfstep.Int];</div><div class="line"></div><div class="line">    state @board-tmpl = &#123;</div><div class="line">        # precompute a board</div><div class="line">        my @tmpl;</div><div class="line">        sub out(*@stuff) &#123;</div><div class="line">            @tmpl.push: @stuff&gt;&gt;.ords.item;</div><div class="line">        &#125;</div><div class="line">        # three lines of space above</div><div class="line">        for (1..3) &#123;</div><div class="line">            out &quot;  &quot;, &quot; &quot; x (2 * $row-count);</div><div class="line">        &#125;</div><div class="line">        # $row-count lines of pegs</div><div class="line">        for ($row-count...1) Z (1...$row-count) -&gt; $spaces, $pegs &#123;</div><div class="line">            out &quot;  &quot;, &quot; &quot; x $spaces, ($peg xx $pegs).join(&quot; &quot;), &quot; &quot; x $spaces;</div><div class="line">        &#125;</div><div class="line">        # four lines of space below</div><div class="line">        for (1..4) &#123;</div><div class="line">            out &quot;  &quot;, &quot; &quot; x (2 * $row-count);</div><div class="line">        &#125;</div><div class="line">        @tmpl</div><div class="line">    &#125;();</div><div class="line"></div><div class="line">    my $midpos = $row-count + 2;</div><div class="line"></div><div class="line">    my @output;</div><div class="line">    &#123;</div><div class="line">        # collect all the output and output it all at once at the end</div><div class="line">        sub say(Str $foo) &#123;</div><div class="line">            @output.push: $foo, &quot;\n&quot;;</div><div class="line">        &#125;</div><div class="line">        sub print(Str $foo) &#123;</div><div class="line">            @output.push: $foo;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        # make some space above the picture</div><div class="line">        say &quot;&quot; for ^10;</div><div class="line"></div><div class="line">        my @output-lines = map &#123; [map *.clone, @$_].item &#125;, @board-tmpl;</div><div class="line">        # place the coins</div><div class="line">        for @positions.kv -&gt; $line, $pos &#123;</div><div class="line">            next unless $pos.defined;</div><div class="line">            @output-lines[$line][$pos + $midpos] = $coin.ord;</div><div class="line">        &#125;</div><div class="line">        # output the board with its coins</div><div class="line">        for @output-lines -&gt; @line &#123;</div><div class="line">            say @line&gt;&gt;.chr.join(&quot;&quot;);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        # show the statistics</div><div class="line">        my $padding = 0;</div><div class="line">        while any(@stats) &gt; 0 &#123;</div><div class="line">            $padding++;</div><div class="line">            print &quot;  &quot;;</div><div class="line">            @stats = do for @stats -&gt; $stat &#123;</div><div class="line">                given $stat &#123;</div><div class="line">                    when 1 &#123;</div><div class="line">                        print &quot;\c[UPPER HALF BLOCK]&quot;;</div><div class="line">                        $stat - 1;</div><div class="line">                    &#125;</div><div class="line">                    when * &lt;= 0 &#123;</div><div class="line">                        print &quot; &quot;;</div><div class="line">                        0</div><div class="line">                    &#125;</div><div class="line">                    default &#123;</div><div class="line">                        print &quot;\c[FULL BLOCK]&quot;;</div><div class="line">                        $stat - 2;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            say &quot;&quot;;</div><div class="line">        &#125;</div><div class="line">        say &quot;&quot; for $padding...^10;</div><div class="line">    &#125;</div><div class="line">    say @output.join(&quot;&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">sub simulate($coins is copy) &#123;</div><div class="line">    my $alive = True;</div><div class="line"></div><div class="line">    sub hits-peg($x, $y) &#123;</div><div class="line">        if 3 &lt;= $y &lt; 3 + $row-count and -($y - 2) &lt;= $x &lt;= $y - 2 &#123;</div><div class="line">            return not ($x - $y) %% 2;</div><div class="line">        &#125;</div><div class="line">        return False;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    my @coins = Int xx (3 + $row-count + 4);</div><div class="line">    my @stats = 0 xx ($row-count * 2);</div><div class="line">    # this line will dispense coins until turned off.</div><div class="line">    @coins[0] = 0;</div><div class="line">    while $alive &#123;</div><div class="line">        $alive = False;</div><div class="line">        # if a coin falls through the bottom, count it</div><div class="line">        given @coins[*-1] &#123;</div><div class="line">            when *.defined &#123;</div><div class="line">                @stats[$_ + $row-count]++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        # move every coin down one row</div><div class="line">        for ( 3 + $row-count + 3 )...1 -&gt; $line &#123;</div><div class="line">            my $coinpos = @coins[$line - 1];</div><div class="line"></div><div class="line">            @coins[$line] = do if not $coinpos.defined &#123;</div><div class="line">                Nil</div><div class="line">            &#125; elsif hits-peg($coinpos, $line) &#123;</div><div class="line">                # when a coin from above hits a peg, it will bounce to either side.</div><div class="line">                $alive = True;</div><div class="line">                ($coinpos - 1, $coinpos + 1).pick;</div><div class="line">            &#125; else &#123;</div><div class="line">                # if there was a coin above, it will fall to this position.</div><div class="line">                $alive = True;</div><div class="line">                $coinpos;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        # let the coin dispenser blink and turn it off if we run out of coins</div><div class="line">        if @coins[0].defined &#123;</div><div class="line">            @coins[0] = Nil</div><div class="line">        &#125; elsif --$coins &gt; 0 &#123;</div><div class="line">            @coins[0] = 0</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        # smooth out the two halfsteps of the animation</div><div class="line">        my $start-time;</div><div class="line">        ENTER &#123; $start-time = now &#125;</div><div class="line">        my $wait-time = now - $start-time;</div><div class="line"></div><div class="line">        sleep 0.1 - $wait-time if $wait-time &lt; 0.1;</div><div class="line">        for @coin-icons.keys &#123;</div><div class="line">            sleep $wait-time max 0.1;</div><div class="line">            display-board(@coins, @stats, $_);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">sub MAIN($coins = 20, $peg-lines = 6) &#123;</div><div class="line">    $row-count = $peg-lines;</div><div class="line">    simulate($coins);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>调用方式： perl6 Galton_box_animation.p6 50 8</p>
<p>——-</p>
<ul>
<li>列表和迭代</li>
</ul>
<p>Perl 6 中的列表扩展为惰性列表、无限列表、元素可变列表、元素不可变列表、类型列表、展开行为等等。</p>
<p>对于程序员来说，列表潜在是懒惰并含有无限元素的序列。列表是可变的，你可以通过诸如 push、pop、shift、unshift、splice等操作符来操作序列。列表中的元素可以是可变的或者不可变的。</p>
<p>列表对象是基于位置的，意味着它们能被绑定到数组变量上，并且支持 <code>.[]</code> 后缀操作符。</p>
<p>列表也是懒惰的，因为列表中的元素可以来自于能按需产生元素的生成函数（叫做迭代）。</p>
<p>数组就是一个所有元素都存储在标量容器的列表。</p>
<p>逗号操作符 <code>infix:&lt;,&gt;</code> 创建 Parcel 对象。这些不应该改和列表混淆； Parcel 是一种未经加工的元素序列。Parcel 是不可变的，尽管 Parcel中的元素可以是不可变的，也可是不可变的。</p>
<p>Parcel 来自于短语  “parenthesis cell”. 因为很多 Parcel 对象出现在圆括号里面。然而，除了空的 parcel，是逗号操作符创建了 Parcel 对象。</p>
<pre><code>()       # empty Parcel
(1)      # 一个整数
(1,2)    # a Parcel with two Ints
(1,)     # a Parcel with one Int
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&gt; (1).WHAT()</div><div class="line">(Int)</div><div class="line">&gt; (1,).WHAT()</div><div class="line">(Parcel)</div></pre></td></tr></table></figure>
<p>Parcel 也是位置的，并且对于诸如  <code>.[]</code> 和 <code>.elems</code> 列表操作会使用 展开上下文。查看下面的  “Flattening contexts”。访问没有展开的原始参数，你可以使用 <code>.arg($n)</code> 代替 <code>.[$n]</code>, 和 <code>.args</code> 代替 <code>.elems</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&gt; (1,2,3).elems</div><div class="line">3</div><div class="line">&gt; (1,2,3).[2]</div><div class="line">3</div><div class="line">&gt; (1,2,3).[1]</div><div class="line">2</div><div class="line"></div><div class="line">&gt; my $a =(1,2,3,(4,5,6),7).[3]</div><div class="line">4 5 6</div><div class="line">&gt; $a.WHAT.say</div><div class="line">(Parcel)</div><div class="line">&gt; $a.[2]</div><div class="line">6</div><div class="line">&gt; $a.[1]</div><div class="line">5</div><div class="line"></div><div class="line">&gt; [+] $a.list</div><div class="line">15</div></pre></td></tr></table></figure>
<p>列表和Parcel 对象都把其它容器对象作为元素。在一些上下文中，我们想把容器对象的值插入到列表或 parcel的周围，而在其它上下文中，我们想保留所有的子容器。这样的插值叫做 展开。</p>
<p>列表和Parcel都是可迭代的，可迭代表明它支持 <code>.iterator</code> 方法</p>
<p>标量容器中存储的对象不会在 flattening 上下文中插值，即使那个对象是可迭代的。</p>
<pre><code>my @a = 3,4,5;
for 1,2,@a  { .say }        # 5次迭代
</code></pre><p>1<br>2<br>3<br>4<br>5</p>
<pre><code>my $s = @a;
for 1,2,$s { ... }         # 3次迭代
</code></pre><p>1<br>2<br>3 4 5</p>
<p>这里，<code>$s</code> 和 <code>@a</code> 指向同一个数组对象，但是标量容器的出现阻止 <code>$s</code> 被展开到 for 循环中。</p>
<p>.list 和 .flat 方法能被用于还原展开行为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">for 1,2,$s.list &#123; .say &#125;    # 5次遍历</div><div class="line">for 1,2,@($s)   &#123; .say  &#125;   # 5次遍历，@()会强制为列表上下文</div></pre></td></tr></table></figure>
<p>1<br>2<br>3<br>4<br>5</p>
<p>相反，<code>.item</code> 方法和 <code>$()</code> 能用于防止插值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">    my @b = 1,2,@a;           # @b 有5个元素</div><div class="line">    my @c = 1,2,@a.item;      # @c 有3个元素</div><div class="line">    my @c = 1,2,$(@a);        # 同上</div><div class="line"></div><div class="line">&gt; say +@c</div><div class="line">3</div></pre></td></tr></table></figure>
<p>迭代器</p>
<p><code>.reify($n)</code> 方法要求迭代器返回一个含有至少<code>$n</code>个具体元素的 Parcel，后面跟着序列中剩余元素的附加的迭代器，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">my $r = 10..50;</div><div class="line">say $r.iterator.reify(5).perl;  # (10, 11, 12, 13, 14, 15..50)</div></pre></td></tr></table></figure>
<blockquote>
<p>say $r.iterator.reify(*).perl<br>(10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 37, 48, 49, 50)</p>
</blockquote>
<ul>
<li>Feed operators</li>
</ul>
<p>feed操作符是完全懒惰的，意味着在使用者要求任何元素之前不会执行任何操作。这就是</p>
<p>  my @a &lt;== grep { … } &lt;== map { … } &lt;== grep { … } &lt;== 1, 2, 3</p>
<p>是完全懒惰的。</p>
<p>——</p>
<ul>
<li><p>Grammars 文法</p>
<p>  Named Regexes<br>  Creating Grammars<br>  Methods<br>  method parse<br>  method subparse<br>  method parsefile<br>  Action Classes</p>
</li>
</ul>
<p>文法是一种强大的工具, 用于拆解文本,并通常返回数据结构<br>例如, Perl 6 是使用 Perl 6 风格的文法解析和执行的.<br>对普通 Perl 6 用户来说,一个更实用的例子就是 JSON::Simple 模块, 这个模块能反序列化任何有效的 JSON 文件, 反序列化代码还写了不到 100 行, 简单,可扩展.</p>
<p>词法允许你组织正则, 就像类允许你组织普通代码的方法一样.</p>
<h2 id="命名正则-Named-Regexes"><a href="#命名正则-Named-Regexes" class="headerlink" title="命名正则 Named Regexes"></a>命名正则 Named Regexes</h2><hr>
<p>命名正则有特殊的语法, 与<strong>子例程</strong>的定义类似:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">my regex number &#123; \d+ [ \. \d+ ]? &#125;</div></pre></td></tr></table></figure>
<p>这个例子中, 我们必须使用 <strong> my </strong> 关键词指定这个正则是词法作用域的, 因为 <strong>命名正则</strong> 通常用在 词法中.<br>给正则命名后有利于在其他地方<code>复用</code>正则:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">say &quot;32.51&quot;    ~~ &amp;number;</div><div class="line">say &quot;15 + 4.5&quot; ~~ / &lt;number&gt; \s* &apos;+&apos; \s* &lt;number&gt; /</div></pre></td></tr></table></figure>
<p>首先说下, 使用 <code>regex/token/rule</code> 定义了一个正则表达式后怎么去调用它:<br>就像调用一个子例程那样, 使用 <code>&amp;</code> 符号:<br>&amp; 后面跟正则表达式的名字,  即 &amp;regex_name<br>regex 不是命名正则仅有的标识符 – 实际上, 它用的不多. 大多数时候, 用的最多的是 <code>token</code> 和 <code>rule</code> 标识符. 它们都是<code>不能回溯</code>的, 这意味着正则引擎在匹配失败时不会备份和重试. 这通常是你想要的, 但不是对所有场合都合适:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">my regex works-but-slow &#123; .+ q &#125;</div><div class="line">my token fails-but-fast &#123; .+ q &#125;</div><div class="line">my $s = &apos;Tokens won\&apos;t backtrack, which makes them fail quicker!&apos;; # Tokens 不会沿原路返回, 这让它们更快地失败!</div><div class="line">say so $s ~~ &amp;works-but-slow; # True</div><div class="line">say so $s ~~ &amp;fails-but-fast; # False, the entire string get taken by the .+</div></pre></td></tr></table></figure>
<p><code>token</code> 和 <code>rule</code> 标识符的不同之处在于 <code>rule</code> 标识符让 <code>Regex</code> 的 <code>:sigspace</code> 起作用了:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">my token non-space-y &#123; once upon a time &#125;</div><div class="line">my rule space-y      &#123; once upon a time &#125;</div><div class="line">say &apos;onceuponatime&apos;    ~~ &amp;non-space-y;</div><div class="line">say &apos;once upon a time&apos; ~~ &amp;space-y;</div></pre></td></tr></table></figure>
<h2 id="创建文法-Creating-Grammars"><a href="#创建文法-Creating-Grammars" class="headerlink" title="创建文法 Creating Grammars"></a>创建文法 Creating Grammars</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">class Grammar is Cursor &#123; &#125;</div></pre></td></tr></table></figure>
<p>使用 grammar 关键字而非 <code>class</code> 关键字声明文法. Grammars 应该只用于<code>解析文本</code>; 如果你想<code>提取</code>复杂的数据, 建议将 <code>action</code> 类 和 <code>grammar</code> 结合使用.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">grammar CSV &#123;</div><div class="line">    token TOP &#123; [ &lt;line&gt; \n? ]+ &#125;</div><div class="line">    token line &#123;</div><div class="line">        ^^            # Beginning of a line</div><div class="line">        &lt;value&gt;* % \, # Any number of &lt;value&gt;s with commas in `between` them</div><div class="line">        $$            # End of a line</div><div class="line">    &#125;</div><div class="line">    token value &#123;</div><div class="line">        [</div><div class="line">        | &lt;-[&quot;,\n]&gt;     # Anything not a double quote, comma or newline</div><div class="line">        | &lt;quoted-text&gt; # Or some quoted text</div><div class="line">        ]*              # Any number of times</div><div class="line">    &#125;</div><div class="line">    token quoted-text &#123;</div><div class="line">        \&quot;</div><div class="line">        [</div><div class="line">        | &lt;-[&quot;\\]&gt; # Anything not a &quot; or \</div><div class="line">        | &apos;\&quot;&apos;     # Or \&quot;, an escaped quotation mark</div><div class="line">        ]*         # Any number of times</div><div class="line">        \&quot;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">say &quot;Valid CSV file!&quot; if CSV.parse( q:to/EOCSV/ );</div><div class="line">    Year,Make,Model,Length</div><div class="line">    1997,Ford,E350,2.34</div><div class="line">    2000,Mercury,Cougar,2.38</div><div class="line">    EOCSV</div></pre></td></tr></table></figure>
<ul>
<li><p>方法    Methods</p>
</li>
<li><p>方法解析</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">method parse($str, :$rule = &apos;TOP&apos;, :$actions) returns Match:D</div></pre></td></tr></table></figure>
<p>让 grammar 与 $str 匹配,使用 $rule 作为起始 rule, 选择性地将 $action 作为 action 对象应用.</p>
<p>如果 grammar 不能解析全部文本就会失败. 如果只想解析部分字符串, 使用 subparse<br>返回结果匹配对象, 并设置调用者的 <code>$/</code> 变量为结果匹配对象.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">say CSV.parse( q:to/EOCSV/ );</div><div class="line">    Year,Make,Model,Length</div><div class="line">    1997,Ford,E350,2.34</div><div class="line">    2000,Mercury,Cougar,2.38</div><div class="line">    EOCSV</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">	This outputs:</div><div class="line"></div><div class="line">｢Year,Make,Model,Length</div><div class="line">1997,Ford,E350,2.34</div><div class="line">2000,Mercury,Cougar,2.38</div><div class="line">｣</div><div class="line"> line =&gt; ｢Year,Make,Model,Length｣</div><div class="line">  value =&gt; ｢Year｣</div><div class="line">  value =&gt; ｢Make｣</div><div class="line">  value =&gt; ｢Model｣</div><div class="line">  value =&gt; ｢Length｣</div><div class="line"> line =&gt; ｢1997,Ford,E350,2.34｣</div><div class="line">  value =&gt; ｢1997｣</div><div class="line">  value =&gt; ｢Ford｣</div><div class="line">  value =&gt; ｢E350｣</div><div class="line">  value =&gt; ｢2.34｣</div><div class="line"> line =&gt; ｢2000,Mercury,Cougar,2.38 ｣</div><div class="line">  value =&gt; ｢2000｣</div><div class="line">  value =&gt; ｢Mercury｣</div><div class="line">  value =&gt; ｢Cougar｣</div><div class="line">  value =&gt; ｢2.38 ｣</div></pre></td></tr></table></figure>
<h2 id="method-subparse"><a href="#method-subparse" class="headerlink" title="method subparse"></a>method subparse</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">method subparse($str, :$rule = &apos;TOP&apos;, :$actions) returns Match:D</div></pre></td></tr></table></figure>
<p>将 <code>$str</code> 与 grammar 匹配, 使用 <code>$rule</code> 作为<code>起始 rule</code>, 选择性将 <code>$action</code> 作为 <code>action</code> 对象应用.<br>不像 <code>parse</code> , <code>subparse</code> 允许 <code>grammar</code> 只匹配所提供的字符串的一部分.</p>
<h2 id="method-parsefile"><a href="#method-parsefile" class="headerlink" title="method parsefile"></a>method parsefile</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">method parsefile(Cool $filename as Str, *%opts) 返回 Match:D</div></pre></td></tr></table></figure>
<pre><code>使用 parse 方法解析 文件 $filename 的内容, 传递任何命名选项到 %opts
</code></pre><h2 id="Action-Classes"><a href="#Action-Classes" class="headerlink" title="Action Classes"></a>Action Classes</h2><hr>
<p>In fact, named regexes can even take extra arguments, using the same syntax as subroutine parameter lists<br>实际上, 命名正则甚至能接受额外的参数, 它使用的语法跟子例程参数列表的语法一样.</p>
<p>​写一个程序打印从 1  到 100 的整数，但是对 3 的倍数打印 “Fizz”, 对 5 的倍数打印 “Buzz”, 对于即是 3 的倍数，又是 5 的倍数的打印 “FizzBuzz”.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">for 1 .. 100 &#123;</div><div class="line">    when $_ %% (3 &amp; 5) &#123; say &apos;FizzBuzz&apos;; &#125;</div><div class="line">    when $_ %% 3       &#123; say &apos;Fizz&apos;;     &#125;</div><div class="line">    when $_ %% 5       &#123; say &apos;Buzz&apos;;     &#125;</div><div class="line">    default            &#123; .say;           &#125;</div><div class="line">&#125;</div><div class="line">Or abusing multi subs:</div><div class="line"></div><div class="line"></div><div class="line">```perl6</div><div class="line">multi sub fizzbuzz(Int $ where * %% 15) &#123; &apos;FizzBuzz&apos; &#125;</div><div class="line">multi sub fizzbuzz(Int $ where * %% 5)  &#123; &apos;Buzz&apos;     &#125;</div><div class="line">multi sub fizzbuzz(Int $ where * %% 3)  &#123; &apos;Fizz&apos;     &#125;</div><div class="line">multi sub fizzbuzz(Int $number )        &#123; $number    &#125;</div><div class="line">(1 .. 100)».&amp;fizzbuzz.join(&quot;\n&quot;).say;</div></pre></td></tr></table></figure>
<p>Most concisely:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">say &apos;Fizz&apos; x $_ %% 3 ~ &apos;Buzz&apos; x $_ %% 5 || $_ for 1 .. 100;</div></pre></td></tr></table></figure>
<p>And here’s an implementation that never checks for divisibility:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">.say for</div><div class="line">    ((&apos;&apos; xx 2, &apos;Fizz&apos;) xx * Z~</div><div class="line">    (&apos;&apos; xx 4, &apos;Buzz&apos;) xx *) Z||1 .. 100;</div></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>
    
    <div>
      
        
<div style="text-align:center;color: #ccc;font-size:15px;">
------ Young For Perl 6! ------</div>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Examples/" rel="tag">#Examples</a>
          
            <a href="/tags/特性/" rel="tag">#特性</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/03/15/when和where/" rel="next" title="When and Where">
                <i class="fa fa-chevron-left"></i> When and Where
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/03/16/操作符/" rel="prev" title="操作符">
                操作符 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2015/03/16/Perl6中的特性-二/"
     data-title="Perl 6 中的特性(二)"
     data-content=""
     data-url="https://ohmycloud.github.io/2015/03/16/Perl6中的特性-二/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2015/03/16/Perl6中的特性-二/"
           data-title="Perl 6 中的特性(二)" data-url="https://ohmycloud.github.io/2015/03/16/Perl6中的特性-二/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="焉知非鱼" />
          <p class="site-author-name" itemprop="name">焉知非鱼</p>
          <p class="site-description motion-element" itemprop="description">Young For Perl 6</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">162</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">178</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ohmycloud" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/740011611" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/9b20c7d63b77" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-location-arrow"></i>
                  
                  简书
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://perl6.org/" target="_blank" title="Perl 6">
                  
                    <i class="fa fa-fw fa-fire"></i>
                  
                  Perl 6
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://pl6anet.org/" target="_blank" title="pl6anet">
                  
                    <i class="fa fa-fw fa-umbrella"></i>
                  
                  pl6anet
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://docs.perl6.org/" target="_blank" title="perl6doc">
                  
                    <i class="fa fa-fw fa-angle-double-right"></i>
                  
                  perl6doc
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Set"><span class="nav-number">1.</span> <span class="nav-text">Set</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Series-Operator"><span class="nav-number">2.</span> <span class="nav-text">Series Operator</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Grammars"><span class="nav-number">3.</span> <span class="nav-text">Grammars</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Great-List-Refactor"><span class="nav-number">4.</span> <span class="nav-text">Great List Refactor</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Perl-6-Examples"><span class="nav-number">5.</span> <span class="nav-text">Perl 6 Examples</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Best-Of-Perl-6"><span class="nav-number">6.</span> <span class="nav-text">Best Of Perl 6</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Perl-6-Variable"><span class="nav-number">7.</span> <span class="nav-text">Perl 6 Variable</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#命名正则-Named-Regexes"><span class="nav-number">8.</span> <span class="nav-text">命名正则 Named Regexes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#创建文法-Creating-Grammars"><span class="nav-number">9.</span> <span class="nav-text">创建文法 Creating Grammars</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#method-subparse"><span class="nav-number">10.</span> <span class="nav-text">method subparse</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#method-parsefile"><span class="nav-number">11.</span> <span class="nav-text">method parsefile</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Action-Classes"><span class="nav-number">12.</span> <span class="nav-text">Action Classes</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">焉知非鱼</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  托管在 -
  <a class="theme-link" href="https://github.com/ohmycloud/ohmycloud.github.io">
    Github
  </a>
  &nbsp; | &nbsp;
</div>

<div class="theme-info">
 <a class="51-img" href="/images/footer.gif" target="_blank"><img alt="统计" src="/images/footer.gif"  align="right" /></a>
<div>
        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"chenyf"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  

  

  

</body>
</html>
