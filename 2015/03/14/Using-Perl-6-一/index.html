<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|monospace:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Using Perl 6,约束," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="第一章 概要
 Comming soon!
第二章 基础
假设有一场乒乓球比赛，比赛结果以这种格式记录：Player1 Player2 | 3:2这意味着选手1与选手2的比分为3:2, 你需要一个脚本算出每位选手赢了几场比赛并且胜了几局。输入数据（存储在一个叫做scores的文件中）像下面这样：1234567Beth Ana Charlie DaveAna Dave        | 3:0Cha">
<meta property="og:type" content="article">
<meta property="og:title" content="Using Perl 6(一)">
<meta property="og:url" content="https://ohmycloud.github.io/2015/03/14/Using-Perl-6-一/index.html">
<meta property="og:site_name" content="Perl 6 青春小站">
<meta property="og:description" content="第一章 概要
 Comming soon!
第二章 基础
假设有一场乒乓球比赛，比赛结果以这种格式记录：Player1 Player2 | 3:2这意味着选手1与选手2的比分为3:2, 你需要一个脚本算出每位选手赢了几场比赛并且胜了几局。输入数据（存储在一个叫做scores的文件中）像下面这样：1234567Beth Ana Charlie DaveAna Dave        | 3:0Cha">
<meta property="og:updated_time" content="2016-10-23T16:44:10.030Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Using Perl 6(一)">
<meta name="twitter:description" content="第一章 概要
 Comming soon!
第二章 基础
假设有一场乒乓球比赛，比赛结果以这种格式记录：Player1 Player2 | 3:2这意味着选手1与选手2的比分为3:2, 你需要一个脚本算出每位选手赢了几场比赛并且胜了几局。输入数据（存储在一个叫做scores的文件中）像下面这样：1234567Beth Ana Charlie DaveAna Dave        | 3:0Cha">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"hide"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://ohmycloud.github.io/2015/03/14/Using-Perl-6-一/"/>

  <title> Using Perl 6(一) | Perl 6 青春小站 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Perl 6 青春小站</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>
 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Using Perl 6(一)
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-03-14T13:14:00+08:00" content="2015-03-14">
              2015-03-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Perl-6/" itemprop="url" rel="index">
                    <span itemprop="name">Perl 6</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/03/14/Using-Perl-6-一/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/03/14/Using-Perl-6-一/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="第一章-概要"><a href="#第一章-概要" class="headerlink" title="第一章 概要"></a>第一章 概要</h2><hr>
<p> Comming soon!</p>
<h2 id="第二章-基础"><a href="#第二章-基础" class="headerlink" title="第二章 基础"></a>第二章 基础</h2><hr>
<p>假设有一场乒乓球比赛，比赛结果以这种格式记录：<br>Player1 Player2 | 3:2<br>这意味着选手1与选手2的比分为3:2, 你需要一个脚本算出每位选手赢了几场比赛并且胜了几局。<br>输入数据（存储在一个叫做scores的文件中）像下面这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Beth Ana Charlie Dave</div><div class="line">Ana Dave        | 3:0</div><div class="line">Charlie Beth    | 3:1</div><div class="line">Ana Beth        | 2:3</div><div class="line">Dave Charlie    | 3:0</div><div class="line">Ana Charlie     | 3:1</div><div class="line">Beth Dave       | 0:3</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p> 第一行是选手清单。随后每一行记录着比赛结果。</p>
<p>这里使用Perl6给出一种解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">use v6;</div><div class="line"></div><div class="line">my $file = open &apos;scores&apos;;</div><div class="line">my @names = $file.get.words ;  #get方法读入一行，每调用一次get，读取一行</div><div class="line"># &gt; @names.perl   #  Array.new(&quot;1&quot;, &quot;Beth&quot;, &quot;Ana&quot;, &quot;Charlie&quot;, &quot;Dave&quot;)</div><div class="line">my %matches;      # 赢得比赛次数</div><div class="line">my %sets;         # 赢得比赛局数</div><div class="line"></div><div class="line">for $file.lines -&gt; $line &#123;                       # .lines 是惰性的</div><div class="line">    my ($pairing, $result) = $line.split(&apos; | &apos;); # 对剩下的每一行调用split操作</div><div class="line">    my ($p1, $p2)          = $pairing.words;     # 提取选手1和选手2的名字</div><div class="line">    my ($r1, $r2)          = $result.split(&apos;:&apos;); # 提取比赛比分</div><div class="line"></div><div class="line">    %sets&#123;$p1&#125; += $r1;  # 选手1赢得的比赛局数</div><div class="line">    %sets&#123;$p2&#125; += $r2;  # 选手2赢得的比赛局数</div><div class="line"></div><div class="line">    if $r1 &gt; $r2 &#123; # 如果每场比赛中，选手1赢的局数多于选手2，则选手1赢得的比赛数+1，反之选手2的+1</div><div class="line">        %matches&#123;$p1&#125;++;</div><div class="line">    &#125; else &#123;</div><div class="line">        %matches&#123;$p2&#125;++;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my @sorted = @names.sort( &#123; %sets&#123;$_&#125; &#125; ).sort(&#123; %matches&#123;$_&#125; &#125; ).reverse;</div><div class="line"></div><div class="line">for @sorted -&gt; $n &#123;</div><div class="line">    say &quot;$n has won %matches&#123;$n&#125; matches and %sets&#123;$n&#125; sets&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Ana has won 2 matches and 8 sets</div><div class="line">Dave has won 2 matches and 6 sets</div><div class="line">Charlie has won 1 matches and 4 sets</div><div class="line">Beth has won 1 matches and 4 sets</div></pre></td></tr></table></figure>
<p>每个 Perl 6程序应该以 use v6;作为开始，它告诉编译器程序期望的是哪个版本的Perl。</p>
<p>在Perl6中，一个变量名以一个魔符打头，这个魔符是一个非字母数字符号，诸如$,@,%或者 &amp;,还有更少见的双冒号 ::<br>内置函数 open 打开了一个名叫 scores 的文件，并返回一个文件句柄，即一个代表该文件的对象。赋值符号=将句柄赋值给左边的变量，这意味着 $file 现在存储着该文件句柄。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">my @names = $file.get.words;</div></pre></td></tr></table></figure>
<p> 上边这句的右侧对存储在 $file 中的文件句柄调用了 get 方法， get 方法从文件中读取并返回一行，并去掉行的末尾。. words  也是一个方法，用于从get 方法返回的字符串上。.words 方法将它的组件–它操作的字符串，分解成一组单词，这里即意味着不含空格的字符串。它把单个字符串 ‘Beth Ana Charlie Dave’ 转换成一组字符串 ‘Beth’, ‘Ana’, ‘Charlie’, ‘Dave’.最后，这组字符串存储在数组@names中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">my %matches;</div><div class="line">my %sets;</div></pre></td></tr></table></figure>
<p>在比分计数程序中，%matches 存储每位选手赢得的比赛数。 %sets 存储每位选手赢得的比赛局数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">for $file.lines -&gt; $line &#123;</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>for循环中 $file.lines 产生一组从文件 scores 读取的行，从上次 $file.lines 离开的地方开始，一直到文件末尾结束。<br>在第一次循环中， $line 会包含字符串 <code>Ana Dave | 3:0;</code> 在第二次循环中，$line 会包含 <code>Charlie Beth | 3:1</code>,以此类推。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">my ($pairing, $result) = $line.split(&apos; | &apos;);</div></pre></td></tr></table></figure>
<p>split此处是一个方法，字符串 ‘|’ 是它的参数。</p>
<p>第一次循环结束：</p>
<pre><code>Variable       Contents
$line           &apos;Ana Dave | 3:0&apos;
$pairing        &apos;Ana Dave&apos;
$result         &apos;3:0&apos;
$p1             &apos;Ana&apos;
$p2             &apos;Dave&apos;
$r1              &apos;3&apos;
$r2              &apos;0&apos;
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">my @sorted = @names.sort(&#123; %sets&#123;$_&#125; &#125;).sort(&#123; %matches&#123;$_&#125; &#125;).reverse;</div></pre></td></tr></table></figure>
<p>这一句是排序，先按比赛局数多少排序，再按赢得的比赛数排序，然后反转。<br>打印选手名字的时候以胜负次序排序，代码必须使用选手的分数，而非他们的名字来进行排序。sort 方法的参数是一个代码块，用于将数组元素（选手的名字）转换成用于排序的数据。数组的元素通过变量 $_ 传递到代码块中。</p>
<p>最简单的使用分数排序选手的方法应该是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@names.sort( &#123; %matches&#123;$_&#125; &#125; )</div></pre></td></tr></table></figure>
<p>这是通过使用赢得比赛的次数来进行排序。然而，Ana和Dave都赢了两场比赛。还需要比较谁赢的的比赛局数多，才能决定比赛的排名。</p>
<p>在双引号括起的字符串中，标量和花括号中的变量能进行变量插值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">my $names = &apos;things&apos;;</div><div class="line">say &apos;Do not call me $names&apos;;   # Do not call me $names</div><div class="line">say &quot;Do not call me $names&quot;; # Do not call me things</div></pre></td></tr></table></figure>
<p>花括号中的数组进行插值后会变成用空格分隔的条目。花括号中的散列插值后每个散列键值对单独成为一行，每行包含一个健，随后是一个tab符号，然后是键值，最后是一个新行符。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">TODO: explain &lt;...&gt; quote-words</div><div class="line"> say &quot;Math: &#123; 1 + 2 &#125;&quot;     # Math: 3</div><div class="line"> my @people = &lt;Luke Matthew Mark&gt;;</div><div class="line"> say &quot;The synoptics are: &#123;@people&#125;&quot; # The synoptics are: Luke Matthew Mark</div><div class="line"></div><div class="line"> say &quot;&#123;%sets&#125;&quot;; # From the table tennis tournament</div><div class="line"></div><div class="line"> # Charlie 4</div><div class="line"> # Dave 6</div><div class="line"> # Ana 8</div><div class="line"> # Beth 4</div></pre></td></tr></table></figure>
<p>当数组和散列变量直接出现在双引号字符串中（并且不在花括号{}里），它们只在它们的名字后跟着一个 postcircumfix —-一对括号，后面跟着语句时才会进行插值。在变量名和后置环缀之间进行方法调用也是可以的（ 例如  @flavours.sort() ）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">my @flavours = &lt;vanilla peach&gt;;</div><div class="line"></div><div class="line">say &quot;we have @flavours&quot;;    # we have @flavours ，这里没进行插值</div><div class="line">say &quot;we have @flavours[0]&quot;; # we have vanilla，后置环缀，变量名字后面跟着一对儿括号</div><div class="line"># so-called &quot;Zen slice&quot;</div><div class="line">say &quot;we have @flavours[]&quot;;  # we have vanilla peach</div><div class="line"></div><div class="line"># 以后置环缀结尾的方法调用</div><div class="line">say &quot;we have @flavours.sort()&quot;; # we have peach vanilla</div><div class="line"></div><div class="line"># 链式方法调用:</div><div class="line">say &quot;we have @flavours.sort.join(&apos;, &apos;)&quot;;</div><div class="line"># we have peach, vanilla</div></pre></td></tr></table></figure>
<h3 id="练习："><a href="#练习：" class="headerlink" title="练习："></a>练习：</h3><hr>
<p>例子中的第一行选手的名字是多余的，你可以在参加比赛的选手中找出所有选手的名字！ 如果例子中的第一行被省略了，你如何更改程序？提示：%hash.keys 返回散列 %hash中的所有键。</p>
<p>答案: 移除此行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">my @names = $file.get.words;</div></pre></td></tr></table></figure>
<p>并且将</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">my @sorted = @names.sort(&#123; %sets&#123;$_&#125; &#125;).sort(&#123; %matches&#123;$_&#125; &#125;).reverse;</div></pre></td></tr></table></figure>
<p>变成:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">my @sorted = %sets.keys.sort(&#123; %sets&#123;$_&#125; &#125;).sort(&#123; %matches&#123;$_&#125; &#125;).reverse;</div></pre></td></tr></table></figure>
<p>. 除了移除冗余，你也可以用它来提醒我们，如果一个选手没有在第一行的名字清单中被提到，例如因为输入错误，你该怎样修改你的程序？</p>
<p>答案:引入另外一个散列，合法选手的名字作为键，当读取选手名字的时候查找该散列：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">my @names = $file.get.split(&apos; &apos;);</div><div class="line">my %legitimate-players;</div><div class="line">for @names -&gt; $n &#123;      #  -&gt; 两侧要有空格</div><div class="line">    %legitimate-players&#123;$n&#125; = 1;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> …</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">for $file.lines -&gt; $line &#123;</div><div class="line">my ($pairing, $result) = $line.split(&apos; | &apos;);</div><div class="line">my ($p1, $p2)          = $pairing.split(&apos; &apos;);</div><div class="line">   for $p1, $p2 -&gt; $p &#123;</div><div class="line">       if !%legitimate-players&#123;$p&#125; &#123;</div><div class="line">           say &quot;Warning: &apos;$p&apos; is not on our list!&quot;;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="第三章-操作符"><a href="#第三章-操作符" class="headerlink" title="第三章 操作符"></a>第三章 操作符</h2><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">use v6;</div><div class="line"></div><div class="line">my @scores = &apos;Ana&apos; =&gt; 8, &apos;Dave&apos; =&gt; 6, &apos;Charlie&apos; =&gt; 4, &apos;Beth&apos; =&gt; 4;</div><div class="line">my $screen-width = 30;</div><div class="line"></div><div class="line">my $label-area-width = 1 + [max] @scores».key».chars;</div><div class="line">my $max-score = [max] @scores».value;</div><div class="line">my $unit = ($screen-width - $label-area-width) / $max-score;</div><div class="line">my $format = &apos;%- &apos; ~ $label-area-width ~ &quot;s%s\n&quot;;</div><div class="line"></div><div class="line">for @scores &#123;</div><div class="line">    printf $format, .key, &apos;X&apos; x ($unit * .value);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在这个例子中，我们计算一下每位选手在竞标赛中赢得比赛的局数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">my @scores = &apos;Ana&apos; =&gt; 8, &apos;Dave&apos; =&gt; 6, &apos;Charlie&apos; =&gt; 4, &apos;Beth&apos; =&gt; 4;</div></pre></td></tr></table></figure>
<p>这一句局包含了三个不同的操作符=和 =&gt;和 ,<br>以字符串连接操作符~为例， $string ~= “text” 等价于 $string = $string ~”text”.</p>
<p>=&gt; 操作符（大键号）创建了一个键值对对象，一个键值对存储着键和值；键在 =&gt; 操作符的左侧，值在右侧。这个操作符有一个特殊的特性：编译器会把 =&gt;操作符左侧的任何裸标识符解释为一个字符串。你也可以这样写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">my @scores = Ana =&gt; 8, Dave =&gt; 6, Charlie =&gt; 4, Beth =&gt; 4;</div></pre></td></tr></table></figure>
<p>最后逗号操作符 , 构建了一个对象序列，在该情况下，所谓的对象就是键值对。</p>
<p>这三个操作符都是中缀操作符，这意味着它在两个条目之间。</p>
<p>一个项前面可以有0个或多个前缀操作符，所以你可以写比如 4 + -5。+ 号（一个中缀操作符）的后面，编译器期望一个项，为了将 - 号解释为项 5 的一个前缀。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">my $label-area-width = 1 + [max] @scores».key».chars;</div></pre></td></tr></table></figure>
<p>» 是一个特殊的符号，打印不出来可以用两个大于号&gt;&gt;代替。<br>中缀操作符 max 返回两个值中的较大者，所以 2 max 3 返回 3。方括号包裹着一个中缀操作符让Perl将该中缀操作符应用到列表中的元素之间。[max] 1,5,3,7 和 1 max 5 max 3 max 7 一样，结果都为7.</p>
<p>同样地，[+]用来计算列表元素的和，[*]用来计算列表元素的积，[&lt;=]用来检查一个列表的值是否按递增排序。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@scores».key».chars</div><div class="line">my @scores = Ana =&gt; 8, Dave =&gt; 6, Charlie =&gt; 4, Beth =&gt; 4;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Ana     8 Dave  6 Charlie       4 Beth  4</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@scores.key</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Method &apos;key&apos; not found for invocant of class &apos;Array&apos;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@scores&gt;&gt;.key</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Ana Dave Charlie Beth</div></pre></td></tr></table></figure>
<p>就像@variable.method 在@variable上调用一个方法一样，@array».method 对@array中的每一项调用method方法，并且返回一个返回值的列表。即@scores&gt;&gt;.key返回一个列表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@scores&gt;&gt;.key&gt;&gt;.chars  #每个名字含有几个字符</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">4 7 4</div></pre></td></tr></table></figure>
<p>表达式 [max] @scores».key».chars 给出(3,4,7,4)中的最大值。它与下面的表达式相同：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@scores[0].key.chars</div><div class="line">max @scores[1].key.chars</div><div class="line">max @scores[2].key.chars</div><div class="line">max ...</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@scores[0]</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&quot;Ana&quot; =&gt; 8</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@scores[0].key</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Ana</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">my $format = &apos;%- &apos; ~ $label-area-width ~ &quot;s%s\n&quot;;</div><div class="line">for @scores &#123;</div><div class="line">    printf $format, .key, &apos;X&apos; x ($unit * .value);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>定义一个格式，%-表示左对齐，~是字符串连接操作符.for循环中，@scores中的每一项被绑定给特殊变量$_, .key是每项的键，即名字， .value是每项的键值，即得分。小 x 是字符串重复操作符。</p>
<h3 id="关于优先级的的一句话"><a href="#关于优先级的的一句话" class="headerlink" title="关于优先级的的一句话"></a>关于优先级的的一句话</h3><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">my @scores = &apos;Ana&apos; =&gt; 8, &apos;Dave&apos; =&gt; 6, &apos;Charlie&apos; =&gt; 4, &apos;Beth&apos; =&gt; 4;</div></pre></td></tr></table></figure>
<p>等号右侧产生一个列表（因为逗号，操作符），这个列表由对儿组成（因为 =&gt;）,并且结果赋值给数组变量。<br>在Perl5中会这样解释:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(my @scores = &apos;Ana&apos;) =&gt; 8, &apos;Dave&apos; =&gt; 6, &apos;Charlie&apos; =&gt; 4, &apos;Beth&apos; =&gt; 4;</div></pre></td></tr></table></figure>
<p>以至于数组@scores中只有一个项，表达式的其余部分被计算后丢弃。</p>
<p>优先级规则控制着编译器如何解释这一行。Perl 6的优先级规则申明 中缀操作符 =&gt; 比 , 中缀操作符对于参数的绑定更紧，而逗号操作符比 等号赋值操作符绑定的更紧。</p>
<p>实际上有两种不同优先级的赋值操作符。当赋值操作符右侧是一个标量时，使用较紧优先级的项赋值操作符，否则使用较松优先级的列表赋值操作符。（如同螺丝的松紧）<br>比较 $a = 1, $b = 2 和@a = 1, 2，前者是在一个列表中赋值给两个变量，后者是将含有两个项的一个列表赋值给一个变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">say 5 - 7 / 2; # 5 - 3.5 = 1.5</div><div class="line">say (5 - 7) / 2; # (-2) / 2 = -1</div></pre></td></tr></table></figure>
<p>Perl 6 中的优先级可以用圆括号改变，但是如果圆括号直接跟在标识符的后面而不加空格的话，则会被解释为参数列表。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">say(5 - 7) / 2; # -2</div></pre></td></tr></table></figure>
<p>只打印出了 5-7 的值。</p>
<pre><code>          优先级表
Example             Name
(), 42.5            (tightest precedence)
42.rand                term
$x++                method calls and postcircumĕxes
$x**2                autoincrement and autodecrement
?$x, !$x            exponentiation operator
+$x, ~$x            boolean preĕx
2*3, 7/5            preĕx context operators
1+2, 7-5            multiplicative inĕx operators
$a x 3                additive inĕx operators
$x ~&quot;.nn&quot;            replication operators
1&amp;2                    string concatenation
1|2                    junctive AND
abs $x                junctive OR
$x cmp 3            named unary preĕx
$x == 3                non-chaining binary operators
$x &amp;&amp; $y            chaining binary operators
$x || $y            tight AND inĕx
$x &gt; 0 ?? 1 !! -1    tight OR inĕx
$x = 1                conditional operator
not $x                item assignment
1, 2                loose unary preĕx
1, 2 Z @a            comma
@a = 1, 2            list inĕx
$x and say &quot;Yes&quot;    list preĕx, list assignment
$x or die &quot;No&quot;        loose AND inĕx
;                    loose OR inĕx
                    statement terminator
                    (loosest precedence)
</code></pre><h3 id="比较和智能匹配"><a href="#比较和智能匹配" class="headerlink" title="比较和智能匹配"></a>比较和智能匹配</h3><hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">my @a = 1, 2, 3;</div><div class="line">my @b = 1, 2, 3;</div><div class="line">say @a === @a; # Bool::True</div><div class="line">say @a === @b; # Bool::False</div><div class="line"># these use identity for value</div><div class="line">say 3 === 3 # Bool::True</div><div class="line">say &apos;a&apos; === &apos;a&apos;; # Bool::True</div><div class="line">my $a = &apos;a&apos;;</div><div class="line">say $a === &apos;a&apos;; # Bool::True</div></pre></td></tr></table></figure>
<pre><code>@b===@a
</code></pre><p>False<br>    @a eqv @b</p>
<p>True<br>    ‘2’ eqv 2</p>
<p>False</p>
<p>只有当两个对象有相同的类型和相同的结构时， eqv 操作符才返回 True。在前面定义的例子中，@a  eqv  @b 结果为 True， 因为 @a 和 @b 各自包含相同的值，另一方面， ‘2’ eqv 2 返回 ‘False’ ,因为一个参数是字符串，另一个是整数，类型不相同。</p>
<h4 id="数字比较"><a href="#数字比较" class="headerlink" title="数字比较"></a>数字比较</h4><hr>
<p>使用 == 中缀操作符查看两个对象是否有相同的数字值。如果某个对象不是数字，Perl 会在比较之前尽力使其数字化。如果没有更好的方式将对象转换为数字，Perl 会使用默认的数字 0 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">say 1 == 1.0;  # Bool::True</div><div class="line">say 1 == &apos;1&apos;;  # Bool::True</div><div class="line">say 1 == &apos;2&apos;;  # Bool::False</div><div class="line">say 3 == &apos;3b&apos;; # fails</div></pre></td></tr></table></figure>
<p>跟数字比较相关的还有 &lt;,&lt;=,&gt;,&gt;= 。如果两个对象的数字值不同，使用 != 会返回 True 。</p>
<p>如果你将数组或列表作为数字，它会计算列表中项的个数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">my @colors = &lt;red blue green&gt;;</div><div class="line"> if @colors == 3 &#123;</div><div class="line">     say &quot;It&apos;s true, @colors contains 3 items&quot;;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h4 id="字符串比较"><a href="#字符串比较" class="headerlink" title="字符串比较"></a>字符串比较</h4><hr>
<p>Perl 6 中使用 eq 比较字符串，必要时会将其参数转换为字符串。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">if $greeting eq &apos;hello&apos; &#123;</div><div class="line">   say &apos;welcome&apos;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Table 3.2: Operators and Comparisons</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">数字比较	字符串比较	意思</div><div class="line">------------------------------------------</div><div class="line">==	      eq	        等于</div><div class="line">!=	      ne	        不等于</div><div class="line">!==	  !eq	        不等于</div><div class="line">&lt;	      lt	        小于</div><div class="line">&lt;=	      le	        小于或等于</div><div class="line">&gt;	      gt	        大于</div><div class="line">&gt;=	      ge	        大于或等于</div></pre></td></tr></table></figure>
<p>例如，’a’ lt ‘b’ 为 true，’a’ lt ‘aa’ 也为 true。 != 是 !==的便捷形式，它实际是 ! 元操作符加在 中缀操作符 ==之前。同样地， ne 和 !eq 是一样的。</p>
<p>三路操作符</p>
<p>三路操作符有两个操作数，如果左侧较小，返回 Order::Increase ，两侧相等则返回 Order::Same，如果右侧较小则返回 Order::Decrease。对于数字使用 三路操作符 &lt;=&gt; ,对于字符串，使用三路操作符 leg （取自 lesser，equal，greater）。中缀操作符 cmp 是一个对类型敏感的三路操作符，它像 &lt;=&gt; 一样比较数字，像 leg 一样比较字符串，（举例来说）并且比较键值对儿时，先比较键，如果键相同再比较键值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">say 10 &lt;=&gt; 5;     # +1</div><div class="line">say 10 leg 5;     # because &apos;1&apos; lt &apos;5&apos;</div><div class="line">say &apos;ab&apos; leg &apos;a&apos;; # +1, lexicographic comparison</div></pre></td></tr></table></figure>
<p>三路操作符的典型用处就是用在排序中。列表中的.sort 方法能使用一个含有两个值的块或一个函数，比较它们，并返回一个小于，等于或大于 0 的值。 sort  方法根据该返回值进行排序：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">say ~&lt;abstract Concrete&gt;.sort;</div><div class="line"># output: Concrete abstract</div><div class="line"></div><div class="line">say ~&lt;abstract Concrete&gt;.sort:  -&gt; $a, $b &#123; uc($a) leg uc($b) &#125;;</div><div class="line"># output: abstract Concrete</div></pre></td></tr></table></figure>
<p>默认的，比较是大小写敏感的，通过比较它们的大写变形，而不是比较它们的值，这个例子使用了大小写敏感排序。</p>
<h4 id="智能匹配"><a href="#智能匹配" class="headerlink" title="智能匹配"></a>智能匹配</h4><hr>
<p>使用 ~~ 做正确的事情。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">if $pints-drunk ~~ 8 &#123;</div><div class="line">   say &quot;Go home, you&apos;ve had enough!&quot;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">if $country ~~ &apos;Sweden&apos; &#123;</div><div class="line">    say &quot;Meatballs with lingonberries and potato moose, please.&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">unless $group-size ~~ 2..4 &#123;</div><div class="line">    say &quot;You must have between 2 and 4 people to book this tour.&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>智能匹配总是根据 ~~右侧值的类型来决定使用哪种比较。上个例子中，比较的是数字、字符串和范围。<br>智能匹配的工作方式 $answer ~~ 42 等价于 42.ACCPETS( $answer ).对 ~~ 操作符右侧的操作数调用 ACCEPTS 方法，并将左操作数作为参数传入。</p>
<h2 id="第四章-子例程和签名"><a href="#第四章-子例程和签名" class="headerlink" title="第四章 子例程和签名"></a>第四章 子例程和签名</h2><hr>
<p>一个子例程就是一段执行特殊任务的代码片段。它可以对提供的数据（<code>实参</code>）操作，并产生结果（返回值）。子例程的签名是它<code>所含的参数</code>和它产生的<code>返回值</code>的描述。从某一意义上来说，第三章描述的操作符也是Perl 6用特殊方式解释的子例程。</p>
<h3 id="申明子例程"><a href="#申明子例程" class="headerlink" title="申明子例程"></a>申明子例程</h3><hr>
<p> 一个子例程申明由几部分组成。首先， <code>sub</code>表明你在申明一个子例程，然后是可选的子例程的名称和<code>可选的签名</code>。子例程的主体是一个用花括号扩起来的代码块。<br>默认的，子例程是本地作用域的，就像任何使用 <code>my</code> 申明的变量一样。这意味着，一个子例程只能在它被申明的作用域内被调用。使用 <code>our</code> 来申明子例程可以使其在<code>当前包</code>中可见。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">our sub eat() &#123;</div><div class="line">    say &quot;om nom nom&quot;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">sub drink() &#123;</div><div class="line">    say &quot;glug glug&quot;;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">our &amp;eat; # makes the package-scoped sub eat available in this lexical scope</div><div class="line"></div><div class="line">eat(); # om nom nom</div><div class="line">drink(); # 失败, can&apos;t drink outside of the block</div></pre></td></tr></table></figure>
<p>our 也能让子例程从包或模块的外部是可见的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">module EatAndDrink &#123;</div><div class="line">    our sub eat() &#123;</div><div class="line">    say &quot;om nom nom&quot;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">sub drink() &#123;</div><div class="line">    say &quot;glug glug&quot;;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">EatAndDrink::eat(); # om nom nom</div><div class="line">EatAndDrink::drink(); # fails, not declared with &quot;our&quot;</div></pre></td></tr></table></figure>
<p>你也可以<code>导出</code>一个子例程，让它在另外的作用域内可见。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># in file Math/Trivial.pm</div><div class="line"># TODO: find a better example</div><div class="line"># TODO: explain modules, search paths</div><div class="line">module Math::Trivial &#123;</div><div class="line">    sub double($x) is export &#123;</div><div class="line">    return 2 * $x;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在其它程序或模块中你可以这样写:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">use Math::Trivial; # imports sub double</div><div class="line">say double(21); # 21 is only half the truth</div></pre></td></tr></table></figure>
<p>Perl 6的子例程都是对象。你可以将它们随意传递并存储在数据结构中。编程语言设计者常常将它们称之为first-class 子例程；它们就像数组和散列一样作为语言的基础。</p>
<p>First-class 子例程能帮助你解决复杂的问题。例如，为了做出一个微型的ASCII艺术舞蹈图，你可能要建立一个散列，键是舞蹈动作的名称，键值是匿名散列。假使使用者能键入一系列舞蹈动作（可能是站在舞蹈平台上或其它外部输入设备）。 你怎么保持一个变量清单中都是合法的行为，允许使用者输入，并限制输入是一系列安全的行为呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">my %moves =</div><div class="line">hands-over-head       =&gt; sub &#123; say &apos;/o\ &apos;  &#125;,</div><div class="line">bird-arms             =&gt; sub &#123; say &apos;|/o\| &apos;&#125;,</div><div class="line">left                  =&gt; sub &#123; say &apos;&gt;o &apos;   &#125;,</div><div class="line">right                 =&gt; sub &#123; say &apos;o&lt; &apos;   &#125;,</div><div class="line">arms-up               =&gt; sub &#123; say &apos;\o/ &apos;  &#125;;</div><div class="line"></div><div class="line">my @awesome-dance = &lt;arms-up bird-arms right hands-over-head&gt;;</div><div class="line"></div><div class="line">for @awesome-dance -&gt; $move &#123;</div><div class="line">    %moves&#123;$move&#125;.();  # 在散列上调用方法</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<pre><code>outputs:
 \o/
|/o\|
  o&lt;
 /o\.
</code></pre><h3 id="Adding-Signatures"><a href="#Adding-Signatures" class="headerlink" title="Adding Signatures"></a>Adding Signatures</h3><hr>
<p><strong>添加签名</strong></p>
<p>子例程的签名执行两个任务。首先，它申明哪个调用者可能或必须将参数传递给子例程。第二，它申明子例程中的变量被绑定到哪些参数上。这些变量叫做参数。Perl 6的签名更深入，它们允许你<code>限制参数的类型</code>，值和参数的定义，并准确匹配复杂数据结构的某一部分。此外，它们也允许你显式地指定子例程返回值的类型。</p>
<h4 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h4><hr>
<p>签名最简单的形式是，绑定到输入参数上的用逗号分隔的一列变量的名字。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sub order-beer($type, $pints) &#123;</div><div class="line">   say ($pints == 1 ?? &apos;A pint&apos; !! &quot;$pints pints&quot;) ~ &quot; of $type, please.&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">order-beer(&apos;Hobgoblin&apos;, 1);    # A pint of Hobgoblin, please.</div><div class="line">order-beer(&apos;Zlatý Bažant&apos;, 3);  # 3 pints of Zlatý Bažant, please.</div></pre></td></tr></table></figure>
<p>这里使用的关系绑定而非赋值就是签名。默认地，在Perl6 中，子例程中引用到传入参数的签名的变量是<code>只读</code>的。这意味着你<code>不能</code>从子例程内部<code>修改</code>它们。<br>如果只读绑定太受限制了，你可以将 <code>is rw</code> (rw是read/write的缩写) 特性应用到参数上以降低这种限制。这个特性说明参数是可读可写的，这允许你从子例程内部修改参数。使用的时候必须小心，因为它会<code>修改</code>传入的原始对象。如果你试图传入一个字面值，一个常量，或其它类型的不可变对象到一个有 <code>is rw</code>  特性的参数中，绑定会在调用时失败并抛出异常:<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">sub make-it-more-so($it is rw) &#123;</div><div class="line">    $it ~= substr($it, $it.chars - 1) x 5;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $happy = &quot;yay!&quot;;</div><div class="line">make-it-more-so($happy);</div><div class="line">say $happy; # yay!!!!!!   # 原始传入对象被修改了</div><div class="line">make-it-more-so(&quot;uh-oh&quot;); # 失败，不能修改一个常量</div></pre></td></tr></table></figure></p>
<p>如果你想将参数的本地副本用在子例程内部而不改变调用者的变量，—-使用 <code>is copy</code> 特性：<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">sub say-it-one-higher($it is copy) &#123;</div><div class="line">    $it++;</div><div class="line">    say $it;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my $unanswer = 41;</div><div class="line">say-it-one-higher($unanswer); # 42</div><div class="line">say-it-one-higher(41); # 42</div><div class="line">$unanswer;  #41</div></pre></td></tr></table></figure></p>
<p>在诸如C/C++ and Scheme等其它类型的编程语言中,这种广为人知的求值策略就是“按值传递”。当使用 <code>is copy</code>特性时，只有本地副本被赋值。其它任何传递给子例程的参数在调用者的作用域内保持不变。（一个不可变对象是当这个对象被创建后，它的状态不会改变，作为比较，一个可变对象的状态在创建后是会被改变的）</p>
<h4 id="传递数组、散列和代码"><a href="#传递数组、散列和代码" class="headerlink" title="传递数组、散列和代码"></a>传递数组、散列和代码</h4><hr>
<p>一个变量的魔符表明它的本意用途。在签名中，变量的魔符也起着限制传入的参数类型的作用。例如， @ 符号检查传入的对象行使位置角色（一个角色包含像数组和列表的类型）。如果传递的东西不能匹配这样的限制，会引起调用失败：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">sub shout-them(@words) &#123;</div><div class="line">    for @words -&gt; $w &#123;</div><div class="line">        print uc(&quot;$w &quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my @last_words = &lt;do not want&gt;;</div><div class="line"></div><div class="line">shout-them(@last_words); # DO NOT WANT</div><div class="line">shout-them(&apos;help&apos;); # Fails; a string is not Positional  字符串不是位置参数</div></pre></td></tr></table></figure>
<p>类似地， % 符号表明调用者必须传递一个行使关系角色的对象；即允许通过&lt;…&gt;或{…} 进行索引的东西。 &amp; 符号要求调用者传递一个诸如匿名散列之类的行使能调用的角色的对象。在那种情况下，你也可以不用 &amp; 符号调用可调用的参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">sub do-it-lots(&amp;it, $how-many-times) &#123;</div><div class="line">    for 1..$how-many-times &#123;</div><div class="line">        it();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">do-it-lots(sub &#123; say &quot;Eating a stroopwafel&quot; &#125;, 10);   #此处是一个匿名子例程</div></pre></td></tr></table></figure>
<p>标量使用 $ 符号，并表明没有限制。什么都可以绑定在它上面，即使它使用另外的符号绑定到一个对象上。</p>
<h4 id="插值、数组和散列"><a href="#插值、数组和散列" class="headerlink" title="插值、数组和散列"></a>插值、数组和散列</h4><hr>
<p>有时你想从数组中填充占位参数。你可以通过在数组前添加一个垂直竖条或管道字符 ( <code>|</code> ): eat(|@food)    而不是写作eat(@food[0],@food[1], @food[2], …) 等将它们吸进参数列表( | 像不像一个吸管, ^_^)。</p>
<p>同样地，你可以将散列插值进具名参数:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">sub order-shrimps($count, :$from) &#123;</div><div class="line">    say &quot;I&apos;d like $count pieces of shrimp from the $from, please&quot;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my %user-preferences = from =&gt; &apos;Northern Sea&apos;;</div><div class="line"></div><div class="line">order-shrimps(3, |%user-preferences);</div><div class="line"># I&apos;d like 3 pieces of shrimp from the Northern Sea, please</div></pre></td></tr></table></figure>
<h4 id="可选参数"><a href="#可选参数" class="headerlink" title="可选参数"></a>可选参数</h4><hr>
<p>为使参数可选，要么给签名的参数赋值为默认值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sub order-steak($how = &apos;medium&apos;) &#123;</div><div class="line">    say &quot;I&apos;d like a steak, $how&quot;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">order-steak();</div><div class="line">order-steak(&apos;well done&apos;);</div></pre></td></tr></table></figure>
<p>或者在参数名字的后面添加一个问号(?):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sub order-burger($type, $side?) &#123;</div><div class="line">    say &quot;I&apos;d like a $type burger&quot; ~</div><div class="line">    ( defined($side) ?? &quot; with a side of $side&quot; !! &quot;&quot; );</div><div class="line">&#125;</div><div class="line"></div><div class="line">order-burger(&quot;triple bacon&quot;, &quot;deep fried onion rings&quot;);</div></pre></td></tr></table></figure>
<p>如果没有参数被传递，参数会被绑定成一个未定义的值。 defined(…) 函数用来检查是否有值。</p>
<h4 id="强制参数"><a href="#强制参数" class="headerlink" title="强制参数"></a>强制参数</h4><hr>
<p>默认地，位置参数是必不可少的。然而，你可以通过在参数后面追加一个感叹号来显式地指定该参数是必须的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sub order-drink($size, $flavor!) &#123;</div><div class="line">    say &quot;$size $flavor, coming right up!&quot;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">order-drink(&apos;Large&apos;, &apos;Mountain Dew&apos;); # OK</div><div class="line">order-drink(&apos;Small&apos;); # Error</div></pre></td></tr></table></figure>
<h4 id="具名实参和形参"><a href="#具名实参和形参" class="headerlink" title="具名实参和形参"></a>具名实参和形参</h4><hr>
<ul>
<li>arguments  实参</li>
<li>parameters 形参</li>
</ul>
<p>当一个子例程有很多参数时，调用者很难记清传递参数的顺序。这种情况下，通过<code>名字</code>传递参数往往更容易。这样，参数出现的顺序就无关紧要了:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">sub order-beer($type, $pints) &#123;</div><div class="line">    say ($pints == 1 ?? &apos;A pint&apos; !! &quot;$pints pints&quot;) ~ &quot; of $type, please.&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">order-beer(type =&gt; &apos;Hobgoblin&apos;, pints =&gt; 1);</div><div class="line"># A pint of Hobgoblin, please.</div><div class="line"></div><div class="line">order-beer(pints =&gt; 3, type =&gt; &apos;Zlatý Bažant&apos;);</div><div class="line"># 3 pints of Zlatý Bažant, please.</div></pre></td></tr></table></figure>
<p>你也可以指定参数只能按名字被传递（这意味着它不允许按位置传递）。这样的话，在参数名字前加一个<code>冒号</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">sub order-shrimps($count, :$from = &apos;Northern Sea&apos;) &#123;</div><div class="line">    say &quot;I&apos;d like $count pieces of shrimp from the $from, please&quot;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">order-shrimps(6);    # takes &apos;Northern Sea&apos;</div><div class="line">order-shrimps(4, from =&gt; &apos;Atlantic Ocean&apos;);</div><div class="line">order-shrimps(22, &apos;Mediterranean Sea&apos;);   # 不允许, :$from is named only</div></pre></td></tr></table></figure>
<p>不像位置参数，命名参数默认是可选的。在命名参数后面追加一个 ! 号使命名参数强制性存在。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sub design-ice-cream-mixture($base = &apos;Vanilla&apos;, :$name!) &#123;</div><div class="line">    say &quot;Creating a new recipe named $name!&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">design-ice-cream-mixture(name =&gt; &apos;Plain&apos;);</div><div class="line">design-ice-cream-mixture(base =&gt; &apos;Strawberry chip&apos;); # 错误,没有指定 $name</div></pre></td></tr></table></figure>
<p><strong>重命名参数</strong></p>
<p>因为按名字传递实参给形参是合理的, 形参的名字应该应该作为子例程公共 API 的一部分被考虑在内. 小心地挑选它们吧! 有时候, 使用一个名字暴露形参而使用另外一个名字绑定到变量会很方便:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sub announce-time(:dinner($supper) = &apos;8pm&apos;) &#123;</div><div class="line">    say &quot;We eat dinner at $supper&quot;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">announce-time(dinner =&gt; &apos;9pm&apos;); # We eat dinner at 9pm</div></pre></td></tr></table></figure>
<p>参数可以有多个名字，如果你的用户有些是英国人，有些是美国人，你可能这样写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">sub paint-rectangle(</div><div class="line">    :$x = 0,</div><div class="line">    :$y = 0,</div><div class="line">    :$width = 100,</div><div class="line">    :$height = 50,</div><div class="line">    :color(:colour($c))) &#123;</div><div class="line"></div><div class="line">    # print a piece of SVG that represents a rectangle</div><div class="line">    say qq[&lt;rect x=&quot;$x&quot; y=&quot;$y&quot; width=&quot;$width&quot; height=&quot;$height&quot; &gt;]</div><div class="line">&#125;</div><div class="line"></div><div class="line"># both calls work the same</div><div class="line">paint-rectangle :color&lt;Blue&gt;;</div><div class="line">paint-rectangle :colour&lt;Blue&gt;;</div><div class="line"></div><div class="line"># of course you can still fill the other options</div><div class="line">paint-rectangle :width(30), :height(10), :colour&lt;Blue&gt;;</div></pre></td></tr></table></figure>
<p><strong>可选的命名参数语法</strong></p>
<p>命名变量通常是成对的（键值对）。写一个 <code>Pairs</code> 有多种方式。各种方法的不同之处就是清晰性，因为每种选择提供不同的引述机制。下面的三种调用是一样的意思：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">announce-time(dinner =&gt; &apos;9pm&apos;);</div><div class="line">announce-time(:dinner(&apos;9pm&apos;));</div><div class="line">announce-time(:dinner&lt;9pm&gt;);</div></pre></td></tr></table></figure>
<p>如果传递的是布尔值，你可以省略键值对的键值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">toggle-blender( :enabled); # enables the blender 开启果汁机</div><div class="line">toggle-blender(:!enabled); # disables the blender 关闭果汁机</div></pre></td></tr></table></figure>
<p>形如 <code>:name</code> 但不带值的命名参数有一个隐式的布尔真值 <code>Bool::True</code>. 它的对立形式是 <code>:!name</code> , 其值是隐式的布尔假值 <code>Bool::false</code>. 如果你使用变量创建了一个 <code>pair</code>, 你可以将变量名作为 <code>pair</code> 的键复用.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">my $dinner = &apos;9pm&apos;;</div><div class="line">announce-dinner :$dinner; # same as dinner =&gt; $dinner;</div></pre></td></tr></table></figure>
<pre><code>                        Pair forms and their meanings.

    Shorthand      Long form                          Description
:allowed           allowed =&gt; Bool::True               Boolean flag
:!allowed          allowed =&gt; Bool::False              Boolean flag
:bev&lt;tea coffee&gt;   bev =&gt; (&apos;tea&apos;, &apos;coffee&apos;)            List
:times[1, 3]       times =&gt; [1, 3]                     Array
:opts{ a =&gt; 2 }    opts =&gt; { a =&gt; 2 }                  Hash
:$var              var =&gt; $var Scalar                  variable
:@var              var =&gt; @var Array                   variable
:%var              var =&gt; %var Hash                    variable
:&amp;var              vaf =&gt; &amp;var Callable/ Subroutine    variable
</code></pre><p>你可以使用在任何可以使用 Pair 对象的上下文使用表中的任意一种形式. 例如, 生成散列:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># TODO: better example</div><div class="line">my $black = 12;</div><div class="line">my %color-popularities = :$black, :blue(8), red =&gt; 18, :white&lt;0&gt;;</div><div class="line"></div><div class="line"># 与此相同：</div><div class="line"># my %color-popularities =</div><div class="line"># black =&gt; 12,</div><div class="line"># blue =&gt; 8,</div><div class="line"># red =&gt; 18,</div><div class="line"># white =&gt; 0;</div></pre></td></tr></table></figure>
<p>最后, 通过位置而非名字传递一个已存在的 Pair 对象到子例程中, 要么把它放在圆括号中 ( 就像 (:$thing) ), 或者使用 =&gt; 操作符引起左侧的字符串: “thing” =&gt; $thing.</p>
<p><strong>参数的顺序</strong></p>
<p>当位置参数和命名参数都出现在签名中时，所有的位置参数都要出现在命名参数之前：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sub mix(@ingredients, :$name)    &#123; ... &#125; # OK</div><div class="line">sub notmix(:$name, @ingredients) &#123; ... &#125; # Error</div></pre></td></tr></table></figure>
<p>必须的位置参数要在可选的位置参数之前。然而，命名参数没有这种限制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sub copy-machine($amount, $size = &apos;A4&apos;, :$color!, :$quality) &#123; ... &#125; # OK</div><div class="line">sub fax-machine($amount = 1, $number) &#123; ... &#125; # Error</div></pre></td></tr></table></figure>
<h4 id="Slurpy-参数"><a href="#Slurpy-参数" class="headerlink" title="Slurpy 参数"></a>Slurpy 参数</h4><hr>
<p>有时候，你会希望让子例程接受任何数量的参数，并且将所有这些参数收集到一个数组中。为了达到这个目的，给签名添加一个数组参数，就是在数组前添加一个 * 号前缀：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">sub shout-them(*@words) &#123;</div><div class="line">    for @words -&gt; $w &#123;</div><div class="line">        print uc(&quot;$w &quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"> #现在你可以传递项</div><div class="line">shout-them(&apos;go&apos;); # GO</div><div class="line">shout-them(&apos;go&apos;, &apos;home&apos;); # GO HOME</div></pre></td></tr></table></figure>
<p>除了集合所有的值之外，slurpy 参数会展平任何它接收到的数组，最后你只会得到一个展平的列表，因此：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">my @words = (&apos;go&apos;, &apos;home&apos;);</div><div class="line">shout-them(@words);</div></pre></td></tr></table></figure>
<p>会导致 <code>*@words</code> 参数有两个字符串元素，而非只有单个数组元素。</p>
<p>你可以选择将某些参数捕获到位置参数中，并让其它参数被吸进数组参数里。这种情况下， <code>slupy</code> 应该放到最后。相似地， <code>*%hash</code> slurps 所有剩下的未绑定的命名参数到散列 %hash中。<code>Slurpy</code> 数组和散列允许你传递所有的位置参数和命名参数到另一个子例程中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">sub debug-wrapper(&amp;code, *@positional, *%named) &#123;</div><div class="line">    warn &quot;Calling &apos;&amp;code.name()&apos; with arguments &quot;</div><div class="line">    ~ &quot;@positional.perl(), %named.perl()\n&quot;;</div><div class="line">    code(|@positional, |%named);</div><div class="line">    warn &quot;... back from &apos;&amp;code.name()&apos;\n&quot;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">debug-wrapper(&amp;order-shrimps, 4, from =&gt; &apos;Atlantic Ocean&apos;);</div></pre></td></tr></table></figure>
<h3 id="返回结果"><a href="#返回结果" class="headerlink" title="返回结果"></a>返回结果</h3><hr>
<p>子例程也能返回值。之前本章中的 ASCII 艺术舞蹈例子会更简单当每个子例程返回一个新字符串：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">my %moves =</div><div class="line">hands-over-head =&gt; sub &#123; return &apos;/o\ &apos;   &#125;,</div><div class="line">bird-arms       =&gt; sub &#123; return &apos;|/o\| &apos; &#125;,</div><div class="line">left            =&gt; sub &#123; return &apos;&gt;o &apos;    &#125;,</div><div class="line">right           =&gt; sub &#123; return &apos;o&lt; &apos;    &#125;,</div><div class="line">arms-up         =&gt; sub &#123; return &apos;\o/ &apos;   &#125;;</div><div class="line"></div><div class="line">my @awesome-dance = &lt;arms-up bird-arms right hands-over-head&gt;;</div><div class="line"></div><div class="line">for @awesome-dance -&gt; $move &#123;</div><div class="line">    print %moves&#123;$move&#125;.();</div><div class="line">&#125;</div><div class="line"></div><div class="line">print &quot;\n&quot;;</div></pre></td></tr></table></figure>
<p>子例程也能返回多个值（译者注：那不就是返回一个列表嘛）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">sub menu &#123;</div><div class="line">    if rand &lt; 0.5 &#123;</div><div class="line">        return (&apos;fish&apos;, &apos;white wine&apos;)</div><div class="line">    &#125; else &#123;</div><div class="line">        return (&apos;steak&apos;, &apos;red wine&apos;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my ($food, $beverage) = menu();</div></pre></td></tr></table></figure>
<p> 如果你把 return 语句排除在外，则在子例程内部运行的最后一个语句产生的值被返回。这意味着前一个例子可以简化为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">sub menu &#123;</div><div class="line">    if rand &lt; 0.5 &#123;</div><div class="line">        &apos;fish&apos;, &apos;white wine&apos;</div><div class="line">    &#125; else &#123;</div><div class="line">        &apos;steak&apos;, &apos;red wine&apos;;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my ($food, $beverage) = menu();</div></pre></td></tr></table></figure>
<p>记得：当子例程中的控制流极其复杂时，添加一个显式的 return 会让代码更清晰，所以 return 还是加上的好。<br>return 另外的副作用就是执行后立即退出子例程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">sub create-world(*%characteristics) &#123;</div><div class="line">    my $world = World.new(%characteristics);</div><div class="line">    return $world if %characteristics&lt;temporary&gt;;</div><div class="line"></div><div class="line">    save-world($world);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>…并且你最好别放错你的新单词 $word 如果它是临时的。因为这是你要获取的仅有的一个。</p>
<h3 id="返回值的类型"><a href="#返回值的类型" class="headerlink" title="返回值的类型"></a>返回值的类型</h3><hr>
<p>像其它现代语言一样，Perl 6 允许你显式地指定子例程返回值的类型。这允许你限制从子例程中返回的值的类型。使用 returns 特性可以做到这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sub double-up($i) returns Int &#123;</div><div class="line">    return $i * 2;</div><div class="line">&#125;</div><div class="line"></div><div class="line">my Int $ultimate-answer = double-up(21);  # 42</div></pre></td></tr></table></figure>
<p> 当然，使用这个 <code>returns</code> 特性是可选的</p>
<h3 id="Working-With-Types"><a href="#Working-With-Types" class="headerlink" title="Working With Types"></a>Working With Types</h3><hr>
<p>很多子例程不能完整意义上使用任意参数工作，但是要求参数支持确定的方法或有其它属性。这种情况下，限制参数类型就有意义了，诸如传递不正确值作为参数，当调用子例程时，这会引起Perl 发出错误，或者甚至在编译时，如果编译器足够聪明来捕捉错误。</p>
<h4 id="基本类型"><a href="#基本类型" class="headerlink" title="基本类型"></a>基本类型</h4><hr>
<p>最简单的限制子例程接收可能的值的方法是在参数前写上类型名。例如，一个子例程对其参数执行数值计算，这要求它的参数类型是 Numeric：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sub mean(Numeric $a, Numeric $b) &#123;</div><div class="line">   return ($a + $b) / 2;</div><div class="line">&#125;</div><div class="line"></div><div class="line">say mean 2.5, 1.5;</div><div class="line">say mean &apos;some&apos;, &apos;strings&apos;;</div></pre></td></tr></table></figure>
<p> 产生输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Nominal type check failed for parameter &apos;$a&apos;;</div><div class="line">expected Numeric but got Str instead</div></pre></td></tr></table></figure>
<p>nominal 类型是一个人实际类型的名字，这里是 Numeric。<br>如果多个参数有类型限制，每个参数必须填充它绑定的参数限制的类型</p>
<h4 id="添加限制"><a href="#添加限制" class="headerlink" title="添加限制"></a>添加限制</h4><hr>
<p>有时，类型的名字不足以描述参数的要求。这种情况下，你可能使用 where 代码块添加一个额外的限制：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sub circle-radius-from-area(Real $area where &#123; $area &gt;= 0 &#125;) &#123;</div><div class="line">    ($area / pi).sqrt</div><div class="line">&#125;</div><div class="line"></div><div class="line">say circle-radius-from-area(3); # OK</div><div class="line">say circle-radius-from-area(-3); # Error</div></pre></td></tr></table></figure>
<p> 因为这种计算只对非负面积值有意义，该子例程的参数包含了一个限制，对于非负值它会返回真。如果这个限制返回一个假的值，类型检查会失败，当有些东西调用该子例程时。</p>
<p>where 之后的代码块是可选的。Perl 通过通过智能匹配 where 后面的参数来执行检查。<br>例如，它可能接受在某一确定范围中的参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sub set-volume(Numeric $volume where 0..11) &#123;</div><div class="line">    say &quot;Turning it up to $volume&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>或者你可以将参数限制为散列的键：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">my %in-stock = &apos;Staropramen&apos; =&gt; 8, &apos;Mori&apos; =&gt; 5, &apos;La Trappe&apos; =&gt; 9;</div><div class="line"></div><div class="line">sub order-beer(Str $name where %in-stock) &#123;</div><div class="line">      say &quot;Here&apos;s your $name&quot;;</div><div class="line">      %in-stock&#123;$name&#125;--;</div><div class="line">      if %in-stock&#123;$name&#125; == 0 &#123;</div><div class="line">          say &quot;OH NO! That was the last $name, folks! :&apos;(&quot;;</div><div class="line">          %in-stock.delete($name);</div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="抽象参数和具体参数"><a href="#抽象参数和具体参数" class="headerlink" title="抽象参数和具体参数"></a>抽象参数和具体参数</h3><hr>
<p>下面检测变量是否定义。<br>例如，下面是Perl5 代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sub foo &#123;</div><div class="line">    my $arg = shift;</div><div class="line">    die &quot;Argument is undefined&quot; unless defined $arg;</div><div class="line"></div><div class="line">    # Do something</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在Perl 6 中这样写:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">sub</span> <span class="title">foo</span>(<span class="title">Int</span>:<span class="title">D</span> $<span class="title">arg</span>) </span>&#123;</div><div class="line">    <span class="comment"># Do something</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>留意附加在参数类型后面的 :D 笑脸。这个动词表明给定的参数必须被绑定到一个具体的对象上。如果不是的话，会抛出一个运行时异常。这就是为什么它那么高兴！作为对比， 动词 :U 用于表明该参数需要一个未定义的或抽象的对象。此外， 动词:<em> 允许定义或未定义的值。实际上，使用 :</em> 有点多余。</p>
<p>最后，动词 :T 能用于表明参数只能是类型对象，例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sub say-foobar(Int:T $arg) &#123;</div><div class="line">    say &apos;FOOBAR!&apos;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">say-foobar(Int);</div><div class="line"># FOOBAR!</div></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>
    
    <div>
      
        
<div style="text-align:center;color: #ccc;font-size:15px;">
------ Young For Perl 6! ------</div>

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Using-Perl-6/" rel="tag">#Using Perl 6</a>
          
            <a href="/tags/约束/" rel="tag">#约束</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2014/12/19/Perl-6圣诞月历-2014/" rel="next" title="Perl 6 圣诞月历-(2014)">
                <i class="fa fa-chevron-left"></i> Perl 6 圣诞月历-(2014)
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/03/15/when和where/" rel="prev" title="When and Where">
                When and Where <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2015/03/14/Using-Perl-6-一/"
     data-title="Using Perl 6(一)"
     data-content=""
     data-url="https://ohmycloud.github.io/2015/03/14/Using-Perl-6-一/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">分享到：</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">微博</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQ空间</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">腾讯微博</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">微信</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2015/03/14/Using-Perl-6-一/"
           data-title="Using Perl 6(一)" data-url="https://ohmycloud.github.io/2015/03/14/Using-Perl-6-一/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="焉知非鱼" />
          <p class="site-author-name" itemprop="name">焉知非鱼</p>
          <p class="site-description motion-element" itemprop="description">Young For Perl 6</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">161</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">177</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ohmycloud" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/740011611" target="_blank" title="weibo">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/9b20c7d63b77" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-location-arrow"></i>
                  
                  简书
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://perl6.org/" target="_blank" title="Perl 6">
                  
                    <i class="fa fa-fw fa-paper-plane"></i>
                  
                  Perl 6
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#第一章-概要"><span class="nav-number">1.</span> <span class="nav-text">第一章 概要</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第二章-基础"><span class="nav-number">2.</span> <span class="nav-text">第二章 基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#练习："><span class="nav-number">2.1.</span> <span class="nav-text">练习：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第三章-操作符"><span class="nav-number">3.</span> <span class="nav-text">第三章 操作符</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#关于优先级的的一句话"><span class="nav-number">3.1.</span> <span class="nav-text">关于优先级的的一句话</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#比较和智能匹配"><span class="nav-number">3.2.</span> <span class="nav-text">比较和智能匹配</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#数字比较"><span class="nav-number">3.2.1.</span> <span class="nav-text">数字比较</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字符串比较"><span class="nav-number">3.2.2.</span> <span class="nav-text">字符串比较</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#智能匹配"><span class="nav-number">3.2.3.</span> <span class="nav-text">智能匹配</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第四章-子例程和签名"><span class="nav-number">4.</span> <span class="nav-text">第四章 子例程和签名</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#申明子例程"><span class="nav-number">4.1.</span> <span class="nav-text">申明子例程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Adding-Signatures"><span class="nav-number">4.2.</span> <span class="nav-text">Adding Signatures</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#基础"><span class="nav-number">4.2.1.</span> <span class="nav-text">基础</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#传递数组、散列和代码"><span class="nav-number">4.2.2.</span> <span class="nav-text">传递数组、散列和代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#插值、数组和散列"><span class="nav-number">4.2.3.</span> <span class="nav-text">插值、数组和散列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#可选参数"><span class="nav-number">4.2.4.</span> <span class="nav-text">可选参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#强制参数"><span class="nav-number">4.2.5.</span> <span class="nav-text">强制参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#具名实参和形参"><span class="nav-number">4.2.6.</span> <span class="nav-text">具名实参和形参</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Slurpy-参数"><span class="nav-number">4.2.7.</span> <span class="nav-text">Slurpy 参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#返回结果"><span class="nav-number">4.3.</span> <span class="nav-text">返回结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#返回值的类型"><span class="nav-number">4.4.</span> <span class="nav-text">返回值的类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Working-With-Types"><span class="nav-number">4.5.</span> <span class="nav-text">Working With Types</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#基本类型"><span class="nav-number">4.5.1.</span> <span class="nav-text">基本类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#添加限制"><span class="nav-number">4.5.2.</span> <span class="nav-text">添加限制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#抽象参数和具体参数"><span class="nav-number">4.6.</span> <span class="nav-text">抽象参数和具体参数</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">焉知非鱼</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  托管在 -
  <a class="theme-link" href="https://github.com/ohmycloud/ohmycloud.github.io">
    Github
  </a>
  &nbsp; | &nbsp;
</div>

<div class="theme-info">
 <a class="51-img" href="/images/footer.gif" target="_blank"><img alt="统计" src="/images/footer.gif"  align="right" /></a>
<div>
        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"chenyf"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  

  

  

</body>
</html>
